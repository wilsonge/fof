<?xml version="1.0" encoding="UTF-8"?>
<book version="5.0" xmlns="http://docbook.org/ns/docbook"
      xmlns:xlink="http://www.w3.org/1999/xlink"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      xmlns:svg="http://www.w3.org/2000/svg"
      xmlns:m="http://www.w3.org/1998/Math/MathML"
      xmlns:html="http://www.w3.org/1999/xhtml"
      xmlns:db="http://docbook.org/ns/docbook">
  <info>
    <title>FOF Developer's Guide</title>

    <subtitle>The compact reference to Joomla!'s Rapid Application Development
    framework</subtitle>

    <author>
      <personname><firstname>Nicholas</firstname><surname>Dionysopoulos</surname></personname>

      <affiliation>
        <orgname>Akeeba Ltd</orgname>
      </affiliation>
    </author>

    <pubdate>December 2013</pubdate>

    <copyright>
      <year>2013</year>

      <holder>Akeeba Ltd</holder>
    </copyright>

    <legalnotice>
      <para>The contents of this documentation are subject to copyright law
      and are made available under the <link
      xlink:href="http://docs.joomla.org/JEDL">Joomla! Electronic
      Documentation License (JEDL)</link> unless otherwise stated. You may
      find the <link xlink:href="http://docs.joomla.org/JEDL/FAQ">JEDL
      Frequently Asked Questions</link> useful in determining if your proposed
      use of this material is allowed. If you have any questions regarding
      licensing of this material please contact <link
      xlink:href="mailto:legal@opensourcematters.org">legal@opensourcematters.org</link>.
      If you wish to report a possible violation of the license terms for the
      material on this site then please contact <link
      xlink:href="mailto:legal@opensourcematters.org">legal@opensourcematters.org</link>.</para>
    </legalnotice>

    <cover>
      <para><figure role="front-large">
          <title>FOF Developer's Guide cover image</title>

          <mediaobject>
            <imageobject>
              <imagedata fileref="images/cover.jpg"/>
            </imageobject>
          </mediaobject>
        </figure></para>
    </cover>
  </info>

  <chapter xml:id="introducing-fof">
    <title>Introducing FOF</title>

    <section xml:id="introduction">
      <title>Introduction</title>

      <section xml:id="what-is-fof">
        <title>What is FOF</title>

        <para>FOF (Framework on Framework) is a rapid application development
        framework for Joomla!. Unlike other frameworks it is not standalone.
        It extends the Joomla! Platform instead of replacing it, featuring its
        own forked and extended version of the MVC classes, keeping a strong
        semblance to the existing Joomla! MVC API. This means that you don't
        have to relearn writing Joomla! extensions. Instead, you can start
        being productive from the first day you're using it. Our goal is to
        always support the officially supported LTS versions of Joomla! and
        not break backwards compatibility without a clear deprecation and
        migration path.</para>

        <para>FOF is compatible with the database technologies used by Joomla!
        itself: MySQL, SQL Server (and Windows Azure SQL), PostgreSQL. In most
        cases you can write a component in one database server technology and
        have it run on the other database server technologies with minimal or
        no effort.</para>

        <para>FOF is currently used by free and commercial components for
        Joomla! by an increasing number of developers.</para>
      </section>

      <section xml:id="free-software-means-collaboration">
        <title>Free Software means collaboration</title>

        <para>The reason of existence of FOSS (Free and Open Source Software)
        is collaboration between developers. FOF is no exception; it exists
        because and for the community of Joomla! developers. It is provided
        free of charge and with all of the freedoms of the GPL for you to
        benefit. And in true Free Software spirit, the community aspect is
        very strong. Participating is easy and fun.</para>

        <para>If you want to discuss FOF there is a <link
        xlink:href="https://groups.google.com/forum/?hl=en&amp;fromgroups#!forum/frameworkonframework">Google
        Groups mailing list</link>. This is a peer discussion group where
        developers working with FOF can freely discuss.</para>

        <para>If you have a feature proposal or have found a bug, but you're
        not sure how to code it yourself, please report it on the list.</para>

        <para>If you have a patch feel free to fork this <link
        xlink:href="https://github.com/akeeba/fof">project on GitHub</link>
        (you only need a free account to do that) and send a pull request.
        Please remember to describe what you intended to achieve to help me
        review your code faster.</para>

        <para>If you've found a cool hack (in the benign sense of the word,
        not the malicious one...), something missing from the documentation or
        have a tip which can help other developers feel free to edit the Wiki.
        We're all grown-ups and professionals, I believe there is no need of
        policing the wiki edits. If you're unsure about whether a wiki edit is
        appropriate, please ask on the list.</para>
      </section>

      <section xml:id="preface-to-doc">
        <title>Preface to this documentation</title>

        <para>FOF is a rapid application development framework for Joomla!.
        Instead of trying to completely replace Joomla!’s own API (formerly
        known as the Joomla! Platform) it builds upon it and extends it both
        in scope and features. In the end of the day it enables agony-free
        extension development for the Joomla! CMS.</para>

        <para>In order to exploit the time-saving capabilities of the FOF
        framework to the maximum you need to understand how it's organized,
        the conventions used and how its different pieces work together. This
        documentation attempts to provide you with this knowledge.</para>

        <para>As with every piece of documentation we had to answer two big
        questions: where do we start and how do we structure the content. The
        first question was easy to answer. Having given the presentation of
        the FOF framework countless times we have developed an intuitive grasp
        of how to start presenting it: from the abstract to the
        concrete.</para>

        <para>The second question was harder to answer. Do we write a dry
        reference to the framework or more of a story-telling documentation
        which builds up its reader’s knowledge? Since we are all developers we
        can read the code (and DocBlocks), meaning that the first option is
        redundant. Therefore we decided to go for the second option.</para>

        <para>As a result this documentation does not attempt to be a complete
        reference, a development gospel, the one and only source of
        information on FOF. On the contrary, this documentation aims to be the
        beginning of your journey, much like a travel guide. What matters the
        most is the journey itself, writing your own extensions based on FOF.
        As you go on writing software you will be full of questions. Most of
        them you’ll answer yourself. Some of them will be already answered in
        the wiki. A few of them you’ll have to ask on the mailing list. In the
        end of the day you will be richer in knowledge. If you do dig up a
        golden nugget of knowledge, please do consider writing a wiki page.
        This way we’ll all be richer and enjoy our coding trip even
        more.</para>

        <para>Have fun and code on!</para>
      </section>
    </section>

    <section xml:id="getting-started-with-fof">
      <title>Getting started with FOF</title>

      <section xml:id="download-and-install">
        <title>Download and install FOF</title>

        <para>You can download FOF as an installable Joomla! library package
        from <link
        xlink:href="https://www.akeebabackup.com/download/fof.html">our
        repository</link>. You can install it like any other extension under
        Joomla! 2.x and later.</para>

        <bridgehead>Using the latest development version</bridgehead>

        <para>You can clone a read-only copy of the Git repository of FOF in
        your local machine. Make sure you symlink or copy the fof directory to
        your dev site's libraries/fof directory. Alternatively, we publish dev
        releases in the <link
        xlink:href="https://www.akeebabackup.com/download/fof-dev.html">dev
        release repository</link>. These are installable packages but please
        note that they may be out of date compared to the Git HEAD. Dev
        releases are not published automatically and may be several revisions
        behind the current Git master branch.</para>
      </section>

      <section xml:id="using-in-your-extension">
        <title>Using it in your extension</title>

        <para>The recommended method for including FOF in your component,
        module or plugin is using this short code snippet right after your
        defined('_JEXEC') or die() statement (Joomla! 2.x and later):</para>

        <programlisting language="php">if (!defined('F0F_INCLUDED'))
{
    include_once JPATH_LIBRARIES . '/f0f/include.php';
}</programlisting>

        <para>Alternatively, you can use the one-liner:</para>

        <programlisting language="php">require_once JPATH_LIBRARIES . '/f0f/include.php';
</programlisting>

        <para>From that point onwards you can use FOF in your
        extension.</para>
      </section>

      <section xml:id="install-fof-with-your-component">
        <title>Installing FOF with your component</title>

        <para>Unfortunately, Joomla! doesn't allow us to version checking
        before installing a library package. This means that it's your
        responsibility to check that there is no newer version of FOF
        installed in the user's site before attempting to install FOF with
        your extension. In the following paragraphs we are going to
        demonstrate one way to do that for Joomla! 2.x / 3.x component
        packages.</para>

        <para>Include a directory called fof in your installation package. The
        directory should contain the files of the installation package's fof
        directory. Then, in your script.mycomponent.php file add the following
        method:</para>

        <programlisting language="php">/**
 * Check if FOF is already installed and install if not
 *
 * @param   object  $parent  class calling this method
 *
 * @return  array            Array with performed actions summary
 */
private function _installFOF($parent)
{
    $src = $parent-&gt;getParent()-&gt;getPath('source');

    // Load dependencies
    JLoader::import('joomla.filesystem.file');
    JLoader::import('joomla.utilities.date');
    $source = $src . '/fof';

    if (!defined('JPATH_LIBRARIES'))
    {
        $target = JPATH_ROOT . '/libraries/f0f';
    }
    else
    {
        $target = JPATH_LIBRARIES . '/f0f';
    }
    $haveToInstallFOF = false;

    if (!is_dir($target))
    {
        $haveToInstallFOF = true;
    }
    else
    {
        $fofVersion = array();

        if (file_exists($target . '/version.txt'))
        {
            $rawData = JFile::read($target . '/version.txt');
            $info    = explode("\n", $rawData);
            $fofVersion['installed'] = array(
                'version'   =&gt; trim($info[0]),
                'date'      =&gt; new JDate(trim($info[1]))
            );
        }
        else
        {
            $fofVersion['installed'] = array(
                'version'   =&gt; '0.0',
                'date'      =&gt; new JDate('2011-01-01')
            );
        }

        $rawData = JFile::read($source . '/version.txt');
        $info    = explode("\n", $rawData);
        $fofVersion['package'] = array(
            'version'   =&gt; trim($info[0]),
            'date'      =&gt; new JDate(trim($info[1]))
        );

        $haveToInstallFOF = $fofVersion['package']['date']-&gt;toUNIX() &gt; $fofVersion['installed']['date']-&gt;toUNIX();
    }

    $installedFOF = false;

    if ($haveToInstallFOF)
    {
        $versionSource = 'package';
        $installer = new JInstaller;
        $installedFOF = $installer-&gt;install($source);
    }
    else
    {
        $versionSource = 'installed';
    }

    if (!isset($fofVersion))
    {
        $fofVersion = array();

        if (file_exists($target . '/version.txt'))
        {
            $rawData = JFile::read($target . '/version.txt');
            $info    = explode("\n", $rawData);
            $fofVersion['installed'] = array(
                'version'   =&gt; trim($info[0]),
                'date'      =&gt; new JDate(trim($info[1]))
            );
        }
        else
        {
            $fofVersion['installed'] = array(
                'version'   =&gt; '0.0',
                'date'      =&gt; new JDate('2011-01-01')
            );
        }

        $rawData = JFile::read($source . '/version.txt');
        $info    = explode("\n", $rawData);
        $fofVersion['package'] = array(
            'version'   =&gt; trim($info[0]),
            'date'      =&gt; new JDate(trim($info[1]))
        );
        $versionSource = 'installed';
    }

    if (!($fofVersion[$versionSource]['date'] instanceof JDate))
    {
        $fofVersion[$versionSource]['date'] = new JDate;
    }

    return array(
        'required'  =&gt; $haveToInstallFOF,
        'installed' =&gt; $installedFOF,
        'version'   =&gt; $fofVersion[$versionSource]['version'],
        'date'      =&gt; $fofVersion[$versionSource]['date']-&gt;format('Y-m-d'),
    );
}
</programlisting>

        <para>You need to call it from inside your postflight() method. For
        example:</para>

        <programlisting language="php">/**
 * Method to run after an install/update/uninstall method
 *
 * @param   object  $type    type of change (install, update or discover_install)
 * @param   object  $parent  class calling this method
 *
 * @return void
 */
function postflight($type, $parent)
{
        $fofInstallationStatus = $this-&gt;_installFOF($parent);
}
</programlisting>

        <warning>
          <para>Due to a bug/feature in Joomla! 1.6 and later, your
          component's manifest file must start with a letter before L,
          otherwise Joomla! will assume that lib_fof.xml is your extension's
          XML manifest and install FOF instead of your extension. We suggest
          using the com_yourComponentName.xml convention, e.g. com_todo.xml.
          There is a patch pending in Joomla!'s tracker for this issue,
          hopefully it will be accepted sometime soon.</para>
        </warning>

        <tip>
          <para>Since FOF 2.4.0 you can create an installation script which
          extends <classname>F0FUtilsInstallscript</classname>, then put a
          copy of the latest stable build of FOF inside a top-level directory
          called <filename>fof</filename> in your installationpackage archive.
          <classname>F0FUtilsInstallscript</classname> will install FOF
          automatically for you. Check out the installation script in Akeeba
          Backup Core for a real-world example</para>
        </tip>
      </section>

      <section xml:id="sample-apps">
        <title>Sample applications</title>

        <para>FOF comes with two sample applications which are used to
        demonstrate its features, <link
        xlink:href="https://github.com/akeeba/todo-fof-example">To-Do</link>
        and <link xlink:href="https://github.com/akeeba/contactus">Contact
        Us</link>. These were conceived and developed in different points of
        FOF's development. As a result they are always in a state of flux and
        will definitely not expose all of FOF's features.</para>

        <para>Another good way to learn some FOF tricks is by reading the
        source code of existing FOF-based components. Just remember that we
        are all real world developers and sometimes our code is anything but
        academically correct ;)</para>
      </section>
    </section>

    <section xml:id="key-features">
      <title>Key Features</title>

      <para>Some of the key features / highlights of FOF:</para>

      <bridgehead>Convention over configuration, Rails style.</bridgehead>

      <para>Instead of having to painstakingly code every single bit of your
      component, it's sufficient to use our naming conventions, inspired by
      Ruby on Rails conventions. For example, if you have com_example, the
      foobar view will read from the #__example_foobars table which has a
      unique key named example_foobar_id. The default implementation of
      controllers, models, tables and views will also cater for the majority
      of use cases, minimising the code you'll need to write.</para>

      <bridgehead>HMVC today, without relearning component
      development.</bridgehead>

      <para>There's a lot of talk about the need to re-engineer the MVC
      classes in Joomla! to support HMVC. What if we could give you HMVC
      support using the existing MVC classes, today, without having to relearn
      how to write components? Yes, it's possible with FOF. It has been
      possible since September 2011, actually. And for those who mumble their
      words and spread FUD, yes, it IS HMVC by any definition. The very
      existence of the F0FDispatcher class proves the point.</para>

      <bridgehead>Easy reuse of view template files without ugly
      include().</bridgehead>

      <para>More often than not you want to reuse view template files across
      views. The "traditional" way was by using include() or require()
      statements. This meant, however, that template overrides ceased working.
      Not any more! Using F0FView's loadAnyTemplate() you can load any view
      template file from the front- or back-end of your component or any other
      component, automatically respecting template overrides.</para>

      <bridgehead>Automatic language loading and easy overrides.</bridgehead>

      <para>Are you sick and tired of having to load your component's language
      files manually? Do you end up with a lot of untranslated strings when
      your translators don't catch up with your new features? Yes, that sucks.
      It's easy to overcome. FOF will automatically handle language loading
      for you.</para>

      <bridgehead>Media files override (works like template
      overrides).</bridgehead>

      <para>So far you knew that you can override Joomla!'s view template
      files using template overrides. But what about CSS or Javascript files?
      This usually required the users to "hack core", i.e. modify your views'
      PHP files, ending up in an unmaintainable, non-upgradeable and
      potentially insecure solution. Not any more! Using FOF's
      F0FTemplateUtils::addCSS and F0FTemplateUtils::addJS you can load your
      CSS and JS files directly from the view template file. Even better? You
      can use the equivalent of template overrides to let your users and
      template designers override them with their own implementations. They
      just have to create the directory
      templates/your_template/media/com_example to override the files normally
      found in media/com_example. So easy!</para>

      <bridgehead>Automatic JSON and CSV views with no extra code (also useful
      for web services).</bridgehead>

      <para>Why struggle to provide a remote API for your component? FOF makes
      the data of each view accessible as JSON feeds opening a new world of
      possibilities for Joomla! components (reuse data in mobile apps,
      Metro-style Windows 8 tiles, browser extensions, mash-up web
      applications, ...). The automatic CSV views work on the same principle
      but output data in CSV format, suitable for painlessly data importing to
      spreadsheets for further processing. Oh, did we mention that we already
      have an almost RESTful web services implementation?</para>

      <bridgehead>No code view templates.</bridgehead>

      <para>Don't you hate it that you have to write a different view template
      (in PHP and HTML) for each Joomla! version and, worse, each template out
      there? Don't you hate it having to teach non-developers how to not screw
      up your component with every update you publish? We feel your pain.
      That's why FOF supports the use of XML files as view templates,
      rendering them automatically to HTML. Not just forms; everything,
      including browse (multiple items) and single item views. Even better,
      you get to choose if you want to use traditional PHP/HTML view
      templates, XML view templates or a combination of both, even in the same
      view!</para>

      <bridgehead>No code routing, ACL and overall application
      configuration.</bridgehead>

      <para>Since FOF 2.1 you can define your application's routing, access
      control integration and overall configuration without routing any code,
      just by using a simple to understand XML file. It's now easier than ever
      to have Joomla! extensions with truly minimal (or no) PHP code.</para>
    </section>
  </chapter>

  <chapter xml:id="component-overview-and-reference">
    <title>Component overview and reference</title>

    <para>FOF is an MVC framework in heart and soul. It tries to stick as
    close as possible to the MVC conventions put forward by the Joomla! CMS
    since Joomla! 1.5, cutting down on unnecessary code duplication. The main
    premise is that your code will be DRY – not as the opposite of “wet”, but
    as in Don’t Repeat Yourself. Simply put: if you ever find yourself trying
    to copy code from a base class and paste it into a specialized class, you
    are doing it wrong.</para>

    <para>In order to achieve this code isolation, FOF uses a very flexible
    structure for your components. A component's structure looks like
    this:</para>

    <mediaobject>
      <imageobject>
        <imagedata align="center" fileref="images/component-structure.png"
                   scalefit="1" width="14cm"/>
      </imageobject>
    </mediaobject>

    <para>The Dispatcher is the entry point of your component. Some people
    would call this a "front Controller" and this is actually what it is. It's
    different than what we typically call a Controller in the sense that the
    Dispatcher is the only part of your component which is supposed to
    interface the underlying application (e.g. the Joomla! CMS) and gets to
    decide which Controller and task to execute based on the input data
    (usually this is the request data). No matter if you call it an entry
    point, front controller, dispatcher or Clint Eastwood its job is to figure
    out what needs to run and run it. We simply chose the name "Dispatcher"
    because, like all conventions, we had to call it something. So, basically,
    the Dispatcher will take a look at the input data, figure out which
    Controller and task to run, create an instance of it, push it the data and
    tell it to run the task. The Controller is expected to return the rendered
    data or a redirection which the Dispatcher will dully pass back to its
    caller.</para>

    <para>Oh, wait, what is a Controller anyway?! Right below the Dispatcher
    you will see a bunch of stuff grouped as a "triad". The "triad" is
    commonly called "view" (with a lowercase v). Each triad does something
    different in your component. For example, one triad may allow you to
    handle clients, another triad allow you to handle orders and so on. Your
    component can have one or more triads. A triad usually contains a
    Controller, a Model and a View, hence the name ("triad" literally means "a
    bunch of three things"). The only mandatory member is the Controller. A
    triad may be reusing the Model and View from another triad – which is
    another reason why DRY code rocks– or it may even be view-less. So, a
    triad may actually be a bunch of one, two or three things, as long as it
    includes a Controller. Just to stop you from being confused or thinking
    about oriental organised crime and generally make your life easier we
    decided to call these "views" (with a lowercase v) instead of "triads".
    See? Now it is so much better.</para>

    <para>FOF views follow the "fat Model - thin Controller" paradigm. This
    means that the Controller is a generally minimalist piece of code and the
    Model is what gets to do all the work. Knowing this very important bit of
    information, let's take a look at the innards of a view.</para>

    <para>In the very beginning we have the Controller. The Controller has one
    or more tasks. Each task is an action of your component, like showing a
    list of records, showing a single record, publish a record, delete a
    record and so on. With a small difference. The Controller's tasks do not
    perform the actual work. They simply spawn an instance of the Model and
    push it the necessary data it needs. This is called "setting the state" of
    the Model. In most cases the Controller will also call a Model's method
    which does something. It's extremely important to note that the Controller
    will work with any Model that implements that method and that the Model is
    oblivious to the Controller. Then the Controller will create an instance
    of the View class, pass it the instance of the Model and tell it to go
    render itself. It will take the output of the View and pass it back to the
    Dispatcher.</para>

    <para>Which brings us to the Model. The Model is the workhorse of the
    view. It implements the business logic. All FOF Models are passive Models
    which means that they are oblivious to the presence of the Controller and
    View. Actually, they are completely oblivious to the fact that they are
    part of a triad. That's right, Models can be used standalone, outside the
    context of the view or component they are designed to live in. The Model's
    methods will act upon the state variables which have already been set
    (typically, by the Controller) and will only modify the state variables or
    return the output directly. Models must never have to deal with input data
    directly or talk to specific Controllers and/or Views. Models are
    decoupled from everything, that's where their power lies.</para>

    <para>Just a small interlude here. Right below the Model we see a small
    thing called a "Table". This is a strange beast. It's one part data
    adapter, one part model and one part controller, but nothing quite like
    any of this. The Table is used to create an object representing a single
    record. It is typically used to check the validity of a record before
    saving it to the database and post-process a record when reading it from
    the database (e.g. unserialise a field which contains serialised or JSON
    data).</para>

    <para>The final piece of our view is the View class itself. It will ask
    the Model for the raw data and transform it into a suitable
    representation. Typically this means getting the raw records from the
    Model and create the HTML output, but that's not the only use for a View.
    A View could just as well render the data as a JSON stream, a CSV file, or
    even produce a graphic, audio or video file. It's what transforms the raw
    data into something useful, i.e. it's your presentation layer. Most often
    it will do so by loading view templates which are .php files which
    transform raw data to a suitable representation. If you are using the XML
    forms feature of FOF, the View will ask the Model to return the form
    definition and ask FOF's renderer to render this to HTML instead. Even
    though the actual rendering is delegated to the Renderer (not depicted
    above), it's still the View that's responsible for the final leg of the
    rendered data: passing it back to its caller. Yes, the View will actually
    neither output its data directly to the browser, nor talk to the
    underlying application. It returns the raw data back to its caller, which
    is almost always the Controller. Again, we have to stress that the View is
    oblivious to both the Controller and the Model being used. A properly
    written View is fully decoupled from everything else and will work with
    any data provider object implementing the same interface as a Model object
    and a caller which is supposed to capture its output for further
    consumption.</para>

    <important>
      <para>All classes comprising a view are fully decoupled. None is aware
      of the internal workings of another object in the same or a different
      view. This allows you to exchange objects at will, promoting code reuse.
      Even though it sounds like a lot of work it's actually less work and
      pays dividends the more features you get to add to your
      components.</para>
    </important>

    <para>There's another bit mentioned below the triad, the Toolbar. The
    Toolbar is something which conceptually belongs to the component and only
    has to do with views being rendered as HTML. It's what renders the title
    in the back-end, the actions toolbar in the front- or back-end and the
    navigation links / menu in the back-end. In case you missed the subtle
    reference: F0FToobar allows you to render an actions toolbar even in the
    front-end of your component, something that's not possible with plain old
    Joomla!. You will simply need to add some CSS to do it.</para>

    <para>Finally we mention the Helpers. The Helpers are pure static classes
    implementing every bit of functionality that's neither OOP, nor can it be
    categorised in any other object already mentioned. For example, methods to
    render drop-down selection lists. In so many words, "Helper" is a polite
    way of saying "non-OOP cruft we'd rather not talk about". Keep your
    Helpers to a minimum as they're a royal pain in the rear to test.</para>

    <para>Please do keep in mind that this is just a generic overview of how
    an FOF-based component works. The real power comes from the fact that you
    don't need to know the internal workings of FOF to use it, you don't need
    to copy and paste code from it (woe is the developer who does that) and
    quite possibly you don't even need to write any code. At all. It's all
    discussed later on.</para>

    <section xml:id="fofmodel">
      <title>Models</title>

      <para>The Model is the workhorse. Business logic goes here. Models never
      interface input data directly or output data. They are supposed to read
      data from their state and push the results to their state.</para>

      <bridgehead>Class and file naming conventions</bridgehead>

      <para>The convention for naming the model classes is
      <classname>ComponentModelView</classname>, e.g.
      <classname>TodoModelItems</classname> for a component named
      <code>com_todo</code> and a view named <code>items</code>. The last part
      SHOULD be plural. Support for singular named models (such as
      <classname>TodoModelItem</classname>) will be dropped in a future
      version.</para>

      <para>The model file MUST match the last part of the class name. This
      means that the file for <classname>TodoModelItems</classname> MUST be
      <filename>items.php</filename>, whereas the file for
      <classname>TodoModelItem</classname> MUST be
      <filename>item.php</filename>.</para>

      <para>All Model files are located in your component's
      <filename>models</filename> directories, in the front-end and back-end.
      If a file is not present in the front-end, it will be attempted to be
      loaded from the back-end and vice versa. If the Model class is not
      loaded and a suitable file cannot be found FOF will fall back to one of
      the following, in this order:</para>

      <orderedlist>
        <listitem>
          <para>The Default model. This is a special model class following the
          naming conventions <classname>ComponentModelDefault</classname>,
          e.g. <classname>TodoModelDefault</classname>, found in the
          <filename>default.php</filename> file inside your models
          directory.</para>
        </listitem>

        <listitem>
          <para>If a default model is not found, FOF will fall back to
          creating a suitably configured instance of
          <classname>F0FModel</classname>, using convention over configuration
          (explained below) to determine what the model object should
          do.</para>
        </listitem>
      </orderedlist>

      <bridgehead>Database table naming conventions</bridgehead>

      <para>All FOF models connect, by default, to a database table. You can
      of course have a model whose corresponding table doesn't exist as long
      as you do not use its default data processing methods.</para>

      <para>Database tables are named as
      <database>#__component_view</database>, e.g.
      <database>#__todo_items</database> for a component named
      <code>com_todo</code> and a view named <code>items</code>.</para>

      <para>The auto increment field is named
      <database>component_view_id</database>, e.g.
      <database>todo_item_id</database> for a component named
      <code>com_todo</code> and a view named <code>items</code>. If your table
      does not have an auto incrementing field you will not be able to use the
      default implementation of FOF's data processing methods.</para>

      <para>You can override defaults without copying &amp; pasting code,
      ever. This is documented in Configuring MVC.</para>

      <bridgehead>Customising a specialised class</bridgehead>

      <para>Unlike plain old Joomla! you are NOT supposed to copy and paste
      code when dealing with FOF. Our rule of thumb is that if you ever find
      yourself copying code from F0FModel into your extension's specialised
      model class you're doing it wrong.</para>

      <para>FOF models can be customised very easily using the
      <methodname>onBefore<replaceable>Something</replaceable></methodname> /
      <methodname>onAfter<replaceable>Something</replaceable></methodname>
      methods. The <replaceable>Something</replaceable> is the name of the
      model method they are related to. For example,
      <methodname>onBeforeSave</methodname> runs before the
      <methodname>save()</methodname> method executes its actions and
      <methodname>onAfterSave</methodname> runs right after the
      <methodname>save()</methodname> method executes its actions. Specific
      implementation notes for each case can be found in the docblocks of each
      event method.</para>

      <bridgehead>Customising using plugin events</bridgehead>

      <para>FOF models are designed to call certain plugin events (of
      "content" plugins) upon certain actions. The events are defined in the
      model's protected properties as follows:</para>

      <variablelist>
        <varlistentry>
          <term>event_before_delete</term>

          <listitem>
            <para>(default: <methodname>onContentBeforeDelete</methodname>) is
            triggered before a record is deleted.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>event_after_delete</term>

          <listitem>
            <para>(default: <methodname>onContentAfterDelete</methodname>) is
            triggered after a record is deleted.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>event_before_save</term>

          <listitem>
            <para>(default: <methodname>onContentBeforeSave</methodname>) is
            triggered before a record is saved.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>event_after_save</term>

          <listitem>
            <para>(default: <methodname>onContentAfterSave</methodname>) is
            triggered after a record is saved.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>event_change_state</term>

          <listitem>
            <para>(default: <methodname>onContentChangeState</methodname>) is
            triggered after a record changes state, i.e. it's published,
            unpublished etc.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>event_clean_cache</term>

          <listitem>
            <para>(default: none; doesn't run) is triggered when FOF is
            cleaning the cache.</para>
          </listitem>
        </varlistentry>
      </variablelist>

      <para>Moreover, if you are using XML forms you will also see the
      <methodname>onContentPrepareForm</methodname> event which runs when the
      form is being pre-processed before rendering.</para>

      <para>These are the same as the standard Joomla! plugin events. This
      ensures that a plugin written for a core Joomla! component can easily be
      extended to handle FOF components as well.</para>

      <para>Whenever Joomla! requires us to pass a context to the plugin
      events we use the conventions
      <parameter><replaceable>component</replaceable>.<replaceable>view</replaceable></parameter>
      e.g. <parameter>com_todo.items</parameter> for a component name
      <code>com_todo</code> and a model for the items
      <code>view</code>.</para>

      <section xml:id="fofmodel-behaviours">
        <title>Model Behaviours</title>

        <section xml:id="fofmodel-behaviours-intro">
          <title>Introduction</title>

          <para>Models can implement complex, reusable functionality using
          behaviours. Model Behaviors are a handy way to alter the workflow of
          a F0FModel. It's based upon the standard Joomla Event system.</para>

          <para>Before and After certain actions (<classname>onBefore*</classname>
          / <classname>onAfter*</classname>) the model triggers an
          "event" which is propagated to each of the registered behaviors for
          that model. They can then, by registering to these events, alter the
          way the action itself is performed.</para>

          <para>It's possible to register different behaviors per model; they
          can be added by default, or even on the fly, after the model is
          created.</para>

          <para>FOF already provides a list of common behaviors, that can be
          used by any F0FModel object. The bundled behaviour classes are currently
          located inside FOF's <filename>model/behavior</filename> directory.
          By default, only the <filename>filters</filename> behaviour is being
          loaded.</para>
        </section>

        <section xml:id="fofmodel-behaviours-standard">
          <title>FOF standard Behaviors</title>

          <para>FOF comes with several built-in model behaviours. They are
          used to provide core functionality. By default only the "filters"
          behaviour is attached to a model for performance reasons. In this
          section we will discuss what each behaviour does.</para>

          <para>You can combine multiple behaviours at once.</para>

          <section xml:id="fofmodel-behaviours-access">
            <title>access</title>

            <para>Adding this behaviour to a model object filters the
            front-end output by the viewing access levels the user has access
            to.</para>

            <important>
              <para>This behaviour REQUIRES the <code>filters</code> behaviour.
              If you have not added the "filters" behaviour it will not have any
              effect on browse views. It will, however, work on edit and read
              views.</para>

              <para>This behaviour requires the <code>access</code> magic field.</para>
            </important>
          </section>

          <section xml:id="fofmodel-behaviours-enabled">
            <title>enabled</title>

            <para>Adding this behaviour to a model object filters the
            front-end output to only items which are published
            (enabled=1).</para>

            <important>
              <para>This behaviour requires the <code>enabled</code> magic field.</para>
            </important>
          </section>

          <section xml:id="fofmodel-behaviours-filters">
            <title>filters</title>

            <important>
              <para>This behaviour only works on browse views.</para>
            </important>

            <para>Adding this behaviour to a model object allows FOF to
            magically apply filters based on the input data. For example, if
            you pass &amp;foobar=1 in the URL, or –more generally speaking–
            have a foobar state variable with a value of 1 then the SQL query
            used to fetch the items list will be filtered by the rows where
            the foobar column is set to 1.</para>

            <para>The filters behaviour is smart enough to recognise the type
            of your table fields and apply the correct type filter each time.
            There are several different filtering methods per field type.
            Besides the default filtering method which is used when you only
            use a plain value in the state variable you can select a different
            method. To do that you need to pass a hash (keyed) array in the
            state variable like this array('method' =&gt; 'between', 'from'
            =&gt; 1, 'to' =&gt; 10) or, in URL query format,
            &amp;foobar[method]=between&amp;foobar[from]=1&amp;foobar[to]=10.</para>

            <para>So, let's discuss the available match types per field
            type.</para>

            <bridgehead>Number fields</bridgehead>

            <para>For numeric fields you can use the following filtering
            methods:</para>

            <variablelist>
              <varlistentry>
                <term>exact</term>

                <listitem>
                  <para>This is the default method. You can just pass the
                  value you want to search. If you want to use the hash array
                  format you have the following keys:</para>

                  <itemizedlist>
                    <listitem>
                      <para><option>method</option> :
                      <parameter>exact</parameter></para>
                    </listitem>

                    <listitem>
                      <para><option>value</option> : the value you want to
                      search</para>
                    </listitem>
                  </itemizedlist>
                </listitem>
              </varlistentry>

              <varlistentry>
                <term>partial</term>

                <listitem>
                  <para>For numeric fields this is just an alias to
                  <code>exact</code>.</para>
                </listitem>
              </varlistentry>

              <varlistentry>
                <term>between</term>

                <listitem>
                  <para>Returns records whose field value is inside the space
                  between two numbers, inclusive. You have the following
                  keys:</para>

                  <itemizedlist>
                    <listitem>
                      <para><option>method</option> :
                      <parameter>between</parameter></para>
                    </listitem>

                    <listitem>
                      <para><option>from</option> : Left barrier of the number
                      space</para>
                    </listitem>

                    <listitem>
                      <para><option>to</option> : Right barrier of the number
                      space</para>
                    </listitem>
                  </itemizedlist>

                  <para>For example from=1 and to=10 will search for any value
                  between 1 to 10, including 1 and 10.</para>
                </listitem>
              </varlistentry>

              <varlistentry>
                <term>outside</term>

                <listitem>
                  <para>Returns records whose field value is outside the space
                  between two numbers, exclusive. You have the following
                  keys:</para>

                  <itemizedlist>
                    <listitem>
                      <para><option>method</option> :
                      <parameter>outside</parameter></para>
                    </listitem>

                    <listitem>
                      <para><option>from</option> : Left barrier of the number
                      space</para>
                    </listitem>

                    <listitem>
                      <para><option>to</option> : Right barrier of the number
                      space</para>
                    </listitem>
                  </itemizedlist>

                  <para>For example from=1 and to=10 will search for any value
                  lower than 1 or greater than 10, excluding 1 and 10.</para>
                </listitem>
              </varlistentry>

              <varlistentry>
                <term>interval</term>

                <listitem>
                  <para>Returns records whose field value is following an
                  interval (arithmetical progression)</para>

                  <itemizedlist>
                    <listitem>
                      <para><option>method</option> :
                      <parameter>interval</parameter></para>
                    </listitem>

                    <listitem>
                      <para><option>value</option> : The starting value of the
                      interval</para>
                    </listitem>

                    <listitem>
                      <para><option>interval</option> : The interval
                      period</para>
                    </listitem>
                  </itemizedlist>

                  <para>For example value=5 interval=2 will search for values
                  5, 7, 9, 11 and so on.</para>
                </listitem>
              </varlistentry>
            </variablelist>

            <bridgehead>Boolean fields</bridgehead>

            <para>For boolean (tiny integer) fields you can use the following
            methods:</para>

            <variablelist>
              <varlistentry>
                <term>exact</term>

                <listitem>
                  <para>This is the default method. You can just pass the
                  value you want to search. If you want to use the hash array
                  format you have the following keys:</para>

                  <itemizedlist>
                    <listitem>
                      <para><option>method</option> :
                      <parameter>exact</parameter></para>
                    </listitem>

                    <listitem>
                      <para><option>value</option> : the value you want to
                      search</para>
                    </listitem>
                  </itemizedlist>
                </listitem>
              </varlistentry>
            </variablelist>

            <bridgehead>Text fields</bridgehead>

            <para>For text fields you can use the following methods:</para>

            <variablelist>
              <varlistentry>
                <term>partial</term>

                <listitem>
                  <para>This is the default method. You can just pass the
                  value you want to search. The records returned have that
                  value somewhere in their fields (partial text search). If
                  you want to use the hash array format you have the following
                  keys:</para>

                  <itemizedlist>
                    <listitem>
                      <para><option>method</option> :
                      <parameter>partial</parameter></para>
                    </listitem>

                    <listitem>
                      <para><option>value</option> : the partial phrase you
                      want to search</para>
                    </listitem>
                  </itemizedlist>
                </listitem>
              </varlistentry>

              <varlistentry>
                <term>exact</term>

                <listitem>
                  <para>Performs an exact search. The fields' values must be
                  exactly equal to the value you use here. You have the
                  following keys:</para>

                  <itemizedlist>
                    <listitem>
                      <para><option>method</option> :
                      <parameter>exact</parameter></para>
                    </listitem>

                    <listitem>
                      <para><option>value</option> : the exact phrase you want
                      to search</para>
                    </listitem>
                  </itemizedlist>
                </listitem>
              </varlistentry>
            </variablelist>

            <bridgehead>Date fields</bridgehead>

            <para>For date and date/time fields you can use the following
            methods:</para>

            <variablelist>
              <varlistentry>
                <term>exact</term>

                <listitem>
                  <para>This is the default method. Performs an exact search.
                  The fields' values must be exactly equal to the value you
                  use here. You have the following keys:</para>

                  <itemizedlist>
                    <listitem>
                      <para><option>method</option> :
                      <parameter>exact</parameter></para>
                    </listitem>

                    <listitem>
                      <para><option>value</option> : the exact phrase you want
                      to search</para>
                    </listitem>
                  </itemizedlist>
                </listitem>
              </varlistentry>

              <varlistentry>
                <term>partial</term>

                <listitem>
                  <para>You can just pass the value you want to search. The
                  records returned have that value somewhere in their fields
                  (partial text search). If you want to use the hash array
                  format you have the following keys:</para>

                  <itemizedlist>
                    <listitem>
                      <para><option>method</option> :
                      <parameter>partial</parameter></para>
                    </listitem>

                    <listitem>
                      <para><option>value</option> : the partial phrase you
                      want to search</para>
                    </listitem>
                  </itemizedlist>
                </listitem>
              </varlistentry>

              <varlistentry>
                <term>between</term>

                <listitem>
                  <para>Returns records whose field value is inside the space
                  between two dates, inclusive. You have the following
                  keys:</para>

                  <itemizedlist>
                    <listitem>
                      <para><option>method</option> :
                      <parameter>between</parameter></para>
                    </listitem>

                    <listitem>
                      <para><option>from</option> : Left barrier of the date
                      space</para>
                    </listitem>

                    <listitem>
                      <para><option>to</option> : Right barrier of the date
                      space</para>
                    </listitem>
                  </itemizedlist>
                </listitem>
              </varlistentry>

              <varlistentry>
                <term>outside</term>

                <listitem>
                  <para>Returns records whose field value is outside the space
                  between two dates, exclusive. You have the following
                  keys:</para>

                  <itemizedlist>
                    <listitem>
                      <para><option>method</option> :
                      <parameter>outside</parameter></para>
                    </listitem>

                    <listitem>
                      <para><option>from</option> : Left barrier of the number
                      space</para>
                    </listitem>

                    <listitem>
                      <para><option>to</option> : Right barrier of the number
                      space</para>
                    </listitem>
                  </itemizedlist>
                </listitem>
              </varlistentry>

              <varlistentry>
                <term>interval</term>

                <listitem>
                  <warning>
                    <para>This method currently only works with MySQL.</para>
                  </warning>

                  <para>Returns records whose field value is following an
                  interval (arithmetical progression)</para>

                  <itemizedlist>
                    <listitem>
                      <para><option>method</option> :
                      <parameter>interval</parameter></para>
                    </listitem>

                    <listitem>
                      <para><option>value</option> : The starting value of the
                      interval</para>
                    </listitem>

                    <listitem>
                      <para><option>interval</option> : The interval period.
                      The interval can either be a string or an array. As a
                      string it contains a sign (+ to go to the future or - to
                      go to the past), the numeric portion of the interval
                      period and the actual interval (days, months, years,
                      weeks). For example:</para>

                      <para><parameter>+1 month</parameter> to search for
                      values every one month in the future or <parameter>-1
                      month</parameter> to search for values every one month
                      in the past</para>

                      <para>As an array it can look like this array('sign'
                      =&gt; '+', 'value' =&gt; '1', 'unit' =&gt;
                      'month')</para>
                    </listitem>
                  </itemizedlist>
                </listitem>
              </varlistentry>
            </variablelist>
          </section>

          <section xml:id="fofmodel-behaviours-language">
            <title>language</title>

            <para>Adding this behaviour to a model object filters the
            front-end output by language, displaying only the items whose
            language matches the currently enabled front-end language.
            Obviously this only has an effect on multi-lingual sites when the
            Joomla! language filter plugin is enabled.</para>

            <important>
              <para>This behaviour requires the <code>language</code> magic field.</para>
            </important>
          </section>

          <section xml:id="fofmodel-behaviours-private">
            <title>private</title>

            <para>Adding this behaviour to a model object filters the
            front-end output by the created_by user, showing only items that
            have been created by the currently logged in user. Items not
            created by the current user will not be displayed.</para>

            <important>
              <para>This behaviour requires the <code>created_by</code> magic field.</para>
            </important>
          </section>
        </section>

        <section xml:id="fofmodel-behaviours-add">
          <title>Adding an Existing Behavior to a Model</title>

          <para>There are 5 ways to add a behavior to a model:</para>

          <para>1. Using the <property>default_behaviors</property> property
          of the model. This property is an array of behavior names to load
          upon the model construction. By default it contains only the filters
          behavior. You can override it with your preferred behavior in your
          model class declaration:</para>

          <programlisting language="php">class FoobarModelTodos extends F0FModel {

    protected $default_behaviors = array('filters', 'access', 'enabled');

}
</programlisting>

          <para>2. Passing it into the <parameter>$config</parameter>
          parameter for the constructor of your model class:</para>

          <programlisting language="php">class FoobarModelTodos extends F0FModel {

    public function __construct($config = array()) {
        if (!isset($config['behaviors'])) {
            $config['behaviors'] = array('filters', 'access', 'enabled');
        }

        parent::__construct($config);
    }

}
</programlisting>

          <para>3. Passing it when you create the model instance through the
          <parameter>config</parameter> parameter:</para>

          <programlisting language="php">$model = F0FModel::getTmpInstance('Todos', 'FoobarModel', array(
    'behaviors' =&gt; array('filters', 'access', 'enabled'))
);</programlisting>

          <para>4. Adding it dynamically using the method
          <methodname>addBehavior</methodname></para>

          <programlisting language="php">class FoobarModelTodos extends F0FModel {

    public function __construct($config = array()) {
        parent::__construct($config);

        if ($iWantToAddIt) {
            $this-&gt;addBehavior('enabled');
        }
    }

}</programlisting>

          <para>5. Adding it on the view inside <filename>fof.xml</filename></para>

          <programlisting language="xml">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;fof&gt;
    &lt;frontend&gt;
        &lt;view name="todos"&gt;
            &lt;config&gt;
                &lt;option name="behaviors"&gt;filter,access,enabled&lt;/option&gt;
            &lt;/config&gt;
        &lt;/view&gt;
    &lt;/frontend&gt;
&lt;/fof&gt;</programlisting>
        </section>

        <section xml:id="fofmodel-behaviours-create-new">
          <title>Creating a new Behavior</title>

          <para>You can create custom behaviors for your component. It's very
          important how you name it, because FOF will search for your
          behaviors based on their name.</para>

          <para>If you want to add a <code>bar</code> behavior in a 
          <code>foo</code> component, FOF will search for it in the following order:
          </para>

          <orderedlist>
            <listitem>
              <para>First look for <classname>ComponentnameModelViewnameBehaviorName
              </classname> (ie: <classname>FoobarModelTodosBar</classname>)</para>

              <para>Caution, the <code>Viewname</code> part MUST be plural.</para>
            </listitem>

            <listitem>
              <para>Then look for <classname>ComponentnameModelBehaviorName
              </classname> (ie: <classname>FoobarModelBar</classname>)</para>
            </listitem>

            <listitem>
              <para>Then look for <classname>F0FModelBehaviorBehaviorName</classname>
              (ie: <classname>F0FModelBehaviorBar</classname>)</para>
            </listitem>
          </orderedlist>

          <para>This allows you to create model specific behaviors and also
          component-wide ones.</para>

          <para>It's also possible to override already existing behaviors, by
          naming them correctly (ie: you can override the <code>enabled</code>
          behavior by creating a new class called
          <classname>FoobarModelBehaviorEnabled</classname>).</para>

          <important>
            <para>The behaviors are not automatically loaded, so you need
            to provide your own autoloader or simply load the classes in the
            constructor of your Model before calling <code>parent::__construct(…)</code>
            .</para>
          </important>
        </section>

        <section xml:id="fofmodel-behaviours-available">
          <title>Available Events for Model Behaviors</title>

          <para>In each model behavior you can inject into the workflow using
          these methods:</para>

          <programlisting language="php">/**
 * This event runs before saving data in the model
 *
 * @param   F0FModel  &amp;$model  The model which calls this event
 * @param   array     &amp;$data   The data to save
 *
 * @return  void
 */
public function onBeforeSave(&amp;$model, &amp;$data)
{
}

/**
 * This event runs before deleting a record in a model
 *
 * @param   F0FModel  &amp;$model  The model which calls this event
 *
 * @return  void
 */
public function onBeforeDelete(&amp;$model)
{
}

/**
 * This event runs before copying a record in a model
 *
 * @param   F0FModel  &amp;$model  The model which calls this event
 *
 * @return  void
 */
public function onBeforeCopy(&amp;$model)
{
}

/**
 * This event runs before publishing a record in a model
 *
 * @param   F0FModel  &amp;$model  The model which calls this event
 *
 * @return  void
 */
public function onBeforePublish(&amp;$model)
{
}

/**
 * This event runs before registering a hit on a record in a model
 *
 * @param   F0FModel  &amp;$model  The model which calls this event
 *
 * @return  void
 */
public function onBeforeHit(&amp;$model)
{
}

/**
 * This event runs before moving a record in a model
 *
 * @param   F0FModel  &amp;$model  The model which calls this event
 *
 * @return  void
 */
public function onBeforeMove(&amp;$model)
{
}

/**
 * This event runs before changing the records' order in a model
 *
 * @param   F0FModel  &amp;$model  The model which calls this event
 *
 * @return  void
 */
public function onBeforeReorder(&amp;$model)
{
}

/**
 * This event runs when we are building the query used to fetch a record
 * list in a model
 *
 * @param   F0FModel        &amp;$model  The model which calls this event
 * @param   JDatabaseQuery  &amp;$query  The query being built
 *
 * @return  void
 */
public function onBeforeBuildQuery(&amp;$model, &amp;$query)
{
}

/**
 * This event runs after saving a record in a model
 *
 * @param   F0FModel  &amp;$model  The model which calls this event
 *
 * @return  void
 */
public function onAfterSave(&amp;$model)
{
}

/**
 * This event runs after deleting a record in a model
 *
 * @param   F0FModel  &amp;$model  The model which calls this event
 *
 * @return  void
 */
public function onAfterDelete(&amp;$model)
{
}

/**
 * This event runs after copying a record in a model
 *
 * @param   F0FModel  &amp;$model  The model which calls this event
 *
 * @return  void
 */
public function onAfterCopy(&amp;$model)
{
}

/**
 * This event runs after publishing a record in a model
 *
 * @param   F0FModel  &amp;$model  The model which calls this event
 *
 * @return  void
 */
public function onAfterPublish(&amp;$model)
{
}

/**
 * This event runs after registering a hit on a record in a model
 *
 * @param   F0FModel  &amp;$model  The model which calls this event
 *
 * @return  void
 */
public function onAfterHit(&amp;$model)
{
}

/**
 * This event runs after moving a record in a model
 *
 * @param   F0FModel  &amp;$model  The model which calls this event
 *
 * @return  void
 */
public function onAfterMove(&amp;$model)
{
}

/**
 * This event runs after reordering records in a model
 *
 * @param   F0FModel  &amp;$model  The model which calls this event
 *
 * @return  void
 */
public function onAfterReorder(&amp;$model)
{
}

/**
 * This event runs after we have built the query used to fetch a record
 * list in a model
 *
 * @param   F0FModel        &amp;$model  The model which calls this event
 * @param   JDatabaseQuery  &amp;$query  The model which calls this event
 *
 * @return  void
 */
public function onAfterBuildQuery(&amp;$model, &amp;$query)
{
}

/**
 * This event runs after getting a single item
 *
 * @param   F0FModel  &amp;$model   The model which calls this event
 * @param   F0FTable  &amp;$record  The record loaded by this model
 *
 * @return  void
 */
public function onAfterGetItem(&amp;$model, &amp;$record)
{
}</programlisting>
        </section>

        <section xml:id="fofmodel-behaviours-example">
          <title>New Behavior Example: Published</title>

          <para>Let's create a behavior for our component called Published,
          that will filter the items based on the publish_up and pulish_down
          fields of a table.</para>

          <programlisting language="php">class F0FModelBehaviorPublished extends F0FModelBehavior
{
    /**
     * Let's add the filter for the publish_up and publish_down fields here, after the query is built by the model
     *
     * @param   F0FModel        &amp;$model  The model which calls this event
     * @param   JDatabaseQuery  &amp;$query  The model which calls this event
     *
     * @return  void
     */
    public function onAfterBuildQuery(&amp;$model, &amp;$query)
    {
        // This behavior only applies to the front-end.
        if (!F0FPlatform::getInstance()-&gt;isFrontend())
        {
            return;
        }

        // Get the name of the publish_up field (support for aliases)
        $table = $model-&gt;getTable();
        $publishUpField = $table-&gt;getColumnAlias('publish_up');

        // Get the name of the publish_down field (support for aliases)
        $publishDownField = $table-&gt;getColumnAlias('publish_down');

        // Make sure the fields actually exist
        $publishUpExists = in_array($publishUpField, $table-&gt;getKnownFields());

        $publishDownExists = in_array($publishDownField, $table-&gt;getKnownFields());

        // If they both do no exist, exit, we cannot apply the behavior
        if (!$publishUpExists &amp;&amp; !$publishDownExists)
        {
            return;
        }

        // Get the current date
        $now = new JDate()
        $now = $now-&gt;toSql();

        $db = JFactory::getDbo();

        // Filter by publish up first
        if ($publishUpExists) {
            $query-&gt;where($db-&gt;qn($publishUpField) . ' &lt;= ' . $db-&gt;q($now));
        }

        // Filter by publish down
        if ($publishDownExists) {
            $query-&gt;where($db-&gt;qn($publishDownField) . ' &gt;= ' . $db-&gt;q($now));
        }
    }

    /**
     * Voids the getItem result if the loaded item wasn't published
     *
     * @param   F0FModel  &amp;$model   The model which was called
     * @param   F0FTable  &amp;$record  The record loaded from the databae
     *
     * @return  void
     */
    public function onAfterGetItem(&amp;$model, &amp;$record)
    {
        if ($record instanceof F0FTable)
        {
            // This behavior only applies to the front-end.
            if (!F0FPlatform::getInstance()-&gt;isFrontend())
            {
                return;
            }

            // Get the name of the publish_up field (support for aliases)
            $publishUpField = $record-&gt;getColumnAlias('publish_up');

            // Get the name of the publish_down field (support for aliases)
            $publishDownField = $record-&gt;getColumnAlias('publish_down');

            // Make sure the fields actually exist
            $publishUpExists = in_array($publishUpField, $record-&gt;getKnownFields());

            $publishDownExists = in_array($publishDownField, $record-&gt;getKnownFields());

            // If they both do no exist, exit, we cannot apply the behavior
            if (!$publishUpExists &amp;&amp; !$publishDownExists)
            {
                return;
            }

            // Get the current date
            $now = new JDate()
            $now = $now-&gt;toSql();

            if ($publishUpExists) {
                $publish_up = new JDate($record-&gt;$publishUpField);
                if ($publish_up &gt; $now) {
                    $record = null;
                    return;
                }
            }

            if ($publishDownExists) {
                $publish_down = new JDate($record-&gt;$publishDownField);
                if ($publish_down &lt; $now) {
                    $record = null;
                    return;
                }
            }
        }
    }
}
</programlisting>
        </section>
      </section>
    </section>

    <section xml:id="foftable">
      <title>Tables</title>

      <para>Tables are strange beasts. They are part data adapter, part model
      and part controller. Confused? They are used to create an object
      representing a single record of a database table. They're typically used
      to check the validity of a record before saving it to the database and
      post-process a record when reading it from the database (e.g.
      unserialise a field which contains serialised or JSON data). They can
      come in very handy to perform automated ("magic") actions when creating
      / modifying / loading a database record.</para>

      <bridgehead>Class and file naming conventions</bridgehead>

      <para>The conventions for naming the table classes is
      <classname>ComponentTableView</classname>, e.g.
      <classname>TodoTableItem</classname> for a component named
      <code>com_todo</code> and a view named <code>items</code>. The last part
      MUST be singular. It's logical: a table class operates on a single
      record, ergo it's singular.</para>

      <para>The table file MUST match the last part of the class name. This
      means that the file for <classname>TodoTableItem</classname> MUST be
      <filename>item.php</filename>.</para>

      <para>All Table files are located in your component's
      <filename>tables</filename> directories in the back-end. If the Table
      class is not loaded and a suitable file cannot be found FOF will fall
      back to creating a suitable configure instance of F0FTable, using
      convention over configuration (explained below) to determine what the
      table object should do.</para>

      <bridgehead>Database table naming conventions</bridgehead>

      <para>It's exactly as described in the Model reference.</para>

      <bridgehead>Magic fields</bridgehead>

      <para>Magic fields have special meaning for FOF. They are:</para>

      <variablelist>
        <varlistentry>
          <term>title</term>

          <listitem>
            <para>The title of an item. It's used for creating a slug.</para>
          </listitem>
          <itemizedlist>
            <listitem>
              <para>required :
              <parameter>slug</parameter></para>
            </listitem>
          </itemizedlist>
        </varlistentry>

        <varlistentry>
          <term>slug</term>

          <listitem>
            <para>That's the alias of an item, typically used as part of
            generated URLs by your components. By default, it will be
            generated out of the title using a very basic transliteration
            algorithm.</para>
          </listitem>
          <itemizedlist>
            <listitem>
              <para>required :
              <parameter>title</parameter></para>
            </listitem>
          </itemizedlist>
        </varlistentry>

        <varlistentry>
          <term>enabled</term>

          <listitem>
            <para>Is this record published or not? It's like the published
            column in core Joomla! components, but usually it is only supposed
            to take values of 0 (disabled) and 1 (enabled).</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>ordering</term>

          <listitem>
            <para>The sort order of the record.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>created_by</term>

          <listitem>
            <para>The ID of the user who created the record. Handled
            automatically by FOF.</para>
          </listitem>
          <itemizedlist>
            <listitem>
              <para>required :
              <parameter>created_on</parameter></para>
            </listitem>
          </itemizedlist>
        </varlistentry>

        <varlistentry>
          <term>created_on</term>

          <listitem>
            <para>The date when the record was created. Handled automatically
            by FOF.</para>
          </listitem>
          <itemizedlist>
            <listitem>
              <para>required :
              <parameter>created_by</parameter></para>
            </listitem>
          </itemizedlist>
        </varlistentry>

        <varlistentry>
          <term>modified_by</term>

          <listitem>
            <para>The ID of the user who last modified the record. Handled
            automatically by FOF.</para>
          </listitem>
          <itemizedlist>
            <listitem>
              <para>required :
              <parameter>created_by</parameter>, <parameter>created_on</parameter>, <parameter>modified_on</parameter></para>
            </listitem>
          </itemizedlist>
        </varlistentry>

        <varlistentry>
          <term>modified_on</term>

          <listitem>
            <para>The date when the record was last modified. Handled
            automatically by FOF.</para>
          </listitem>
          <itemizedlist>
            <listitem>
              <para>required :
              <parameter>created_by</parameter>, <parameter>created_on</parameter>, <parameter>modified_by</parameter></para>
            </listitem>
          </itemizedlist>
        </varlistentry>

        <varlistentry>
          <term>locked_by</term>

          <listitem>
            <para>The ID of the user who locked (checked out) the record for
            editing. Handled automatically by FOF.</para>
          </listitem>
          <itemizedlist>
            <listitem>
              <para>required :
              <parameter>locked_on</parameter></para>
            </listitem>
          </itemizedlist>
        </varlistentry>

        <varlistentry>
          <term>locked_on</term>

          <listitem>
            <para>The date when the record was locked (checked out) for
            editing. Handled automatically by FOF.</para>
          </listitem>
          <itemizedlist>
            <listitem>
              <para>required :
              <parameter>locked_by</parameter></para>
            </listitem>
          </itemizedlist>
        </varlistentry>

        <varlistentry>
          <term>hits</term>

          <listitem>
            <para>How many read hits this record has received. Handled
            automatically by FOF.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>language</term>

          <listitem>
            <para>The language of the record if you want a multi-lingual
            site.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>asset_id</term>

          <listitem>
            <para>The ID in the #__assets table for the record. Handled
            automatically by FOF. Only required if you want per item ACL
            privileges.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>access</term>

          <listitem>
            <para>Viewing access level</para>
          </listitem>
        </varlistentry>
      </variablelist>

      <para>You can always customise the magic fields' names in your Table
      class using the <property>setColumnAlias</property> method. For example,
      if your column is named <database>published</database> instead of
      <database>enabled</database>:</para>

      <programlisting language="php">function __construct($table, $key, $db, $config)
{
    $this-&gt;setColumnAlias('enabled', 'published');
        
    parent::__construct($table, $key, $db, $config);
}</programlisting>

      <para>Now FOF will know that the <database>published</database> column
      contains the publish status of the record. This comes in handy when
      you're upgrading a component from POJ (plain old Joomla!) to FOF.</para>

      <para><important>
          <para>We strongly suggest to set these alias inside the table
          constructor and more specifically <emphasis
          role="bold">before</emphasis> calling the parent constructor. In
          this way, FOF will know everything about your table and can set some
          automatic feature, like asset tracking.</para>
        </important></para>

      <bridgehead>Using joined tables</bridgehead>

      <para>Quite often you can have tables that are linked together, while
      you can setup joins in the list view acting on the
      <methodname>buildQuery</methodname>, sometimes you need these joined
      fields while using the table.</para>

      <para>To do that you can simply create the join query, pass it to the
      <classname>F0FTable</classname> in the construction and you're done! FOF
      will do the rest.</para>

      <para>Let's see it in action with a real an example. Let's you have the
      table <database>foo</database> linked to the table
      <database>bar</database>:</para>

      <table>
        <title>Table foo</title>

        <tgroup cols="2">
          <thead>
            <row>
              <entry>foo_id</entry>

              <entry>title</entry>
            </row>
          </thead>

          <tbody>
            <row>
              <entry>1</entry>

              <entry>First row</entry>
            </row>

            <row>
              <entry>2</entry>

              <entry>Second row</entry>
            </row>
          </tbody>
        </tgroup>
      </table>

      <table>
        <title>Table bar</title>

        <tgroup cols="4">
          <thead>
            <row>
              <entry align="center">bar_id</entry>

              <entry align="center">title</entry>

              <entry align="center">barfield</entry>

              <entry align="center">foo_id</entry>
            </row>
          </thead>

          <tbody>
            <row>
              <entry>1</entry>

              <entry>Bar table title 1</entry>

              <entry>Unique column name field 1</entry>

              <entry>1</entry>
            </row>

            <row>
              <entry>2</entry>

              <entry>Bar table title 2</entry>

              <entry>Unique column name field 2</entry>

              <entry>2</entry>
            </row>
          </tbody>
        </tgroup>
      </table>

      <para>In plain sql you should do something like this:</para>

      <programlisting language="sql">SELECT jos_foo.*, jos_bar.title as bar_title, barfield
FROM jos_foo
INNER JOIN jos_bar ON jos_bar.foo_id = jos_foo.foo_id
WHERE jos_foo.foo_id = 1
</programlisting>

      <para>When setting up the table, FOF already does a query like
      this:</para>

      <programlisting language="sql">SELECT jos_foo.*
FROM jos_foo
WHERE jos_foo.foo_id = 1
</programlisting>

      <para>So we just have to "inject" the join part. We can do that
      extending the <classname>F0FTable</classname>, creating a query using
      Joomla! object and then assigning it to the table:</para>

      <programlisting language="php">&lt;?php
class FoobarTableFoo extends F0FTable
{
  public function __construct($table, $key, &amp;$db)
  {
      $query = $db-&gt;getQuery(true)
                  -&gt;select(array($db-&gt;qn('#__bar').'.'.$db-&gt;qn('title').' as '.$db-&gt;qn('bar_title')))
                  -&gt;select('barfield')
                  -&gt;innerJoin('#__bar ON #__bar.foo_id = #__foo.foo_id');

      $this-&gt;setQueryJoin($query);

      parent::__construct($table, $key, $db);
  }
}
</programlisting>

      <para>As you can see, it's quite easy to setup: you just have to create
      a query with no <database>from</database> clause (FOF will use the
      current table one) and you are free to compose as you want. You can
      quote columns names, table names, using column or table alias (and quote
      them or not) and so on: it's just a regular query. FOF will now
      automatically know of all fields in your joined table query.</para>

      <bridgehead>Customising a specialised class</bridgehead>

      <para>Unlike plain old Joomla! you are NOT supposed to copy and paste
      code when dealing with FOF. Our rule of thumb is that if you ever find
      yourself copying code from <classname>F0FTable</classname> into your
      extension's specialised table class you're doing it wrong.</para>

      <para>FOF tables can be customised very easily using the
      <methodname>onBefore<replaceable>Something</replaceable></methodname> /
      <methodname>onAfter<replaceable>Something</replaceable></methodname>
      methods. The <replaceable>Something</replaceable> is the name of the
      table method they are related to. For example,
      <methodname>onBeforeBind</methodname> runs before the
      <methodname>bind()</methodname> method executes its actions and
      <methodname>onAfterBind</methodname> runs right after the
      <methodname>bind()</methodname> method executes its actions. Specific
      implementation notes for each case can be found in the docblocks of each
      event method.</para>

      <bridgehead>Customising using plugins</bridgehead>

      <para>You can customise the actions of tables by using standard
      "<filename>system</filename>" plugins. <classname>F0FTable</classname>
      will automatically create plugin events using a fixed naming prefix and
      appending them with the last part of the table's name. For example, if
      you have a table called <classname>TodoTableItem</classname> FOF will
      attempt to run a system plugin event called
      <methodname>onBeforeBindItem</methodname>. For the sake of documentation
      we will be using the suffix <replaceable>TABLENAME</replaceable>.</para>

      <para>The obvious drawback is the possibility of naming clashes. For
      example, given two tables <classname>TodoTableItem</classname> and
      <classname>ContactusTableItem</classname> the event to be called before
      binding data to either table is called
      <methodname>onBeforeBindItem</methodname>. How can you distinguish
      between the two cases? The first parameter passed to the plugin event
      handler is a reference to the table object itself, by convention called
      <parameter>$table</parameter>. You can do a
      <code>$table-&gt;getTableName()</code> which returns something like
      <code>#__todo_items</code>. Just check if it's the database table you
      expect to be interacting with. If not, just return true to let FOF do
      its thing uninterrupted.</para>

      <para>The complete list of events is:</para>

      <variablelist>
        <varlistentry>
          <term>onBeforeBind<replaceable>TABLENAME</replaceable></term>

          <listitem>
            <para>is triggered before binding data from an array/object to the
            table object.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>onAfterLoad<replaceable>TABLENAME</replaceable></term>

          <listitem>
            <para>is triggered after a record is loaded</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>onBeforeStore<replaceable>TABLENAME</replaceable></term>

          <listitem>
            <para>is triggered before a record is saved to the table</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>onAfterStore<replaceable>TABLENAME</replaceable></term>

          <listitem>
            <para>is triggered after a record has been saved to the
            table</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>onBeforeMove<replaceable>TABLENAME</replaceable></term>

          <listitem>
            <para>is triggered before a single record is moved
            (reordered)</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>onAfterMove<replaceable>TABLENAME</replaceable></term>

          <listitem>
            <para>is triggered after a single record is moved
            (reordered)</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>onBeforeReorder<replaceable>TABLENAME</replaceable></term>

          <listitem>
            <para>is triggered before a new ordering is applied to multiple
            records of the table</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>onAfterReorder<replaceable>TABLENAME</replaceable></term>

          <listitem>
            <para>is triggered before a new ordering is applied to multiple
            records of the table</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>onBeforeDelete<replaceable>TABLENAME</replaceable></term>

          <listitem>
            <para>is triggered before a record is deleted</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>onAfterDelete<replaceable>TABLENAME</replaceable></term>

          <listitem>
            <para>is triggered after a record has been deleted</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>onBeforeHit<replaceable>TABLENAME</replaceable></term>

          <listitem>
            <para>is triggered before registering a read hit on a
            record</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>onAfterHit<replaceable>TABLENAME</replaceable></term>

          <listitem>
            <para>is triggered after registering a read hit on a record</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>onBeforeCopy<replaceable>TABLENAME</replaceable></term>

          <listitem>
            <para>is triggered before copying (duplicating) a record</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>onAfterCopy<replaceable>TABLENAME</replaceable></term>

          <listitem>
            <para>is triggered after copying (duplicating) a record</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>onBeforePublish<replaceable>TABLENAME</replaceable></term>

          <listitem>
            <para>is triggered before publishing a record</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>onAfterReset<replaceable>TABLENAME</replaceable></term>

          <listitem>
            <para>is triggered after we have reset the table object's
            state</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>onBeforeReset<replaceable>TABLENAME</replaceable></term>

          <listitem>
            <para>is triggered before resetting the table object's
            state</para>
          </listitem>
        </varlistentry>
      </variablelist>

      <para>If you return boolean false from an
      <methodname>onBefore</methodname> event the operation is
      cancelled.</para>

      <para>As you can easily understand this is an extremely powerful feature
      as it allows end users and site integrators (of a power user level,
      granted) to modify or extend the behaviour of FOF-powered extensions
      with great ease.</para>

      <section xml:id="foftable-behaviors">
        <title>Table Behaviors</title>

        <section xml:id="foftable-behaviors-introduction">
          <title>Introduction</title>

          <para>Tables can implement complex, reusable functionality using
          behaviours. Table Behaviors are an handy way to alter the workflow of a
          F0FTable. It's based upon the standard Joomla Event system.</para>

          <para>Before and After certain actions (<classname>onBefore*</classname>
          / <classname>onAfter*</classname>) the table triggers an
          "event" which is propagated to each of the registered behaviors for
          that table. They can then, by registering to these events, alter the
          way the action itself is performed.</para>

          <para>It's possible to register different behaviors per table; they
          can be added by default, or even on the fly, after the table is
          created.</para>

          <para>FOF already provides a list of common behaviors, that can be
          used by any F0FTable object. The bundled behaviour classes are currently
          located inside FOF's <filename>table/behavior</filename> directory.
          By default, only the <filename>assets</filename> and
          <filename>tags</filename> behaviour are being loaded</para>
        </section>

        <section xml:id="foftable-behaviors-standard">
          <title>FOF Standard Behaviors</title>

          <variablelist>
            <varlistentry>
              <term>assets</term>

              <listitem>
                <para>This behavior (added by default by FOF) manages the
                assets for a resource if the asset_id field (or an alias for
                it) is set for the table</para>
              </listitem>
            </varlistentry>

            <varlistentry>
              <term>contenthistory</term>

              <listitem>
                <para>This behavior manages the content history related to the
                current resource</para>
                
                <important>
                  <para>This behavior requires a parameter <code>save_history</code>
                  on your component parameters <filename>config.xml</filename>.</para>
                </important>
              </listitem>
            </varlistentry>

            <varlistentry>
              <term>tags</term>

              <listitem>
                <para>This behavior (added by default by FOF) deals with tags
                related to the current resource. It will be applied only if
                the hasTags property is set to true.</para>
              </listitem>
            </varlistentry>
          </variablelist>
        </section>

        <section xml:id="foftable-behaviors-add">
          <title>Add an existing Behavior to a Table</title>

          <para>There are 5 ways to add a behavior to a table:</para>

          <itemizedlist>
            <listitem>
              <para>Using the <property>default_behaviors</property> property
              of the table. This property is an array of behavior names to
              load upon the table construction. By default it contains the
              tags and the assets behaviors. You can override it with your
              preferred behavior in your table class declaration:</para>

              <programlisting language="php">class FoobarTableTodo extends FOFtable {

    protected $default_behaviors = array('tags');

}</programlisting>
            </listitem>

            <listitem>
              <para>Passing it into the <parameter>$config</parameter>
              parameter for the constructor of your table
              class:<programlisting language="php">class FoobarTableTodo extends FOFtable {

    public function __construct($config = array()) {
        if (!isset($config['behaviors'])) {
            $config['behaviors'] = array('tags');
        }

        parent::__construct($config);
    }

}</programlisting></para>
            </listitem>

            <listitem>
              <para>Passing it when you create the table instance through the
              <parameter>config</parameter> parameter:</para>

              <programlisting language="php">$model = F0FTable::getTmpInstance('Todo', 'FoobarTable', array('behaviors' =&gt; array('tags')));</programlisting>
            </listitem>

            <listitem>
              <para>Adding it dynamically using the method
              <methodname>addBehavior</methodname>:</para>

              <programlisting language="php">class FoobarTableTodo extends FOFtable {

    public function __construct($config = array()) {
        parent::__construct($config);

        if ($iWantToAddIt) {
            $this-&gt;addBehavior('tags');
        }
    }

}</programlisting>
            </listitem>

            <listitem>
              <para>Adding it on the view inside <filename>fof.xml</filename>:</para>

              <programlisting language="xml">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;fof&gt;
    &lt;common&gt;
        &lt;table name="todo"&gt;
            &lt;behaviors&gt;tags&lt;/behaviors&gt;
        &lt;/table&gt;
    &lt;/common&gt;
&lt;/fof&gt;</programlisting>
            </listitem>
          </itemizedlist>
        </section>

        <section xml:id="foftable-behaviors-create-new">
          <title>Creating a new Behavior</title>

          <para>You can create custom behaviors for your component. It's very
          important how you name it, because FOF will search for your
          behaviors based on their name.</para>

          <para>If you want to add a <replaceable>bar</replaceable>
          behavior, FOF will search for it in the following order:</para>

          <itemizedlist>
            <listitem>
              <para>First look for <classname>ComponentnameTableViewnameBehaviorName</classname>
              (ie: <classname>FoobarTableTodosBar</classname>)</para>

              <para>Caution, the <code>Viewname</code> part MUST be singular.</para>
            </listitem>

            <listitem>
              <para>Then look for <classname>ComponentnameTableBehaviorName</classname>
              (ie: <classname>FoobarTableBar</classname>)</para>
            </listitem>

            <listitem>
              <para>Then look for <classname>F0FTableBehaviorBehaviorName</classname>
              (ie: <classname>F0FTableBehaviorBar</classname>)</para>
            </listitem>
          </itemizedlist>

          <para>This allows you to create table specific behaviors and also
          component-wide ones.</para>

          <para>It's also possible to override already existing behaviors, by
          naming them correctly (ie: you can override the <code>tags</code>
          behavior by creating a new class called
          <classname>FoobarTableBehaviorTags</classname>).</para>

          <important>
            <para>The behaviors are not automatically loaded, so you need
            to provide your own autoloader or simply load the classes in the
            constructor of your Table before calling <code>parent::__construct(…)</code>
            .</para>
          </important>
        </section>

        <section xml:id="foftable-behaviors-available">
          <title>Available Events for Table Behaviors</title>

          <para>In each table behavior you can inject into the workflow using
          these methods:</para>

          <programlisting language="php">/**
 * This event runs before binding data to the table
 *
 * @param   F0FTable  &amp;$table  The table which calls this event
 * @param   array     &amp;$data   The data to bind
 *
 * @return  boolean  True on success
 */
public function onBeforeBind(&amp;$table, &amp;$data)
{
    return true;
}

/**
 * The event which runs after binding data to the table
 *
 * @param   F0FTable  &amp;$table  The table which calls this event
 * @param   object|array  &amp;$src  The data to bind
 *
 * @return  boolean  True on success
 */
public function onAfterBind(&amp;$table, &amp;$src)
{
    return true;
}

/**
 * The event which runs after loading a record from the database
 *
 * @param   F0FTable  &amp;$table  The table which calls this event
 * @param   boolean  &amp;$result  Did the load succeeded?
 *
 * @return  void
 */
public function onAfterLoad(&amp;$table, &amp;$result)
{

}

/**
 * The event which runs before storing (saving) data to the database
 *
 * @param   F0FTable  &amp;$table  The table which calls this event
 * @param   boolean  $updateNulls  Should nulls be saved as nulls (true) or just skipped over (false)?
 *
 * @return  boolean  True to allow saving
 */
public function onBeforeStore(&amp;$table, $updateNulls)
{
    return true;
}

/**
 * The event which runs after storing (saving) data to the database
 *
 * @param   F0FTable  &amp;$table  The table which calls this event
 * 
 * @return  boolean  True to allow saving without an error
 */
public function onAfterStore(&amp;$table)
{
    return true;
}

/**
 * The event which runs before moving a record
 *
 * @param   F0FTable  &amp;$table  The table which calls this event
 * @param   boolean  $updateNulls  Should nulls be saved as nulls (true) or just skipped over (false)?
 *
 * @return  boolean  True to allow moving
 */
public function onBeforeMove(&amp;$table, $updateNulls) 
{
    return true;
}

/**
 * The event which runs after moving a record
 *
 * @param   F0FTable  &amp;$table  The table which calls this event
 * 
 * @return  boolean  True to allow moving without an error
 */
public function onAfterMove(&amp;$table)
{
    return true;
}

/**
 * The event which runs before reordering a table
 *
 * @param   F0FTable  &amp;$table  The table which calls this event
 * @param   string  $where  The WHERE clause of the SQL query to run on reordering (record filter)
 *
 * @return  boolean  True to allow reordering
 */
public function onBeforeReorder(&amp;$table, $where = '')
{
    return true;
}

/**
 * The event which runs after reordering a table
 *
 * @param   F0FTable  &amp;$table  The table which calls this event
 * 
 * @return  boolean  True to allow the reordering to complete without an error
 */
public function onAfterReorder(&amp;$table)
{
    return true;
}

/**
 * The event which runs before deleting a record
 *
 * @param   F0FTable &amp;$table  The table which calls this event
 * @param   integer  $oid  The PK value of the record to delete
 *
 * @return  boolean  True to allow the deletion
 */
public function onBeforeDelete(&amp;$table, $oid)
{
    return true;
}

/**
 * The event which runs after deleting a record
 *
 * @param   F0FTable &amp;$table  The table which calls this event
 * @param   integer  $oid  The PK value of the record which was deleted
 *
 * @return  boolean  True to allow the deletion without errors
 */
public function onAfterDelete(&amp;$table, $oid)
{
    return true;
}

/**
 * The event which runs before hitting a record
 *
 * @param   F0FTable &amp;$table  The table which calls this event
 * @param   integer  $oid  The PK value of the record to hit
 * @param   boolean  $log  Should we log the hit?
 *
 * @return  boolean  True to allow the hit
 */
public function onBeforeHit(&amp;$table, $oid, $log)
{
    return true;
}

/**
 * The event which runs after hitting a record
 *
 * @param   F0FTable &amp;$table  The table which calls this event
 * @param   integer  $oid  The PK value of the record which was hit
 *
 * @return  boolean  True to allow the hitting without errors
 */
public function onAfterHit(&amp;$table, $oid)
{
    return true;
}

/**
 * The even which runs before copying a record
 *
 * @param   F0FTable &amp;$table  The table which calls this event
 * @param   integer  $oid  The PK value of the record being copied
 *
 * @return  boolean  True to allow the copy to take place
 */
public function onBeforeCopy(&amp;$table, $oid)
{
    return true;
}

/**
 * The even which runs after copying a record
 *
 * @param   F0FTable &amp;$table  The table which calls this event
 * @param   integer  $oid  The PK value of the record which was copied (not the new one)
 *
 * @return  boolean  True to allow the copy without errors
 */
public function onAfterCopy(&amp;$table, $oid)
{
    return true;
}

/**
 * The event which runs before a record is (un)published
 *
 * @param   F0FTable &amp;$table  The table which calls this event
 * @param   integer|array  &amp;$cid     The PK IDs of the records being (un)published
 * @param   integer        $publish  1 to publish, 0 to unpublish
 *
 * @return  boolean  True to allow the (un)publish to proceed
 */
public function onBeforePublish(&amp;$table, &amp;$cid, $publish)
{
    return true;
}

/**
 * The event which runs after the object is reset to its default values.
 *
 * @param   F0FTable &amp;$table  The table which calls this event
 * 
 * @return  boolean  True to allow the reset to complete without errors
 */
public function onAfterReset(&amp;$table)
{
    return true;
}

/**
 * The even which runs before the object is reset to its default values.
 *
 * @param   F0FTable &amp;$table  The table which calls this event
 * 
 * @return  boolean  True to allow the reset to complete
 */
public function onBeforeReset(&amp;$table)
{
    return true;
}</programlisting>
        </section>
      </section>

      <section xml:id="foftable-simpleorm">
        <title>Simple object relation mapping</title>

        <note>
          <para>Available since FOF 2.2.0</para>
        </note>

        <bridgehead>A (very) naïve introduction to ORM – and why this FOF
        feature is not a proper ORM implementation</bridgehead>

        <para>The most common use case for databases is storing data which is
        related to one another. This the cornerstone of relational database
        management systems (RDBMS) such as MySQL, PostgreSQL, Microsoft SQL
        Server and so on. Due to limitations of the shared hosting model we
        tend not to make full use of the relational features of modern
        databases, yet our field naming conventions do denote this aspect of
        our data. Think about a <database>#__foobar_comments</database> table
        having a key named <database>foobar_article_id</database>. You
        immediately understand that each comment record in that table is
        related to an article in a table called
        <database>#__foobar_articles</database>. That's why you end up writing
        code to fetch the comments of an article using F0FModel or the article
        a comment belongs to using F0FTable.</para>

        <para>By doing that, you are implicitly mapping the raw data in the
        database to one or more PHP objects. This is a very primitive data
        mapping operation, as you are mapping scalar values (the raw data)
        into other scalar values (the PHP object's properties) through
        explicit mapping. When you want to map non-scalar values (like the
        comments of an article) you get to do that manually, essentially
        hardcoding this relation into your PHP code. An object-relational
        mapping (ORM, for short) does this automatically. It will map your
        scalar data, what is stored in your database tables, into objects
        which you can manipulate directly without worrying too much about how
        this data is actually stored.</para>

        <para>On the flip side, by using a full blown ORM you are abstracting
        too much. The ORM has to map objects to database tables and the result
        is often unoptimised database tables. By going to the other extreme,
        manually handling all mapping, you are writing more code than you
        should and you make your architecture inflexible.</para>

        <para>FOF follows a middle path. You can tell it how your database
        tables relate to each other and it will provide you with an interface
        to get related objects directly from a F0FTable object. It currently
        supports all three normalised relations:</para>

        <itemizedlist>
          <listitem>
            <para>1:n (one to many). One record of table A is related to zero
            or more records in table B. The easiest way to picture this is
            table A being articles and table B being comments. This relation
            can be expressed in different directions:</para>

            <itemizedlist>
              <listitem>
                <para>Parent. Given a record in table B you get the record in
                table A it belongs to.</para>
              </listitem>

              <listitem>
                <para>Children. Given a record in table A you get the records
                in table B that belong to it.</para>
              </listitem>

              <listitem>
                <para>Siblings. Given a record in table B you get all the
                records in table B that belong to the same record of table A
                that our current record in table B belongs to (it's the
                children of the parent – that's why they're called
                siblings)</para>
              </listitem>
            </itemizedlist>
          </listitem>

          <listitem>
            <para>1:1 (one to one). One record of table A is related to
            exactly zero or one records in table B. It's used mostly to extend
            a table without changing its schema, e.g. add more fields to the
            <database>#__users</database> table. This relation has no implicit
            directionality, but since it's the degenerate case of the 1:n
            relation for n=1 we consider that table A is the parent of table
            B, so this is implemented by defining a child relation on table A
            (or a parent or child relation on table B; it's up to
            you!).</para>
          </listitem>

          <listitem>
            <para>n:n (many to many). One or more records of table A are
            related to zero or more records in table B. The easiest way to
            picture this is table A being users and table B being user groups.
            One user can belong to multiple groups. Many users can belong to
            the same group. The characteristic of this relation is that you
            need a pivot (a.k.a. "glue" or "map") table which tells us which
            record of table A relates to which record of table B. Quite
            obviously there is no directionality in this relation: given a
            record in table A you can get all related records in table B.
            Likewise, given a table in record B you can get all related
            records in table A through the same relation.</para>
          </listitem>
        </itemizedlist>

        <bridgehead>What does it mean to you?</bridgehead>

        <para>Before this feature you would have to write this kind of
        code:</para>

        <programlisting language="php">$article = F0FTable::getTmpInstance('Article', 'FoobarTable');
$article-&gt;load(1);

$model = F0FModel::getTmpInstance('Comments', 'FoobarModel');
$comments = $model-&gt;foobar_article_id($article-&gt;foobar_article_id)-&gt;getList();
foreach ($comments as $commentData)
{
    $commentTable = $model-&gt;getTable();
    $commentTable-&gt;bind($commentData);
    // Work with $commentTable
}</programlisting>

        <para>You can now write</para>

        <programlisting language="php">$article = F0FTable::getTmpInstance('Article', 'FoobarTable');
$article-&gt;load(1);

foreach ($article-&gt;getRelations()-&gt;getChildren('comments') as $commentTable)
{
    // Work with $commentTable
}</programlisting>

        <para>All you need to do is define the relation, either in the
        constructor of your table class or in
        <filename>fof.xml</filename>.</para>

        <para>Even better, relations returning many items use
        F0FDatabaseIterator which means that only one record is loaded in
        memory at a time. When sifting through copious amounts of records this
        decreases your memory consumption considerably.</para>

        <para>The code savings are even more substantial for many-to-many
        relations, but we'll leave that as an exercise to the reader to find
        out why.</para>

        <bridgehead>How do I use it?</bridgehead>

        <para>Each table provides the getRelations() method which returns a
        F0FTableRelations object. By default it's populated with parent
        relations based on field names which follow the FOF naming
        conventions. At any time you can use the add*Relation() methods of
        F0FTableRelations to add any kind of relations. The docblocks in the
        methods explain to you exactly what each parameter does and through
        which method the related tables are made available. We suggest adding
        relations in the constructor (__construct() method) of your
        specialised table class. Alternatively, you can define the relations
        in <filename>fof.xml</filename>.</para>

        <para>From that point you can use the relations anywhere you have an
        instance of that F0FTable object. The best methods for getting a
        F0FTable object are:</para>

        <itemizedlist>
          <listitem>
            <para>Using F0FModel's getIterator. <emphasis role="bold">This is
            the preferred method</emphasis>. Even if you only need the first
            item fetched by the model it is far better for performance and
            memory consumption to use:</para>

            <programlisting language="php">// GOOD - Use this!
$iterator = $model-&gt;getIterator();
$myRecord = $iterator-&gt;current();</programlisting>

            <para>than using the next method presented below.</para>
          </listitem>

          <listitem>
            <para>Using F0FModel's getFirstItem. This method is not
            recommended for performance / resource usage reasons. Keep in mind
            that F0FModel will load the ENTIRE record list, based on its
            state, in memory and return the first item fetched as a F0FTable.
            This can lead to bad performance and excessive memory consumption
            unless you are absolutely sure that F0FModel will only fetch one
            (or, at most, a handful) of items from the database.
            Example:</para>

            <programlisting language="php">$myRecord = $model-&gt;getFirstItem();</programlisting>
          </listitem>

          <listitem>
            <para>Using F0FTable::getAnInstance(). This method is not
            recommended due to the singleton caveat. Remember that the
            returned object is a singleton. If you need to load a new record
            you are required to clone that object, e.g. $table = clone
            F0FTable::getAnInstance('Items', 'FoobarTable');</para>

            <programlisting language="php">// If you forget the clone you will spend some not-so-fun hours debugging erratic behaviour
$myRecord = <emphasis role="bold">clone</emphasis> F0FTable::getAnInstance('Items', 'FoobarTable');
$myRecord-&gt;load(123);</programlisting>
          </listitem>

          <listitem>
            <para>Using the getTable() method of a F0FModel object. This
            method is not recommended due to the singleton caveat. Likewise to
            F0FTable::getAnInstance() you get a singleton object for that
            model. Unless you want to operate on the last item fetched / saved
            in the model you need to clone it.</para>

            <programlisting language="php">// If you forget the clone you will spend some not-so-fun hours debugging erratic behaviour.
// Also, are you sure that your code actually loaded anything in the table? Hm...
$myRecord = <emphasis role="bold">clone</emphasis> $model-&gt;getTable();</programlisting>
          </listitem>
        </itemizedlist>
      </section>
    </section>

    <section xml:id="fofcontroller">
      <title>Controllers</title>

      <para>The Controller is the orchestrator of each view. You can call a
      specific task of the Controller –based on the input variables you pass
      to it– causing it to execute a specific method. The Controller's job is
      to create a Model and View object, set the state of the Model based on
      the request and then either call a Model's method to perform an action
      (e.g. save a record) or pass the View the Model object and tell it to
      render itself.</para>

      <bridgehead>Class and file naming conventions</bridgehead>

      <para>The convention for naming the controller classes is
      <classname>ComponentControllerView</classname>, e.g.
      <classname>TodoControllerItem</classname> for a component named
      <code>com_todo</code> and a view named <code>items</code>. The last part
      SHOULD be singular. Support for plural named controllers (such as
      <classname>TodoControllerItems</classname>) will be dropped in a future
      version.</para>

      <para>The controller file name MUST match the last part of the class
      name. This means that the file for
      <classname>TodoControllerItem</classname> MUST be
      <filename>item.php</filename>, whereas the file for
      <classname>TodoControllerItems</classname> MUST be
      <filename>items.php</filename>.</para>

      <para>All Controller files are located in your component's controllers
      directories, in the front-end and back-end. If a file is not present in
      the front-end, it will be attempted to be loaded from the back-end and
      vice versa. If the Controller class is not loaded and a suitable file
      cannot be found FOF will fall back to one of the following, in this
      order:</para>

      <orderedlist>
        <listitem>
          <para>The Default controller. This is a special controller class
          following the naming conventions
          <classname><replaceable>Component</replaceable>ControllerDefault</classname>,
          e.g. <classname>TodoControllerDefault</classname>, found in the
          <filename>default.php</filename> file inside your
          <filename>controllers</filename> directory.</para>
        </listitem>

        <listitem>
          <para>If a default controller is not found, FOF will fall back to
          creating a suitably configured instance of
          <classname>F0FController</classname>, using convention over
          configuration to determine what the controller object should
          do.</para>
        </listitem>
      </orderedlist>

      <bridgehead>View names and handling by a single controller</bridgehead>

      <para>The convention in FOF is that he view name is plural when you are
      executing the <methodname>browse</methodname> method (which returns
      multiple records) and singular in all other cases. Both views are
      considered to be part of the same triad and are handled by the same
      controller. For example, let's consider a component named
      <code>com_todo</code> and a view called <code>items</code>. The view
      name will be <code>items</code> when you are producing a list of all
      items (<methodname>browse</methodname> task), but <code>item</code> in
      all other cases. Both views will be handled by the
      <classname>TodoControllerItem</classname> class. This is different than
      plain old Joomla!. You do not need a different "list" and "form"
      controller. There's one and only one controller per view.</para>

      <bridgehead>Customising a specialised class</bridgehead>

      <para>Unlike plain old Joomla! you are NOT supposed to copy and paste
      code when dealing with FOF. Our rule of thumb is that if you ever find
      yourself copying code from F0FController into your extension's
      specialised table class you're doing it wrong.</para>

      <para>FOF controller can be customised very easily using the
      <methodname>onBefore<replaceable>Something</replaceable></methodname> /
      <methodname>onAfter<replaceable>Something</replaceable></methodname>
      methods. The <replaceable>Something</replaceable> is the name of the
      controller task they are related to. For example,
      <methodname>onBeforeBrowse</methodname> runs before the
      <methodname>browse</methodname> task executes and
      <methodname>onAfterBrowse</methodname> runs right after the
      <methodname>browse</methodname> task executes. Returning false will
      result in a 403 Forbidden error. Specific implementation notes for each
      case can be found in the docblocks of each event method.</para>

      <bridgehead>Extending your controllers with plugin events</bridgehead>

      <para>As a developer you've probably found yourself in a position like
      this: a component you found does almost what you want. In order to make
      it do exactly what you want you need to change how a controller handles
      a specific task in a specific view. But if you modify the controller
      ("hack core") you have upgrade and maintenance issues. You can make a
      feature request to the developer but you don't know if and when the
      feature will be implemented. If you are the developer of the component
      you are faced with the dilemma: do I let this client down or do I
      implement a feature that doesn't quite fit my extension and will become
      a maintenance burden?</para>

      <para>This is where FOF kicks in. Remember how you can customise a
      specialised class with <methodname>onBefore</methodname> /
      <methodname>onAfter</methodname> methods? Since FOF 2.1.0 you can handle
      these methods not only with a customised class but also with system
      plugin events. System plugins are always loaded early in the Joomla load
      process (as early as the onAfterInitialise call), making them an
      excellent choice for providing component customisation code, without the
      need to over-engineer FOF's handling of Controllers.</para>

      <para>You will need to create a method named
      <methodname>onBefore<replaceable>Component</replaceable>Controller<replaceable>View</replaceable><replaceable>Task</replaceable></methodname>,
      e.g. <methodname>onBeforeFoobarControllerItemsRead</methodname> to
      handle the <methodname>onBefore</methodname> event of
      <code>com_foobar</code>, <code>items</code> view, <code>read</code>
      task. Returning <constant>false</constant> will prevent the task from
      firing. You can do the same for the <methodname>onAfter</methodname>
      event. Do note that plugin events run after the code in your controller
      and not instead of it or before it. The events must be implemented in
      system plugins so that they always get loaded by Joomla! before any
      controller gets the chance to run (remember, HMVC, you may end up
      calling a controller from a module or plugin).</para>

      <para>The signature for these plugins methods is like this:</para>

      <programlisting language="php"><methodname>public function onBefore<replaceable>Component</replaceable>Controller<replaceable>View</replaceable><replaceable>Task</replaceable></methodname> (F0FController &amp;$controller, F0FInput &amp;$input)</programlisting>

      <para>Both parameters are passed by reference, meaning that you can
      modify them from your plugin. There's a caveat: by the time the
      <methodname>onBefore</methodname> plugin event is called the model and
      view instances have already been created with the previously existing
      <classname>F0FInput</classname> instance. If you need to modify the
      model's state you will have to do something like
      <code>$controller-&gt;getThisModel()-&gt;setState('foo', $myNewFooValue)
      </code></para>

      <programlisting language="php"><methodname>public function onAfter<replaceable>Component</replaceable>Controller<replaceable>View</replaceable><replaceable>Task</replaceable></methodname> (F0FController &amp;$controller, F0FInput &amp;$input, &amp;$ret)</programlisting>

      <para>The <parameter>$ret</parameter> parameter contains the return
      value of the task method. It is passed by reference and you can modify
      it from your plugin.</para>
    </section>

    <section xml:id="fofview">
      <title>Views</title>

      <para>The Views are the last wheel of an MVC triad. Their sole purpose
      in life is to render the data in a suitable representation that makes
      sense. Usually this means rendering to HTML but they can also be used to
      render the data as JSON, XML, CSV or even as images, sound and video.
      It's up to you to decide what a "suitable" representation means in the
      context of your application.</para>

      <bridgehead>Class and file naming conventions</bridgehead>

      <para>The convention for naming the view classes is
      <classname><replaceable>Component</replaceable>View<replaceable>Viewname</replaceable></classname>,
      e.g. <classname>TodoViewItem</classname> for a component named
      <code>com_todo</code> and a view named <code>item</code>. The last part
      MUST match the singular/plural name of the specific view you are
      rendering.</para>

      <para>The view file name MUST follow the convention
      <filename>view.<replaceable>format</replaceable>.php</filename>, e.g.
      <filename>view.html.php</filename>. The
      <replaceable>format</replaceable> is the representation format rendered
      by this view class. The most common formats –for which FOF provides
      default implementations– are <option>html</option>,
      <option>json</option> and <option>csv</option>. The format MUST match
      the value of the "format" input variable. If none is specified,
      <option>html</option> will be assumed. Exception: there is a format
      called <option>form</option> which is an HTML rendering and will be
      loaded when the value of the format input variable is set to
      <option>html</option> (or not set at all) as long as there is an XML
      form for this view.</para>

      <para>All View files are located in your component's views directories,
      in the respective front-end and back-end directory, inside the
      respective view subfolder. For example, if you have a component called
      <code>com_todo</code> and a back-end view named <code>items</code> the
      view file for the HTML rendering is
      <filename>administrator/components/com_todo/views/items/view.html.php</filename></para>

      <para>If a file is not present in the front-end, it will be attempted to
      be loaded from the back-end and vice versa. If the View class is not
      loaded and a suitable file cannot be found FOF will fall back to one of
      the following, in this order:</para>

      <orderedlist>
        <listitem>
          <para>The Default view. This is a special controller class following
          the naming conventions
          <classname><replaceable>Component</replaceable>ViewDefault</classname>,
          e.g. <classname>TodoViewDefault</classname>, found in the
          <filename>default/view.<replaceable>format</replaceable>.php</filename>
          file inside your <filename>views</filename> directory.</para>
        </listitem>

        <listitem>
          <para>If a default view is not found, FOF will fall back to creating
          a suitably configured instance of a <classname>F0FView</classname>
          format-specific class, using convention over configuration to
          determine what the model object should do. For example, if the
          current format is <option>html</option> FOF will create an instance
          of <classname>F0FViewHtml</classname>. If there is no suitable class
          found you will get an error as FOF has no idea what to
          render.</para>
        </listitem>
      </orderedlist>

      <bridgehead>View template files and their location</bridgehead>

      <para>FOF uses default names to generate a list or form to edit, these
      names are linked to the task being executed.</para>

      <table>
        <title>View templates' locations</title>

        <tgroup cols="3">
          <colspec align="center"/>

          <thead>
            <row>
              <entry align="center">Task name</entry>

              <entry align="center">Filename</entry>

              <entry>Description</entry>
            </row>
          </thead>

          <tbody>
            <row>
              <entry align="left"><methodname>browse</methodname></entry>

              <entry><filename>default.php</filename> OR
              <filename>form.default.xml</filename></entry>

              <entry>This is the file that shows the list page</entry>
            </row>

            <row>
              <entry align="left"><methodname>edit</methodname></entry>

              <entry><filename>form.php</filename> OR
              <filename>form.form.xml</filename></entry>

              <entry>This is the file that shows the edit page</entry>
            </row>

            <row>
              <entry align="left"><methodname>read</methodname></entry>

              <entry><filename>item.php</filename> OR
              <filename>form.item.xml</filename></entry>

              <entry>This is the file that shows the data of a single record
              without being able to edit the record</entry>
            </row>
          </tbody>
        </tgroup>
      </table>

      <para>The location of the files is also pre-defined and based on the
      view name. This name comes in both singular and plural form where the
      singular name represents the edit page and the plural name represents
      the list page. Let's say our view is called <code>todo</code>, the
      template files can be found in the following location:</para>

      <programlisting>views
|-- todo
 |-- tmpl
     form.php  OR  form.form.xml
     item.php  OR  form.item.xml
|-- todos
 |-- tmpl
     default.php  OR  form.default.xml
</programlisting>

      <bridgehead>Customising a specialised class</bridgehead>

      <para>Unlike plain old Joomla! you are NOT supposed to copy and paste
      code when dealing with FOF. Our rule of thumb is that if you ever find
      yourself copying code from any F0FView class into your extension's
      specialised table class you're doing it wrong.</para>

      <para>FOF view can be customised very easily using the
      <methodname>on<replaceable>Task</replaceable></methodname> methods. The
      <replaceable>Task</replaceable> here is the name of the controller task
      they are related to. For example, <methodname>onBrowse</methodname> runs
      when rendering the output of a browse task. There is a catch-all method
      called <methodname>onDisplay</methodname> which executes if no suitable
      method is found in the view class. Returning false from these methods
      will result in a <errorcode>403</errorcode>
      <errorcode>Forbidden</errorcode> error.</para>

      <bridgehead>Layouts, sub-templates and template overrides</bridgehead>

      <para>The default filename of the template file to be used can be
      overridden with the <parameter>layout</parameter> input variable. For
      example if you feed an input variable named <code>layout</code> with a
      value of <code>foobar</code> FOF will look for
      <filename>form.foobar.xml</filename> and <filename>foobar.php</filename>
      in the <filename>tmpl</filename> directory.</para>

      <para>You can also specify sub-templates using the
      <parameter>tpl</parameter> parameter when calling the
      <methodname>display()</methodname> method of your view class. By default
      FOF doesn't use it at all. You can only use it with custom controller
      tasks. In this case the tpl (a.k.a. subtemplate) will be appended to the
      layout name with an underscore in between. So for
      <code>layout=foo</code> and <code>tpl=bar</code> FOF will be looking for
      the <filename>foo_bar.php</filename> view template file.</para>

      <para>All view template files are subject to template overrides. The
      view template will first be searched in the
      <filename>templates/<replaceable>template</replaceable>/html/<replaceable>component</replaceable>/<replaceable>view</replaceable></filename>
      directory where <replaceable>template</replaceable> is the name of your
      template, <replaceable>component</replaceable> is the name of your
      component (e.g. <code>com_todo</code>) and
      <replaceable>view</replaceable> is the name of your view. This allows
      end users and site integrators to provide customised renderings suitable
      for their sites.</para>

      <bridgehead>Joomla! version specific overrides</bridgehead>

      <para>It is possible have different view templates per Joomla! version
      or version family. The correct view template is chosen automatically,
      without you writing a single line of code.</para>

      <para>Let's say that you have a browse view with your lovely
      <filename>default.php</filename> view template file. And you want your
      component to work on Joomla! 2.5 and 3.x. Oh, the horror! The markup is
      different for each Joomla! version, Javascript has changed, different
      features are available… Well, no problem! FOF will automatically search
      for view template files (or XML forms) suffixed with the Joomla! version
      family or version number.</para>

      <para>For example, if you're running under Joomla! 2.5, FoF will look
      for <filename>default.j25.php</filename>,
      <filename>default.j2.php</filename> and <filename>default.php</filename>
      in this order. If you're running under Joomla! 3.2, FOF will look for
      <filename>default.j32.php</filename>,
      <filename>default.j3.php</filename> and <filename>default.php</filename>
      in this order. This allows you to have a different view template file
      for each version family of Joomla! without ugly if-blocks and awkward
      code.</para>

      <para>This feature also works with XML forms, e.g. on Joomla! 2.5 a
      browse form will be looked for in
      <filename>form.default.j25.xml</filename>, <filename>form.default.j2.xml
      </filename>and <filename>form.default.xml</filename> in this
      order.</para>

      <bridgehead>Custom template view file to wrap an XML form</bridgehead>

      <para>An XML form file is a great way to get started developing an
      application, but what if you want to add messages or render moduels at
      the top/bottom of the form, add a sidebar or in any other way add your
      own HTML around the rendered form? The answer is simple: you can use
      regular PHP-based view templates and XML forms side by side in the same
      view. Inside your .php file you can use $this-&gt;getRenderedForm() to
      return the XML form file rendered as HTML. This allows customising the
      layout (e.g. adding information before/after the form) while still using
      the XML file to render the actual form. For example, you could insert
      this code in your custom .php view template file:</para>

      <programlisting language="php">&lt;?php

// Show some stuff before the form
?&gt;&lt;h1&gt;Hello, world!&lt;/h1&gt;
&lt;p&gt;This is printed above the form&lt;/p&gt;

&lt;?php
// Show the rendered form
echo $this-&gt;getRenderedForm();

// Show some stuff after the form
?&gt;
&lt;p&gt;This is printed below the form&lt;/p&gt;</programlisting>

      <para>This works with all forms (browse, edit, read). For example, if
      you want to customise a browse view template you will need to create
      both <filename>form.default.xml</filename> and
      <filename>default.php</filename> in the <filename>tmpl</filename>
      directory of your view.</para>

      <bridgehead>Automatic views and web services</bridgehead>

      <para>FOF can automatically render your component's output in JSON and
      CSV formats. You do not have to write any code whatsoever. Just pass on
      an input variable named <code>format</code> with a value of
      <code>json</code> or <code>csv</code> respectively. In the typical case
      where you get the input variables from the request this means appending
      <code>&amp;format=json</code> or <code>&amp;format=csv</code>
      respectively. You can, of course, customise the output of either format
      using view classes if you need to.</para>

      <para>The JSON format can be used to provide web services with
      integrated hypermedia (following the HAL specification). All you need to
      do is to tell <classname>F0FViewJson</classname> to use hypermedia,
      either by setting <code>$this-&gt;useHypermedia = true;</code> in your
      specialised JSON view class or, much easier, using the
      <filename>fof.xml</filename> configuration file.</para>

      <bridgehead>Custom render classes ("renderers")</bridgehead>

      <para>FOF uses the Render package to convert XML forms into HTML and
      handle things such as submenus. It ships with render classes suitable
      for use on regular Joomla! 2.5, regular Joomla! 3.2 and one for when
      using Akeeba Strapper. The correct render class is chose automatically,
      via environment detection. However, you may want to implement a custom
      render class. Having to put it inside FOF's library directory would be
      in violation of best coding practices. Even worse, it would affect all
      views in all FOF-powered components on the site which is a terrible
      idea. That's why the View constructor allows you to instantiate and
      attach a custom render class. You will need to specialise the
      <code>__construct</code> method of your View class like this:</para>

      <programlisting language="php">function __construct($config = array())
{
    parent::__construct($config);

    $customRenderer = new YourCustomRenderClass();
    self::registerRenderer($customRenderer);
}</programlisting>

      <para>This View will now use the custom renderer to display
      itself.</para>
    </section>

    <section xml:id="fofdispatcher">
      <title>Dispatcher</title>

      <para>The Dispatcher is what handles the request on behalf of your
      component (be it a web request or an HMVC request). Its primary job is
      to decide which controller to create and which task to run. Its
      secondary job is to handle transparent authentication which comes in
      really handy if you want to perform remote requests to your component,
      interacting with access-restricted data or actions (viewing items
      protected behind a login, performing privileged operations such as
      creating / editing / deleting records and so on).</para>

      <bridgehead>Class and file naming conventions</bridgehead>

      <para>The convention for naming the dispatcher classes is
      <classname><replaceable>Component</replaceable>Dispatcher</classname>,
      e.g. <classname>TodoDispatcher</classname> for a component named
      <code>com_todo</code>. The last part MUST be
      <classname>Dispatcher</classname>.</para>

      <para>The controller file name MUST be
      <filename>dispatcher.php</filename>. All Dispatcher files are located in
      your component's main front-end or back-end directories. If a file is
      not present in the front-end, it will be attempted to be loaded from the
      back-end but NOT vice versa. If the Dispatcher class is not loaded and a
      suitable file cannot be found FOF will fall back to creating a suitably
      configured instance of <classname>F0FDispatcher</classname>, using
      convention over configuration to determine what the Dispatcher object
      should do.</para>

      <bridgehead>Customising a specialised class</bridgehead>

      <para>Unlike plain old Joomla! you are NOT supposed to copy and paste
      code when dealing with FOF. Our rule of thumb is that if you ever find
      yourself copying code from F0FDispatcher into your extension's
      specialised table class you're doing it wrong.</para>

      <para>FOF dispatcher can be customised very easily using the
      <methodname>onBeforeDispatch</methodname> /
      <methodname>onAfterDispatch</methodname> methods.
      <methodname>onBeforeDispatch</methodname> runs before the dispatcher
      executes and <methodname>onAfterDispatch</methodname> runs right after
      the dispatcher executes. Returning false will result in a 403 Forbidden
      error. Specific implementation notes for each case can be found in the
      docblocks of each event method.</para>

      <section xml:id="fofdispatcher-transparent-auth">
        <title>Transparent authentication</title>

        <para>Transparent authentication allows FOF to authenticate a user
        using Basic Authentication or URL parameters. This allows you to
        create web services or directly access pages which require a logged in
        users without using Joomla! session cookies.</para>

        <para>The authentication credentials can be provided via two methods:
        Basic Authentication or a URL parameter. The authentication
        credentials can either be a username and password pair transmitted in
        plaintext (not recommended unless you are forcibly using HTTPS with a
        commercially signed SSL certificate) or encrypted. The encrypted
        information uses Time-Based One Time Passwords (TOTP) to allow you to
        communicate the credentials securely, without the burden of public key
        cryptography, while at the same time maintaining an intrinsically very
        narrow window of opportunity. Furthermore, since the effective
        encryption key is modified every few seconds it makes an attack
        against it slightly harder than using regular symmetric AES-128
        cryptography.</para>

        <para>Transparent authentication is enabled by default, but doesn’t
        use TOTP.</para>

        <bridgehead>Setting it up</bridgehead>

        <para>Setting up transparent authentication requires you to modify
        your component’s Dispatcher class, namely its
        <methodname>__construct()</methodname> method, to change the values of
        some protected fields.</para>

        <para>The available fields are:</para>

        <variablelist>
          <varlistentry>
            <term>$_fofAuth_timeStep</term>

            <listitem>
              <para>The time step, in seconds, for the time based one time
              passwords (TOTP) used for encryption. The default value is 6
              seconds. The window of opportunity for an attacker is 2x-3x as
              much, i.e. 12-18 seconds using the default value. This is
              adequately high to be practical and too low to allow a realistic
              attack by a hacker.</para>

              <important>
                <para>If you change this option you have to notify the
                consumers of the service to make the same change, otherwise
                your TOTPs will be vastly different and communication will
                fail.</para>
              </important>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>$_fofAuth_Key</term>

            <listitem>
              <para>The Base32 encoded key for TOTP. Please note that this is
              Base32, not Base64. Only required if you’re going to use
              encryption.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>$_fofAuth_Formats</term>

            <listitem>
              <para>Which result formats should be handled by the transparent
              authentication. This is an array, by default <code>array('json',
              'csv', 'xml', 'raw')</code>. We recommend only using non-HTML
              formats in here.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>$_fofAuth_LogoutOnReturn</term>

            <listitem>
              <para>By default it’s true and it means that once the component
              finishes executing, FOF will log out the user it authenticated
              using transparent authentication. This is a precaution against
              someone intercepting and abusing the session cookie Joomla! will
              be sending back to the client, as well as preventing the
              sessions table from filling up.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>$_fofAuth_AuthMethods</term>

            <listitem>
              <para>An array of supported authentication methods. Only use the
              ones that make sense for your application. Avoid using the
              *_Plaintext ones, please. The possible values in the array
              are:</para>

              <itemizedlist>
                <listitem>
                  <para><emphasis role="bold">HTTPBasicAuth_TOTP</emphasis>
                  HTTP Basic Authentication using encrypted information
                  protected with a TOTP (the username must be
                  "_fof_auth")</para>
                </listitem>

                <listitem>
                  <para><emphasis role="bold">QueryString_TOTP</emphasis>
                  Encrypted information protected with a TOTP passed in the
                  <parameter>_fofauthentication</parameter> query string
                  parameter</para>
                </listitem>

                <listitem>
                  <para><emphasis
                  role="bold">HTTPBasicAuth_Plaintext</emphasis> HTTP Basic
                  Authentication using a username and password pair in plain
                  text</para>
                </listitem>

                <listitem>
                  <para><emphasis role="bold">QueryString_Plaintext
                  Plaintext</emphasis> JSON-encoded username and password pair
                  passed in the <parameter>_fofauthentication</parameter>
                  query string parameter</para>
                </listitem>
              </itemizedlist>
            </listitem>
          </varlistentry>
        </variablelist>

        <para>When you are using the QueryString_TOTP method you can pass your
        authentication information as GET or POST variable called
        <parameter>_fofauthentication</parameter> with the value being the URL
        encoded cryptogram of the authentication credentials (see further
        down).</para>

        <bridgehead>How to get a TOTP key</bridgehead>

        <para>Any Base32 string can be used as a TOTP key as long as it
        expands to exactly 10 characters. If you don’t feel like guessing, you
        can simply do:</para>

        <programlisting language="php">$totp = new F0FEncryptTotp();
$secret = $totp-&gt;generateSecret();
</programlisting>

        <para>You have to share this secret key with all clients wishing to
        connect to your component via a secure channel. This secret key must
        also be set in the <varname>_fofAuth_Key</varname> variable.</para>

        <bridgehead>How to construct and supply an authentication
        set</bridgehead>

        <para>The authentication set is a representation of the username and
        password of the user you want FOF to log in using transparent
        authentication. Its format depends on the authentication
        method.</para>

        <para>Before going into much detail, we should consider an FOF
        authentication key to be a JSON-encoded object containing the keys
        username and password. E.g.:</para>

        <programlisting language="json">{ “username”: “sample_user”, “password”: “$3Cr3+” }
</programlisting>

        <para>This is used with all but one authentication methods. Encryption
        of the FOF authentication key, used with all *_TOTP methods, is
        discussed further down this document.</para>

        <para>If you are using HTTPBasicAuth_Plaintext method, you have to
        supply your username and password using HTTP Basic Authentication. The
        username is the username of the user you want to log in and the
        password is the password of the user you want to log in. This is the
        easiest and most insecure authentication method.</para>

        <para>If you are using the HTTPBasicAuth_TOTP method, you have to
        supply a username of <option>_fof_auth</option> (including the leading
        underscore) and as the password enter the encrypted FOF authentication
        key.</para>

        <para>If you are using the QueryString_Plaintext method you have to
        supply a GET or POST query parameter with a name of
        <parameter>_fofauthentication</parameter> (including the leading
        underscore). Its value must be the URL encoded FOF authentication
        key.</para>

        <para>If you are using the QueryString_TOTP method you have to supply
        a GET or POST query parameter with a name of
        <parameter>_fofauthentication</parameter> (including the leading
        underscore). Its value must be the URL encoded FOF authentication
        key.</para>

        <bridgehead>Encrypting the FOF authentication key</bridgehead>

        <para>Assuming you are doing this from a FOF-powered component, you
        can do something like this:</para>

        <programlisting language="php">$timeStep = 6; // Change this if you have a different value in your Dispatcher
$authKey = json_encode(array(
  'username' =&gt; $username,
  'password' =&gt; $password
));
$totp = new F0FEncryptTotp($timeStep);
$otp = $totp-&gt;getCode($secretKey);
$cryptoKey = hash('sha256', $this-&gt;_fofAuth_Key.$otp);
$aes = new F0FEncryptAes($cryptoKey);
$encryptedAuthKey = $aes-&gt;encryptString($authKey);
</programlisting>

        <para>If you can get your hands on a TOTP and AES-256 implementation
        for your favourite programming language you can use talk to
        FOF-powered components through transparent authentication. Tip: TOTP
        libraries are usually labelled as being Google Authenticator
        libraries. Google Authenticator simply uses TOTP with a temp step of
        30 seconds. Most such libraries are able to change the time step, thus
        possible to use with FOF. In fact, that's how FOF's TOTP library was
        derived.</para>
      </section>
    </section>

    <section xml:id="foftoolbar">
      <title>Toolbar</title>

      <para>The Toolbar is the part of your components which handles the
      display of the component's title and toolbar buttons, as well as the
      toolbar submenu (links or tabs under the toolbar). While usually used in
      the back-end of your site, FOF components can readily render a toolbar
      in the front-end part of the component as well. Do note that you will
      need to provide your own CSS to style the toolbar in the front-end as
      Joomla! templates lack such a styling.</para>

      <bridgehead>Class and file naming conventions</bridgehead>

      <para>The convention for naming the toolbar classes is
      <classname><replaceable>Component</replaceable>Toolbar</classname>, e.g.
      <classname>TodoToolbar</classname> for a component named
      <code>com_todo</code>. The last part MUST be
      <classname>Toolbar</classname>.</para>

      <para>The controller file name MUST be <filename>toolbar.php</filename>.
      All Toolbar files are located in your component's main directory, in the
      front-end and back-end. If a file is not present in the front-end, it
      will be attempted to be loaded from the back-end. If the Toolbar class
      is not loaded and a suitable file cannot be found FOF will fall back to
      creating a suitably configured instance of F0FToobar, using convention
      over configuration to determine what the controller object should
      do.</para>

      <bridgehead>Customising a specialised class</bridgehead>

      <para>FOF toolbar can be customised very easily using methods following
      one of the following conventions, from most specific to least
      specific:</para>

      <variablelist>
        <varlistentry>
          <term><methodname>on<replaceable>Viewname</replaceable><replaceable>Taskname</replaceable></methodname></term>

          <listitem>
            <para>for example <methodname>onItemsBrowse</methodname>. The name
            consists of the word on in lowercase, followed by camel cased view
            and task names, in this order. When the task is
            <methodname>Browse</methodname> the view name MUST be plural. For
            any other task the view name MUST be singular. For example:
            <methodname>onItemsBrowse</methodname> and
            <methodname>onItemAdd</methodname></para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><methodname>on<replaceable>Viewname</replaceable></methodname></term>

          <listitem>
            <para>for example <methodname>onItems</methodname>. The name
            consists of the word on in lowercase, followed by camel cased view
            name.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><methodname>on<replaceable>Taskname</replaceable></methodname></term>

          <listitem>
            <para>for example <methodname>onBrowse</methodname>. The name
            consists of the word on in lowercase, followed by camel cased task
            name.</para>
          </listitem>
        </varlistentry>
      </variablelist>

      <para>The method to be called is selected from the most to the least
      specific. For example, if you have a component named
      <code>com_todo</code> and a view named <code>items</code>, with the task
      browse being called FOF will search for the following method names, in
      this order: <methodname>onItemsBrowse</methodname>,
      <methodname>onItems</methodname>,
      <methodname>onBrowse</methodname></para>

      <para>Please note that any of these methods should only modify the
      toolbar and not perform any other kind of data processing.</para>

      <bridgehead>Customising the link bar</bridgehead>

      <para>The link bar is the area normally displayed right below the
      toolbar in the back-end of the site. It is usually rendered as flat
      links (Joomla! 2.5), a left-hand sidebar (Joomla! 3.0 and later) or tabs
      (when using Akeeba Strapper). The exact rendering depends on the
      template. The interesting thing is how these links are populated,
      described below.</para>

      <bridgehead>Automatically populated link bar</bridgehead>

      <para>FOF will normally look inside your component's views directory and
      look for plural views. These views are automatically added to the link
      bar in alphabetical order. Exception: a view called <code>cpanel</code>
      will always be added to the link bar.</para>

      <para>If you want a view to not be included in the link bar, please
      create a file named <filename>skip.xml</filename> and put it inside its
      directory. FOF will see that and refrain from adding this view to the
      link bar.</para>

      <para>If you want to modify the ordering of a view you have to create or
      modify the <filename>metadata.xml</filename> file inside your view's
      directory. The <code>&lt;foflib&gt;</code> section inside the
      <filename>metadata.xml</filename> file is read by FOF. For
      example:</para>

      <programlisting language="xml">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;metadata&gt;
    &lt;foflib&gt;
        &lt;ordering&gt;12&lt;/ordering&gt;
    &lt;/foflib&gt;
    &lt;view title="COM_FOOBAR_VIEW_ITEMS_TITLE"&gt;
        &lt;message&gt;&lt;![CDATA[COM_FOOBAR_VIEW_ITEMS_DESC]]&gt;&lt;/message&gt;
    &lt;/view&gt;
&lt;/metadata&gt;
</programlisting>

      <para>tells FOF that this view should be the 12th link in the link
      bar.</para>

      <para>If you're not using a <filename>metadata.xml</filename> file and
      have a view called <code>cpanel</code> or <code>cpanels</code> then it
      will always be reordered to the top of the link bar list.</para>

      <bridgehead>Fully customised link bar</bridgehead>

      <para>The automatically generated link bar is usually enough, but
      sometimes you want a more complex presentation. For example, you want to
      show different link bars depending on a configuration setting (e.g. a
      "Power user" switch in your component's options), or a drop-down menu.
      To this end, <classname>F0FToobar</classname> provides the following
      methods.</para>

      <programlisting language="php">public function <methodname>clearLinks</methodname>()</programlisting>

      <para>Removes all links from the link bar, allowing you to start from a
      clean slate.</para>

      <programlisting language="php">public function &amp;<methodname>getLinks</methodname>()</programlisting>

      <para>Returns the raw data for the links in the link bar. We recommend
      against using it as the internal data structure may change in the
      future.</para>

      <programlisting language="php">public function <methodname>appendLink</methodname>($name, $link = null, $active = false, $icon = null, $parent = '')</programlisting>

      <para>Appends a link to the link bar. If you use the last option
      (<varname>$parent</varname>) you are creating a submenu item whose
      parent is the <varname>$parent</varname> item. You reference the parent
      item by its name (i.e. the <varname>$name</varname> parameter you used
      in the parent element). Drop-downs only work in a. Joomla! 3.0 and later
      without any additional requirements; or b. Joomla! 2.5 but only when
      using the optional Akeeba Strapper package which back ports jQuery and
      Bootstrap to Joomla! 2.5 sites.</para>

      <para>In order to use these methods you will have to override the
      <methodname>renderSubmenu</methodname> method in
      <classname>F0FToobar</classname>.</para>

      <bridgehead>When the link bar is rendered</bridgehead>

      <para>The link bar is rendered in all HTML views, unless you are have an
      input variable named <parameter>tmpl</parameter> with a value of
      <option>component</option>. Typically, this means that you are passing a
      query string parameter <code>&amp;tmpl=component</code> to the URL of
      your component.</para>

      <para>You can force the entire toolbar (and, by extent, the link bar) to
      be displayed or hidden using the <parameter>render_toolbar</parameter>
      input variable. When you set it to 0 the toolbar and link bar will not
      be displayed. When you set it to 1 the toolbar and link bar will be
      displayed (even when you use <code>tmpl=component</code>).</para>
    </section>

    <section xml:id="hmvc">
      <title>HMVC</title>

      <para>Before we say anything else, let's define what HMVC means in the
      context of FOF. The H stands for "Hierarchical". That is to say there's
      a hierarchy of MVC calls. In very simple terms, HMVC allows you to call
      an MVC triad from anywhere else.</para>

      <para>Practical uses:</para>

      <itemizedlist>
        <listitem>
          <para>Showing a component's view inside a module, without having to
          rewrite the model and view logic inside the module.</para>
        </listitem>

        <listitem>
          <para>Allowing a plugin (e.g. a system or content plugin) to use the
          rendered output of a component and inject it to the output of the
          page or send it as an email.</para>
        </listitem>

        <listitem>
          <para>Displaying a view of the same or a different component within
          a component.</para>
        </listitem>
      </itemizedlist>

      <para>The possibilities are endless.</para>

      <bridgehead>How to use it?</bridgehead>

      <para>You already know it, you just didn't realise it. Here's the secret
      sauce:</para>

      <programlisting language="php">F0FDispatcher::getTmpInstance('com_foobar', 'items', array('layout' =&gt; 'fancy'))-&gt;dispatch();
</programlisting>

      <para>You are simply creating an instance of the dispatcher of the
      component you want, telling it which view to render and giving it an
      option configuration array (the last argument in the method call). Then
      you just call the dispatch() method and let it render.</para>

      <para>If you want to get the output in a variable you have to do
      something like this:</para>

      <programlisting language="php">@ob_start();
F0FDispatcher::getTmpInstance('com_foobar', 'items', array('layout' =&gt; 'fancy'))-&gt;dispatch();
$result = ob_end_clean();
</programlisting>

      <para>If you need to pass input variables to the dispatcher you can do
      something like this:</para>

      <programlisting language="php">F0FDispatcher::getTmpInstance('com_foobar', 'items', array('input' =&gt; $input))-&gt;dispatch();
</programlisting>

      <para>where <varname>$input</varname> can be an indexed array, a
      stdClass object or –preferred– a <classname>F0FInput</classname> or
      <classname>JInput</classname> instance. For example:</para>

      <programlisting language="php">$inputvars = array(
    'limit'            =&gt; 10,
    'limitstart'    =&gt; 0,
    'foobar'        =&gt; 'baz'
);
$input = new F0FInput($inputvars);
F0FDispatcher::getTmpInstance('com_foobar', 'items', array('input' =&gt; $input))-&gt;dispatch();
</programlisting>

      <para>And, of course, you can mix and match all of the above ideas to
      something like:</para>

      <programlisting language="php">$inputvars = array(
    'limit'            =&gt; 10,
    'limitstart'    =&gt; 0,
    'format'        =&gt; 'json'
);
$input = new F0FInput($inputvars);
@ob_start();
F0FDispatcher::getTmpInstance('com_foobar', 'items', array('input' =&gt; $input))-&gt;dispatch();
$json = ob_end_clean();
</programlisting>

      <para>See the awesome thing we just did? We got the first 10 items of
      com_foobar in JSON format in the $json variable. Just a side note. This
      example also screws up the document MIME type if you use it in an HTML
      view. Be warned.</para>
    </section>

    <section xml:id="acl-configuration">
      <title>ACL configuration</title>

      <para>Another key feature of FOF are automatic ACL checks: before an
      user is going to do anything, a permission check is made. For example,
      before browsing a list of records, FOF checks for
      <classname>core.browse</classname> permission or when we're trying to
      save a record, permission <classname>core.edit</classname> is
      checked.</para>

      <para><bridgehead>Adding ACL support in your
      extension</bridgehead></para>

      <para>In these sections we will analyze our example component To-Do List
      and we will retrace the steps needed in order to add and manage ACL
      inside the extension.</para>

      <para>What we want to achieve is a permission system based on two
      levels: we will define global wide permissions, then we will add
      "exceptions" to single records. For example, we need that Registered
      users can always edit records, but we want to prevent them from editing
      on a single record only because is very important for us.</para>

      <para><bridgehead>Defining the actions</bridgehead></para>

      <para>First of all, we have to define the actions that an user could
      perform, so create the file <classname>access.xml</classname> inside
      your extension backend directory and add the following lines:</para>

      <para><programlisting language="xml">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;access component="com_todo"&gt;
  &lt;section name="component"&gt;
    &lt;action name="core.admin"       title="JACTION_ADMIN" description="JACTION_ADMIN_COMPONENT_DESC" /&gt;
    &lt;action name="core.manage"      title="JACTION_MANAGE" description="JACTION_MANAGE_COMPONENT_DESC" /&gt;
    &lt;action name="core.create"      title="JACTION_CREATE" description="JACTION_CREATE_COMPONENT_DESC" /&gt;
    &lt;action name="core.delete"      title="JACTION_DELETE" description="JACTION_DELETE_COMPONENT_DESC" /&gt;
    &lt;action name="core.edit"        title="JACTION_EDIT" description="JACTION_EDIT_COMPONENT_DESC" /&gt;
    &lt;action name="core.edit.own"    title="JACTION_EDITOWN" description="JACTION_EDITOWN_COMPONENT_DESC" /&gt;
    &lt;action name="core.edit.state"  title="JACTION_EDITSTATE" description="JACTION_EDITSTATE_COMPONENT_DESC" /&gt;
  &lt;/section&gt;

  &lt;section name="unit"&gt;
    &lt;!-- Actions to be used in for unit --&gt;
    &lt;action name="core.delete" title="JACTION_DELETE" description="JACTION_DELETE_COMPONENT_DESC" /&gt;
    &lt;action name="core.edit" title="JACTION_EDIT" description="JACTION_EDIT_COMPONENT_DESC" /&gt;
    &lt;action name="core.edit.own" title="JACTION_EDITOWN" description="JACTION_EDITOWN_COMPONENT_DESC" /&gt;
    &lt;action name="core.edit.state" title="JACTION_EDITSTATE" description="JACTION_EDITSTATE_COMPONENT_DESC" /&gt;
  &lt;/section&gt;
&lt;/access&gt;</programlisting>As you can see, there are two sections: one
      for the whole component and another related to single records.</para>

      <para><important>
          <para>FOF will assume that the following permissions are defined
          inside your component: <classname>core.admin</classname>,
          <classname>core.manage</classname>,
          <classname>core.create</classname>,
          <classname>core.delete</classname>,
          <classname>core.edit</classname>,
          <classname>core.edit.own</classname>,
          <classname>core.edit.state</classname> .</para>

          <para>In order to fully take advantage of FOF features, we strongly
          suggest you to define the above actions.</para>
        </important></para>

      <para><bridgehead>Editing component permissions</bridgehead></para>

      <para>In your <classname>config.xml</classname> file you have to add the
      following lines:</para>

      <programlisting language="xml">&lt;fieldset name="permissions" label="JCONFIG_PERMISSIONS_LABEL" description="JCONFIG_PERMISSIONS_DESC"&gt;
  &lt;field name="rules" type="rules"
         label="JCONFIG_PERMISSIONS_LABEL"
         class="inputbox"
         filter="rules"
         component="com_todo"
         section="component" /&gt;
&lt;/fieldset&gt;</programlisting>

      <para>In this way Joomla! will render a Permissions tab inside your
      component options.</para>

      <para><bridgehead>Editing record permissions</bridgehead></para>

      <para>First of all we have to add a column to our table, as per FOF
      convention its name should be <classname>asset_id</classname> (however
      you could setup an alias):</para>

      <programlisting language="sql">ALTER TABLE `#__todo_items` ADD `asset_id` INT NOT NULL ;</programlisting>

      <para>Then you have to add two fields on your XML form: the saved
      asset_id and the rule field, that is used to set the permissions to each
      user group:</para>

      <programlisting language="xml">&lt;fieldset name="rules"&gt;
  &lt;field name="asset_id" type="hidden" emptylabel="true" filter="unset" /&gt;

  &lt;field name="rules"
         type="rules"
         emptylabel="true"
         translate_label="false"
         filter="rules"
         validate="rules"
         class="inputbox"
         component="com_todo"
         section="unit" /&gt;
&lt;/fieldset&gt;</programlisting>

      <para><important>
          <para>At the timing of this writing (2013-12-03), the Joomla!
          "rules" field is buggy. If you want add per item ACL privileges you
          <emphasis>must</emphasis> use FOF XML forms, since we found a
          workaround for this issue.</para>
        </important></para>

      <para>Finally, you have update your table class and add new method,
      named <classname>getAssetParentId</classname>. You have to do that since
      when we have to tell Joomla! what's the parent of our asset record, in
      this case it would be the component itself:</para>

      <programlisting language="php">public function getAssetParentId($table = null, $id = null)
{
    $db = JFactory::getDbo();

    $query = $db-&gt;getQuery(true)
                -&gt;select($db-&gt;qn('id'))
                -&gt;from($db-&gt;qn('#__assets'))
                -&gt;where($db-&gt;qn('name').' = '.$db-&gt;q('com_todo'))
                -&gt;where($db-&gt;qn('parent_id').' = 1')
                -&gt;where($db-&gt;qn('level').' = 1');
    $parent_id = $db-&gt;setQuery($query)-&gt;loadResult();

    if(!$parent_id)
    {
       return parent::getAssetParentId($table, $id);
    }
    else
    {
        return $parent_id;
    }
}</programlisting>

      <para>And that's it! Now enjoy the ACL in your extension.</para>
    </section>

    <section xml:id="fofdatabaseiterator">
      <title>The database cursor iterator (F0FDatabaseIterator)</title>

      <note>
        <para>Available since FOF 2.2.0</para>
      </note>

      <para>In many cases you have to sift through a large number of database
      records and you want to use the magic of F0FTable. The traditional way
      to do that was to use F0FModel::getItemList to get a big array of
      stdClass objects, iterate through it with foreach, mapping each stdClass
      object to your F0FTable instance. This is a performance and resource
      nightmare. PHP has to retrieve the entire list of records from the
      database and cast it to stupid stdClass objects, then you have to remap
      them one by one as F0FTable instances. The time and memory required to
      do that makes it impractical for lists over a few dozen records.</para>

      <para>Enter the F0FDatabaseIterator. This is a regular, non-resettable
      and non-seekable PHP iterator. This means that you can only fetch its
      current record or proceed to the next one. You cannot scroll back to the
      beginning and you cannot move to an arbitrary location within the
      iterator (unlike an array). However, it will only load one record in
      memory at a time and deliver it to you as a F0FTable object. The magic
      behind it lies in the way it is implemented: it is given a database
      cursor (pretty much, a resource pointing to the result set of a database
      query) and it uses standard PHP features to only ever fetch the next
      item from this cursor. Behind the scenes it will get a new instance of
      the F0FTable class and use its bind() method to bind the data to it,
      then return you the table object. Since it's an Iterator you can use it
      in a foreach statement to iterate through the entire list of records,
      one F0FTable object at a time.</para>

      <para>Even though you can create a F0FDatabaseIterator directly, you
      will hardly ever need to do so. A F0FTableIterator is returned by
      F0FModel's getIterator() method and the F0FTableRelations' methods which
      return multiple records. You are advised to use the iterator whenever
      you reasonably expect to deal with large numbers of database records,
      especially if you need to act upon them.</para>

      <para>The only drawback is that by using F0FModel's getIterator the
      onProcessList method, which is used for record list post-processing, is
      never called. This is actually a good thing. You can migrate that logic
      into the onBeforeBind() method of your table, where it belongs
      architecturally. After all, you are post-processing a list of records,
      one record at a time. What is more natural than doing so in the one
      class dedicated to handling one record at a time?</para>
    </section>

    <section xml:id="utility-classes">
      <title>Utility classes</title>

      <para>FOF comes with certain classes that are designed to make your life
      as a Joomla! extensions developer much easier. They handle things like
      installation, updates and database schema management. This code has been
      battle tested in our own components over the years.</para>

      <section xml:id="utils-installscript">
        <title>The installation script helper</title>

        <note>
          <para>Available since FOF 2.3.0</para>
        </note>

        <para>A FOF component usually needs to pack and install several
        things. At the very least it includes the component itself and a copy
        of the FOF library. Joomla! offers a method for installing multiple
        extensions at once, called the "package" extension type. However,
        "package" extensions are all or nothing: you either install everything
        included in your package or nothing at all. Quite obviously this can't
        be used to prevent installing an old version of FOF on top of a new
        one. FOF itself is of the "library" extension type. You'd think that a
        "library" package is checked for its version so that old versions
        can't be installed on top of new ones. Wrong. You might thing that the
        "library" package can have an installation script, like components and
        plugins, to determine if it can be installed, preventing an old
        version of the library overwriting a new one. Wrong, again. Joomla!'s
        extensions installer is coded in the most short-sighted way possible.
        All is lost?</para>

        <para>Not so fast! We have a few aces up our sleeves. The solution
        we've been using in our company over the years is a "component"
        package with a smart installer script which can install our component,
        any modules and plugins we may be including with it and FOF (and,
        possibly, Akeeba Strapper) if it's not installed or out-of-date. The
        "secret sauce" of our installer script is now inside FOF 2.3.0 and
        later, in the F0FUtilsInstallscript class. Here we are going to
        explain how to use it.</para>

        <bridgehead>Package layout</bridgehead>

        <para>The contents of your package need to follow a specific folder
        layout. Here's the proposed layout:</para>

        <programlisting>&lt;root&gt;
  +-- backend   Component files under site's "administrator" directory
  +-- frontend  Component files under site's root director
  +-- media     OPTIONAL. Component media files, under site's "media" directory
  +-- cli       OPTIONAL. Component CLI script installed under site's "cli" directory
  +-- language  OPTIONAL. Language files for your component.
  +-- fof       FOF installation files (extract FOF's library package in here)
  +-- strapper  OPTIONAL. Akeeba Strapper (extract Strapper's package in here)
  +-- modules   OPTIONAL. Modules bundled with the component
  |     +-- admin   Administrator (back-end) modules
  |     |     +-- mymodule  Installation files for mod_mymodule admin module
  |     +-- site    Site (front-end) modules
  |           +-- mymodule  Installation files for mod_mymodule site module
  +-- plugins   OPTIONAL. Plugins bundled with the component
        +-- system  System plugins
        |     +-- foobar  Installation files for plg_system_foobar plugin
        +-- whatever  Plugins installed in the "whatever" plugin folder
              +-- baz  Installation fles for plg_whatever_baz plugin</programlisting>

        <para>The <filename>backend</filename>, <filename>frontend</filename>,
        <filename>media</filename> and <filename>language</filename>
        directories can have any name you want as they are NOT handled by the
        installation script. They are defined in your component's XML manifest
        and it's up to Joomla! to decide what to do with them. The other
        directories, however, do play an important role.</para>

        <tip>
          <para>If you don't like our naming conventions you can choose
          different names for the top-level directories by specialising the
          F0FUtilsInstallscript class. More on that later on!</para>
        </tip>

        <tip>
          <para>Feel lost? You may want to see how we do this in our own
          components. A great place where the full power of the installation
          script helper is put to action is <link
          xlink:href="https://github.com/akeeba/akeebasubs/blob/development/component/script.akeebasubs.php">Akeeba
          Subscriptions</link>.</para>
        </tip>

        <para>The <emphasis role="bold">fof</emphasis> directory is the one
        you MUST have. It contains a copy of FOF's installation files. Just
        extract the latest FOF library package in there.</para>

        <para>The <emphasis role="bold">strapper</emphasis> directory can
        contain a copy of Akeeba Strapper, our Bootstrap 2.x compatibility
        layer, if you are using it in your component. In this case just
        extract the Strapper library into this directory.</para>

        <para>The <emphasis role="bold">cli</emphasis> directory contains
        command-line scripts which will be copied to your site's "cli"
        directory. They are typically used to set up CRON jobs for
        housekeeping or other lengthy operations.</para>

        <para>The <emphasis role="bold">modules</emphasis> directory contains
        all the modules you want to bundle with your extension. The suggested
        directory layout is having two sub-directories called
        <filename>admin</filename> and <filename>site</filename> containing
        the administrator (back-end) and public (front-end) modules
        respectively. Each module's installation file go inside a
        sub-directory of the <filename>admin</filename> or
        <filename>site</filename> directories depending on where it should be
        installed. The name of the module's directory must match its extension
        name as set in the XML manifest. You can also skip the
        <filename>admin</filename> or <filename>site</filename> directories
        and put everything under <filename>modules</filename> but we have
        found that this will make your life much harder as your extension
        starts growing bigger. Trust us on that.</para>

        <para>The <emphasis role="bold">plugins</emphasis> directory contains
        all the plugins you want to bundle with your extension. You need to
        have one sub-directory for each Joomla! plugin folder, e.g.
        <filename>system</filename>, <filename>content</filename>,
        <filename>user</filename> etc or even custom plugin folders such as
        akeebasubs, ats, whatever, ... Inside each sub-directory create one
        directory per plugin.</para>

        <bridgehead>Important note about XML manifests</bridgehead>

        <para>A few notes on XML manifests. Please note that due to one of the
        myriads of JInstaller's bugs and limitations your component's XML
        manifest SHOULD be placed in the package's root and MUST begin with a
        letter before "L". We recommend using the following naming convention
        to prevent package installation problems due to Joomla! being outright
        silly in its handling of manifests:</para>

        <itemizedlist>
          <listitem>
            <para>Components: com_something.xml</para>
          </listitem>

          <listitem>
            <para>Plugins: plg_something.xml</para>
          </listitem>

          <listitem>
            <para>Modules: mod_something.xml</para>
          </listitem>

          <listitem>
            <para>Libraries: lib_something.xml</para>
          </listitem>

          <listitem>
            <para>Files: files_something.xml</para>
          </listitem>
        </itemizedlist>

        <para>Using this convention you ensure that when you list all XML
        manifests in the package and sort them alphabetically the component's
        manifest will show up first. This is exactly how Joomla! decides which
        XML manifest to use for installing a package: list all of them,
        alpha-sort them and pick the first one.</para>

        <bridgehead>Creating your installation script</bridgehead>

        <para>Let's say your component is called Foobar and its Joomla! name
        is com_foobar. You need to create the file
        <filename>script.foobar.php</filename> and place it in the root of
        your package. The file name and location of the script are extremely
        important! They are defined in your XML manifest, using a line like
        this:</para>

        <programlisting language="xml">&lt;scriptfile&gt;script.foobar.php&lt;/scriptfile&gt;</programlisting>

        <para>You are advised to follow this naming convention and place the
        script in your package's root to avoid nasty surprises.</para>

        <para>Next up, you need to put the following contents in your script
        file:</para>

        <programlisting language="php">&lt;?php
// no direct access
defined('_JEXEC') or die;

// Load FOF if not already loaded
if (!defined('F0F_INCLUDED'))
{
  $paths = array(
    (defined('JPATH_LIBRARIES') ? JPATH_LIBRARIES : JPATH_ROOT . '/libraries') . '/f0f/include.php',
    __DIR__ . '/fof/include.php',
  );

  foreach ($paths as $filePath)
  {
    if (!defined('F0F_INCLUDED') &amp;&amp; file_exists($filePath))
    {
      @include_once $filePath;
    }
  }
}

class Com_FoobarInstallerScript extends F0FUtilsInstallscript
{
    protected $componentName = 'com_foobar';
    protected $componentTitle = 'Foobar Component';
}</programlisting>

        <para>Let's analyse this script. We begin by preventing direct access
        to the file in the standard Joomla! way:</para>

        <programlisting language="php" xml:id="installscript-p1">// no direct access
defined('_JEXEC') or die;
</programlisting>

        <para>Then we have to load FOF. We need to do that because the
        F0FUtilsInstallscript which powers our installation script is part of
        FOF. However FOF might not be already installed on the site. In this
        case we'll be loading it from our installation directory. Speaking of
        which, an important note to understand why this works.</para>

        <important>
          <para>Your installation script is loaded from the component's
          installation directory, typically a temporary directory created by
          the Joomla! extensions installer. It is loaded BEFORE Joomla!
          installs / updates / uninstalls your component. This is very
          important to keep in mind, especially if you are going to work with
          relative directories in your customised installation script.</para>
        </important>

        <para>So here we go loading FOF:</para>

        <programlisting language="php">// Load FOF if not already loaded
if (!defined('F0F_INCLUDED'))
{
  $paths = array(
    (defined('JPATH_LIBRARIES') ? JPATH_LIBRARIES : JPATH_ROOT . '/libraries') . '/f0f/include.php',
    __DIR__ . '/fof/include.php',
  );

  foreach ($paths as $filePath)
  {
    if (!defined('F0F_INCLUDED') &amp;&amp; file_exists($filePath))
    {
      @include_once $filePath;
    }
  }
}</programlisting>

        <para>Please note that if the FOF directory in your package has a
        different name you will need to modify __DIR__ . '/<emphasis
        role="bold">fof</emphasis>/include.php' to reflect the name you chose
        and nothing else at all in this block of code.</para>

        <para>Next up we define our installation script class for Joomla! to
        find it:</para>

        <programlisting language="php">class Com_FoobarInstallerScript extends F0FUtilsInstallscript
</programlisting>

        <warning>
          <para>Naming your installation class is EXTREMELY IMPORTANT. If you
          do not follow the naming convention TO THE LETTER Joomla! will not
          "see" your installation script. This results to immense amounts of
          hair pulling as Joomla! throws no error whatsoever when you tell it
          to use an installation script and it doesn't find one.</para>
        </warning>

        <para>The naming is extremely important. The name must begin with the
        Joomla! name of your component, with the Com and extension name
        capitalised, i.e. Com_Foobar. If you use something like com_foobar,
        Com_foobar, com_Foobar, COM_Foobar, COM_FOOBAR etc Joomla! WILL NOT BE
        ABLE TO FIND YOUR INSTALLATION SCRIPT AND WILL NOT RUN IT AT ALL. Then
        it must be followed by exactly InstallerScript. Again, case matters.
        If you use installerScript, installerscript etc Joomla! will NOT be
        able to find your installation script. Mind your case!</para>

        <para>The final few lines tell the installation script the component
        name and the human-readable title.</para>

        <programlisting language="php">{
    protected $componentName = 'com_foobar';
    protected $componentTitle = 'Foobar Component';
}</programlisting>

        <para>As is, the installation script will do the following:</para>

        <orderedlist>
          <listitem>
            <para>Make sure your component is being installed on Joomla! 2.5.6
            or later using PHP 5.3.3 or later</para>
          </listitem>

          <listitem>
            <para>Install or update your database tables using the XML schema
            files (see <link linkend="utils-databaseinstaller">the database
            schema installer / updater / removal class</link>)</para>
          </listitem>

          <listitem>
            <para>Install or update FOF if the version bundled with your
            component is newer than the installed one</para>
          </listitem>

          <listitem>
            <para>Install or update Akeeba Strapper if the version bundled
            with your component is newer than the installed one</para>
          </listitem>

          <listitem>
            <para>Work around known Joomla! bugs affecting the generation /
            update of administrator menu items for newly installed and update
            components</para>
          </listitem>

          <listitem>
            <para>Display an installation overview page, letting the user of
            what was installed on their site</para>
          </listitem>
        </orderedlist>

        <para>When uninstalling the component, the installation script as is
        right now will do the following:</para>

        <orderedlist>
          <listitem>
            <para>Remove your database tables using the XML schema files (see
            <link linkend="utils-databaseinstaller">the database schema
            installer / updater / removal class</link>)</para>
          </listitem>

          <listitem>
            <para>Display an uninstallation overview page, letting the user of
            what was removed from their site</para>
          </listitem>
        </orderedlist>

        <warning>
          <para><emphasis role="bold">NEVER, EVER</emphasis> uninstall FOF or
          Akeeba Strapper when uninstalling your component. Joomla! does not
          provide a way to track dependencies. As a result you can never know
          if anything else installed on your client's site is using FOF or
          Akeeba Strapper, making their removal problematic (you could break
          another developer's perfectly working code). If any developer is
          caught doing that we will have to put them on a blacklist and take
          action against their software.</para>
        </warning>

        <bridgehead>Customising the installation script</bridgehead>

        <para>All customisation can be done by overriding the protected
        properties and methods of F0FUtilsInstallscript. The properties
        are:</para>

        <variablelist>
          <varlistentry>
            <term>componentName</term>

            <listitem>
              <para><emphasis role="bold">MANDATORY</emphasis>. The
              component's name, e.g. 'com_foobar'. You absolutely need to set
              this, otherwise</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>componentTitle</term>

            <listitem>
              <para><emphasis role="bold">MANDATORY</emphasis>. The
              component's human readable title, e.g. 'My Foobar Component'.
              This is shown in the installation and uninstallation overview
              page.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>installation_queue</term>

            <listitem>
              <para>The list of extra modules and plugins to install on
              component installation / update and remove on component
              uninstallation. This is an array which looks like this:</para>

              <programlisting language="php">protected $installation_queue = array(
  // modules =&gt; { (folder) =&gt; { (module) =&gt; { (position), (published) } }* }*
  'modules' =&gt; array(
    'admin' =&gt; array(
      'adminmodule' =&gt; array('cpanel', 1),
    ),
    'site'  =&gt; array(
      'mymodule' =&gt; array('position-1', 0),
      'othermodule' =&gt; array('position-2', 1),
    )
  ),
  // plugins =&gt; { (folder) =&gt; { (element) =&gt; (published) }* }*
  'plugins' =&gt; array(
    'system' =&gt; array(
      'foobar' =&gt; 1,
      'baz' =&gt; 0
    ),
  )
);
</programlisting>

              <para>The <emphasis role="bold">modules</emphasis> key is an
              array containing exactly two keys, admin and site, both being
              arrays containing the list of administrator (back-end) and site
              (front-end) modules to be installed respectively.</para>

              <para>Each module definition consists of a key which is the
              module name and its content is an array with two values. The
              first value is the position the module should be installed to
              and the second value indicated whether the module will be
              published by default.</para>

              <para>In the example above the adminmodule is an administrator
              module which will be placed in the cpanel module position and
              published whenever the component is installed or updated.</para>

              <para>The <emphasis role="bold">plugins</emphasis> key is an
              array containing one or more keys. Each key is the name of a
              Joomla! plugins folder and its contents is an array containing
              the list of plugins to install.</para>

              <para>Each plugin definition consists of a key which is the
              plugin name and its content is a value which indicates whether
              the plugin will be published by default.</para>

              <para>In the example above the plg_system_foobar plugin will be
              published whenever the component is installed or updated. The
              plg_system_baz plugin, however, will not be published or
              unpublished whenever the component is installed or
              updated.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>uninstallation_queue</term>

            <listitem>
              <para>The list of obsolete extra modules and plugins to
              uninstall on component upgrade / installation. Please note that
              this IS NOT used when uninstalling the component. When you
              uninstall the component all the plugins and modules listed in
              $installation_queue will be removed automatically. The reason of
              $uninstallation_queue's existence is a simple way to uninstall
              obsolete plugins and modules when you update a component. It is
              an array like this:</para>

              <programlisting language="php">protected $uninstallation_queue = array(
  // modules =&gt; { (folder) =&gt; { (module) }* }*
  'modules' =&gt; array(
    'admin' =&gt; array(
       'adminobsolete'
    ),
    'site'  =&gt; array()
  ),
  // plugins =&gt; { (folder) =&gt; { (element) }* }*
  'plugins' =&gt; array(
    'system' =&gt; array(
      'obsoleteplugin'
    ),
  )
);
</programlisting>

              <para>The <emphasis role="bold">modules</emphasis> key is an
              array containing exactly two keys, admin and site, both being
              arrays containing the list of administrator (back-end) and site
              (front-end) modules to be uninstalled respectively.</para>

              <para>Each module definition consists of a single value which is
              the module name to be uninstalled.</para>

              <para>In the example above the adminobsolete is an administrator
              module which will be uninstalled when you install or upgrade the
              component.</para>

              <para>The <emphasis role="bold">plugins</emphasis> key is an
              array containing one or more keys. Each key is the name of a
              Joomla! plugins folder and its contents is an array containing
              the list of plugins to uninstall.</para>

              <para>Each plugin definition consists of a single value which is
              the plugin name.</para>

              <para>In the example above the plg_system_obsoleteplugin plugin
              will be uninstalled whenever the component is installed or
              updated.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>removeFilesFree</term>

            <listitem>
              <para>Obsolete files and folders to remove from the free version
              only. This is used when you move a feature from the free version
              of your extension to its paid version ($isPaid is true). If you
              don't have such a distinction you can ignore this and use the
              $removeFilesAllVersion option instead. The format is:</para>

              <programlisting language="php">protected $removeFilesFree = array(
  'files'   =&gt; array(
    'administrator/components/com_foobar/helpers/whatever.php'
  ),
  'folders' =&gt; array(
    'administrator/components/com_foobar/baz'
  )
);</programlisting>

              <para>The array has exactly two keys. The <emphasis
              role="bold">files</emphasis> key is an array containing a list
              of files to be removed on installation / update. The <emphasis
              role="bold">folders</emphasis> key is an array containing a list
              of folders to be recursively removed on installation / update.
              Files and folders are given as paths relative to the site's
              root.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>removeFilesAllVersions</term>

            <listitem>
              <para>Obsolete files and folders to remove from both paid and
              free releases. This is used when you refactor code and some
              files inevitably become obsolete and need to be removed. These
              files are always removed, no matter what the $isPaid value is
              Its format is the same as removeFilesFree.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>cliScriptFiles</term>

            <listitem>
              <para>A list of all CLI scripts to be copied to the "cli"
              directory of the site. These are copied from the package
              directory defined in $cliSourcePath. Its format is a simple
              array listing the names of the files to be copied.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>cliSourcePath</term>

            <listitem>
              <para>The path inside your package where cli scripts are stored.
              Please remember that this is the path inside your package, NOT
              the path inside your user's site.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>fofSourcePath</term>

            <listitem>
              <para>The path inside your package where FOF is stored. Please
              remember that this is the path inside your package, NOT the path
              inside your user's site.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>strapperSourcePath</term>

            <listitem>
              <para>The path inside your package where Akeeba Strapper is
              stored. Please remember that this is the path inside your
              package, NOT the path inside your user's site.</para>

              <para>Installing Akeeba Strapper with your component is
              optional. If this path does not exist Akeeba Strapper will
              simply not be installed.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>modulesSourcePath</term>

            <listitem>
              <para>The path inside your package where modules to be installed
              are stored. Please remember that this is the path inside your
              package, NOT the path inside your user's site.</para>

              <para>Installing modules with your component is optional. If
              this path does not exist no module will be installed.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>pluginsSourcePath</term>

            <listitem>
              <para>The path inside your package where extra plugins are
              stored. Please remember that this is the path inside your
              package, NOT the path inside your user's site.</para>

              <para>Installing plugins with your component is optional. If
              this path does not exist no plugin will be installed.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>schemaXmlPathRelative</term>

            <listitem>
              <para>Is the schemaXmlPath class variable a relative path? If
              set to true the schemaXmlPath variable contains a path relative
              to the component's back-end directory. If set to false the
              schemaXmlPath variable contains an absolute filesystem path.
              This is used when installing / updating / removing your database
              tables using the XML schema files.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>schemaXmlPath</term>

            <listitem>
              <para>The path where the schema XML files are stored. Its
              contents depend on the schemaXmlPathRelative variable
              above</para>

              <itemizedlist>
                <listitem>
                  <para>true. schemaXmlPath contains a path relative to the
                  component's back-end directory</para>
                </listitem>

                <listitem>
                  <para>false. schemaXmlPath contains an absolute filesystem
                  path</para>
                </listitem>
              </itemizedlist>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>minimumPHPVersion</term>

            <listitem>
              <para>The minimum PHP version required to install this
              extension. If it's empty no minimum version check will be
              performed. You are advised to not set it to a version lower than
              what FOF requires (5.3.3)</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>minimumJoomlaVersion</term>

            <listitem>
              <para>The minimum Joomla! version required to install this
              extension. If it's empty no minimum version check will be
              performed.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>maximumJoomlaVersion</term>

            <listitem>
              <para>The maximum Joomla! version this extension can be
              installed on. If it's empty no maximum version check will be
              performed.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>isPaid</term>

            <listitem>
              <para>Is this the paid version of the extension? This only
              determines which files / extensions will be removed. This is
              strictly optional.</para>
            </listitem>
          </varlistentry>
        </variablelist>

        <para>As for the methods you can consult the docblocks in
        F0FUtilsInstallscript.</para>
      </section>

      <section xml:id="utils-databaseinstaller">
        <title>The database schema installer / updater / removal class</title>

        <note>
          <para>Available since FOF 2.3.0</para>
        </note>

        <para>One of the most important operations in managing a component is
        being able to install, update and remove its database schema. Normally
        you do that using the relevant sections in your extension's manifest
        file. The big problem with this approach is that you are using the
        short-sighted code in Joomla!'s own extensions installer. The
        Achilles' heel in Joomla!'s code is that database installation and
        updates depend solely on the contents of the
        <database>#__schemas</database> table. If no version is recorded
        there, Joomla! is using your installation SQL file. If it contains a
        version it will try to run all SQL scripts with a name which indicates
        a version later than the one recorded in the schemas table. This
        leaves a lot of room for spectacular failures in the following cases,
        which happen far more frequently than you'd imagine:</para>

        <itemizedlist>
          <listitem>
            <para>The #__schemas entry is empty but (some of) the database
            tables already exist, for example is the user is transferring
            tables manually, upgrading from an earlier Joomla! version using a
            third party tool, a previous installation has gone wrong
            etc</para>
          </listitem>

          <listitem>
            <para>The #__schemas entry is out of date, e.g. the installer
            timed out before updating it</para>
          </listitem>

          <listitem>
            <para>A previous installation resulted in a SQL error</para>
          </listitem>
        </itemizedlist>

        <para>In all of the above cases Joomla! will throw a SQL error and
        your clients will think that you are a moron who can't even install
        their own component's database properly. Well, it's time to claim your
        power over Joomla! thanks to FOF!</para>

        <para>FOF 2.3.0 and later comes with the
        <classname>F0FDatabaseInstaller</classname> class. Unlike Joomla!, it
        doesn't base its actions on unreliable version numbers. Instead, it
        will run SQL commands based on whether tables / fields exist, the
        reported type of fields or the result of custom SQL commands. It goes
        even further than that by letting YOU, the developer, to choose if the
        failure of executing a particular SQL command should raise a blocking
        SQL error or be silently ignored. This is database schema management
        on steroids.</para>

        <para>The schema files are provided in XML format. You only need one
        XML file per database technology. By default these files are stored in
        the back-end of your component, under the <filename>sql/xml</filename>
        directory. This is something you can override through the
        <parameter>$config</parameter> array you pass to the class
        constructor. The recognised parameters are:</para>

        <variablelist>
          <varlistentry>
            <term>input</term>

            <listitem>
              <para>The F0FInput object, used only when
              <parameter>option</parameter> is not specified to figure out
              which component we are referring to. You are advised to use the
              <parameter>dbinstaller_directory</parameter> parameter
              instead.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>db</term>

            <listitem>
              <para>The database object used to execute the SQL commands. If
              none is specified the default system-wide database object will
              be used.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>option</term>

            <listitem>
              <para>The name of the component, e.g
              <option>com_foobar</option>. This is used to determine the
              default location of the XML schema files if
              <parameter>dbinstaller_directory</parameter> is not defined. If
              not specified it will be read from the
              <parameter>option</parameter> key of the
              <parameter>input</parameter> object.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>dbinstaller_directory</term>

            <listitem>
              <para>The absolute filesystem path where the XML schema files
              are located. If not specified we will use the
              <filename>sql/xml</filename> directory at the back-end of the
              component.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>dbinstaller_files</term>

            <listitem>
              <para>A comma-separated list or array of the base names of the
              schema files we will be looking for. The default value is:
              <option>array('mysql', 'mysqli', 'postgresql', 'sqlsrv',
              'mssql')</option> Please note that the name of the file doesn't
              have to be the same as the database technology you are using.
              See further below for the format of the SQL file.</para>
            </listitem>
          </varlistentry>
        </variablelist>

        <para>The class provides two methods you can use <emphasis>anywhere in
        your component</emphasis>:</para>

        <programlisting language="php">public function updateSchema()</programlisting>

        <para>It creates or updates the tables of your component in the
        database. You are suggested to call this in two places: in your
        installation script and in the main back-end page of your component.
        The latter place is not very obvious, but it allows your component to
        update its tables even without going through the installer. You will
        thank yourself for doing that when an installation fails due to a
        timeout error (resulting in an inconsistency between schema and code)
        and when you pull a Git repository on a test server. No need to run
        SQL commands manually, just visit your component's back-end page and
        presto! The database schema is updated. You're welcome.</para>

        <programlisting language="php">public function removeSchema()</programlisting>

        <para>It removes (drops) the tables of your component. You are
        recommended to only use it in the uninstallation script of your
        component. Beware! It really does what it says on the tin. It will
        remove all database tables you mention in your XML schema file without
        any further warning. One line and the data dies, permanently.</para>

        <bridgehead>Format of the XML schema files</bridgehead>

        <programlisting language="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;schema&gt;
    &lt;!-- Metadata --&gt;
    &lt;meta&gt;
        &lt;!-- Supported driver types --&gt;
        &lt;drivers&gt;
            &lt;driver&gt;mysql&lt;/driver&gt;
            &lt;driver&gt;mysqli&lt;/driver&gt;
        &lt;/drivers&gt;
    &lt;/meta&gt;

    &lt;!-- SQL commands to run on installation and update --&gt;
    &lt;sql&gt;
        &lt;!-- Create the #__foobar_profiles table if it's missing --&gt;
        &lt;action table="#__foobar_profiles" canfail="0"&gt;
            &lt;condition type="missing" value="" /&gt;
            &lt;query&gt;&lt;![CDATA[
CREATE TABLE `#__foobar_profiles` (
`foobar_profile_id` int(10) unsigned NOT NULL AUTO_INCREMENT,
`description` varchar(255) NOT NULL,
`params` longtext,
PRIMARY KEY (`id`)
) DEFAULT CHARACTER SET utf8;
            ]]&gt;&lt;/query&gt;
        &lt;/action&gt;
        &lt;action table="#__foobar_profiles" canfail="0"&gt;
            &lt;condition type="missing" value="params" /&gt;
            &lt;query&gt;&lt;![CDATA[
ALTER TABLE `#__foobar_profiles` ADD `params` longtext AFTER `description`;
            ]]&gt;&lt;/query&gt;
        &lt;/action&gt;
    &lt;/sql&gt;
&lt;/schema&gt;</programlisting>

        <para>As you can see the file has the root element
        <tag>&lt;schema&gt;</tag> and consists of two sections.</para>

        <bridgehead renderas="sect4">The <tag>&lt;meta&gt;</tag>
        section</bridgehead>

        <para>This section has a lone element, <tag>&lt;drivers&gt;</tag>,
        which tells FOF which database technologies this XML schema file
        applies to. Put one driver name in each <tag>&lt;driver&gt;</tag>
        child element. The driver names recognised are those that Joomla!
        supports. By the latest count they are: mysql, mysqli, postgresql,
        sqlsrv, sqlazure</para>

        <warning>
          <para>Joomla! seems to only be tested properly against the mysql and
          mysqli drivers. We have been observing inconsistent behaviour with
          the other drivers. You are advised AGAINST supporting these database
          technologies unless you enjoy receiving bug reports which you can't
          fix because the problem is in Joomla!, not your code.</para>
        </warning>

        <bridgehead renderas="sect4">The <tag>&lt;sql&gt;</tag>
        section</bridgehead>

        <para>This is where all the action takes place. And that's why you
        have one or more <tag>&lt;action&gt;</tag> tags. Each
        <tag>&lt;action&gt;</tag> tag defines SQL commands which should run
        when one or more conditions are met. Each tag has the following
        attributes:</para>

        <variablelist>
          <varlistentry>
            <term>table</term>

            <listitem>
              <para>REQUIRED. The table this action operates on, e.g.
              <option>#__foobar_categories</option></para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>canfail</term>

            <listitem>
              <para>(optional) If it's set to 0 (default) if any SQL command
              in this action tag fails the error will bubble up and throw a
              system error, preventing further execution. If it's set to 1 all
              SQL errors are ignored. This setting can be overridden in each
              <tag>&lt;query&gt;</tag> tag.</para>
            </listitem>
          </varlistentry>
        </variablelist>

        <para>Let's start with the <emphasis
        role="bold">conditions</emphasis>. They are defined by one or more
        <tag>&lt;condition&gt;</tag> tags. All <tag>&lt;condition&gt;</tag>
        tags accept the <parameter>operator</parameter> attribute which can
        have one of the following values:</para>

        <variablelist>
          <varlistentry>
            <term>and</term>

            <listitem>
              <para>(default) This condition must be true</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>not</term>

            <listitem>
              <para>This condition must be false</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>or</term>

            <listitem>
              <para>Either this condition or its previous conditions must be
              true</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>nor</term>

            <listitem>
              <para>Either this condition must be false or its previous
              conditions must be true</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>xor</term>

            <listitem>
              <para>Either this condition or its previous conditions must be
              true, but not both</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>maybe</term>

            <listitem>
              <para>Equivalent to "or"</para>
            </listitem>
          </varlistentry>
        </variablelist>

        <para>Any other value is treated as "and". As you may have noticed
        this is straightforward Boolean algebra.</para>

        <para>The kind of check performed by a <tag>&lt;condition&gt;</tag>
        tag is determined by its <parameter>type</parameter> attribute:</para>

        <variablelist>
          <varlistentry>
            <term>missing</term>

            <listitem>
              <para>Checks if a table or a field of the table is missing. This
              depends on the <parameter>value</parameter> of the value
              attribute of the tag:</para>

              <itemizedlist>
                <listitem>
                  <para>If it's empty FOF will check if the table defined by
                  the <parameter>table</parameter> attribute of the
                  <tag>&lt;action&gt;</tag> tag exists.</para>
                </listitem>

                <listitem>
                  <para>If it's not empty FOF will check if the field whose
                  name you've put in the <parameter>value</parameter>
                  attribute exists in the table defined by the
                  <parameter>table</parameter> attribute of the
                  <tag>&lt;action&gt;</tag> tag.</para>
                </listitem>
              </itemizedlist>

              <para>This is useful to install tables if they are missing or
              add missing fields to tables.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>type</term>

            <listitem>
              <para>FOF checks if the type of a database field matches what
              you expect. The field will be searched in the
              <parameter>table</parameter> attribute of the
              <tag>&lt;action&gt;</tag> tag. It requires two
              attributes:</para>

              <itemizedlist>
                <listitem>
                  <para><parameter>value</parameter>. The name of the
                  field.</para>
                </listitem>

                <listitem>
                  <para><parameter>coltype</parameter>. The expected field
                  type (case insensitive). Please note that this expects the
                  full field type definition, e.g. "VARCHAR(255) NULL" and NOT
                  just "VARCHAR". This is a limitation of Joomla!'s database
                  drivers.</para>
                </listitem>
              </itemizedlist>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>equals</term>

            <listitem>
              <para>FOF checks the result of a SQL query against the
              <parameter>value</parameter> attribute. In this case the content
              of the <tag>&lt;condition&gt;</tag> tag gives the SQL query to
              execute. For example:</para>

              <programlisting language="xml">        &lt;action table="#__admintools_profiles" canfail="1"&gt;
            &lt;condition type="equals" operator="not" value="1"&gt;&lt;![CDATA[
SELECT COUNT(*) FROM `#__admintools_profiles` WHERE `id` = 1;
            ]]&gt;&lt;/condition&gt;

            &lt;query canfail="1"&gt;&lt;![CDATA[
INSERT IGNORE INTO `#__admintools_profiles`
(`id`,`description`, `configuration`, `filters`) VALUES
(1,'Default PHP Change Scanner Profile','','');
            ]]&gt;&lt;/query&gt;
        &lt;/action&gt;
</programlisting>

              <para>In this case we are checking if the COUNT query returns
              "1". If not (due to the "not" operator) we will run the INSERT
              IGNORE query.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>true</term>

            <listitem>
              <para>Always returns true. Useful to run index creation as
              indices cannot be reliably detected across all database types
              (again, a limitation of Joomla!'s database drivers…).</para>
            </listitem>
          </varlistentry>
        </variablelist>

        <para>Next up you have one or more <tag>&lt;query&gt;</tag> tags. When
        the conditions are met they will all execute. The only attribute you
        can have is <parameter>canfail</parameter> and it's optional. If you
        skip it FOF will use the <parameter>canfail</parameter> attribute of
        the <tag>&lt;action&gt;</tag> tag.</para>

        <para>As you see this feature is extremely simple and extremely
        powerful. If you use it wisely it will make your component's database
        installation and maintenance seem to take place magically!</para>
      </section>

      <section xml:id="utils-update">
        <title>The update model helper</title>

        <note>
          <para>Available since FOF 2.3.0</para>
        </note>

        <para>Joomla! comes with an extensions updater feature. That said, its
        API is hard to use and leads to a lot of code repetition. Even worse,
        trying to use the support for commercial extensions is even worse.
        This is why FOF comes with the <classname>F0FUtilsUpdate</classname>
        model class.</para>

        <para>This class is not designed to be used on its own. You will need
        to create a Model in your extension extending from this class. For
        example:</para>

        <programlisting language="php">class FoobarModelUpdates extends F0FUtilsUpdate {}</programlisting>

        <para>As is it won't help you much. At the very least you have to tell
        it which component this model refers to. You can do so in your
        constructor. For example:</para>

        <programlisting language="php">class FoobarModelUpdates extends F0FUtilsUpdate {

  public function __construct($config = array())
  {
    $config['update_component'] = 'com_foobar';

    parent::__construct($config);
  }
}</programlisting>

        <para>You can now get the updates to your component by doing</para>

        <programlisting language="php">$updateInfo = F0FModel::getTmpInstance('Updates', 'FoobarModel')-&gt;getUpdates();</programlisting>

        <para>This will return an array with the following keys:</para>

        <variablelist>
          <varlistentry>
            <term>hasUpdate</term>

            <listitem>
              <para>Boolean. True if there is an updated version
              available.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>version</term>

            <listitem>
              <para>String. The version number of the updated version
              available.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>infoURL</term>

            <listitem>
              <para>String. The optional information URL as found in the
              extension's update XML stream.</para>
            </listitem>
          </varlistentry>
        </variablelist>

        <para>If you want to find out the current version of your extension
        you can do:</para>

        <para><programlisting language="php">$currentVersion = F0FModel::getTmpInstance('Updates', 'FoobarModel')-&gt;getVersion();</programlisting>And
        now you have all the update information you might need.</para>

        <para>In order to modify the update site and/or use the Joomla! 3.2 or
        later support for paid extensions you need to first define a few
        things in your constructor:</para>

        <programlisting language="php">class FoobarModelUpdates extends F0FUtilsUpdate {

  public function __construct($config = array())
  {
    $config['update_component'] = 'com_foobar';
    $config['update_sitename'] = 'Foobar updates';
    $config['update_site'] = 'http://www.example.com/updates/com_foobar.xml';
    $config['update_extraquery'] = 'authorisation=mySuperSecretCode';

    parent::__construct($config);
  }
}</programlisting>

        <para>The parameters you are setting are:</para>

        <variablelist>
          <varlistentry>
            <term>update_sitename</term>

            <listitem>
              <para>The name of the update site, as stored in Joomla!'s
              #__update_sites table and used... nowhere at all (typical
              Joomla)!</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>update_site</term>

            <listitem>
              <para>The URL to the update XML file for this extension</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>update_extraquery</term>

            <listitem>
              <para>Something to be appended to the download URL. The idea is
              that you'll be using this to authenticate your clients to your
              site and allow them to download your commercial extension. It's
              a good idea to never hardcode this parameter but read it from
              your component's configuration.</para>
            </listitem>
          </varlistentry>
        </variablelist>

        <para>Then, somewhere in your component, you need to run:</para>

        <programlisting language="php">$currentVersion = F0FModel::getTmpInstance('Updates', 'FoobarModel')-&gt;refreshUpdateSite();</programlisting>

        <para>It's a good idea to put that in your component's control panel
        controller, in the onBeforeBrowse() method.</para>
      </section>
    </section>
  </chapter>

  <chapter xml:id="features-reference">
    <title>Features reference</title>

    <section xml:id="configuring-mvc">
      <title>Configuring MVC</title>

      <para>All MVC and associated classes in FOF (Dispatcher, Controller,
      Model, View, Table, Toolbar) come with a default behavior, for example
      where to look for model files, how to handle request data and so on.
      While this is fine most of the times –as long as you follow FOF’s
      conventions– this is not always desirable.</para>

      <para>For example, if you are building a CCK (something like K2) you may
      want to look for view templates in a non-standard directory in order to
      support alternative “themes”. Or, maybe, if you're building a contact
      component you only want to expose the add view to your front-end users
      so that they can file a contact request but not view other people's
      contact requests. You get the idea.</para>

      <para>The traditional approach to development prescribes overriding
      classes, even to the extent of copying and pasting code. If you've ever
      attended one of my presentations you've probably figured that I consider
      copying and pasting code a mortal sin. You may have also figured that,
      like all developers, I am lazy and dislike writing lots of code.
      Naturally, FOF being a RAD tool it provides an elegant solution to this
      problem. The <varname>$config</varname> array and its sibling, the
      <filename>fof.xml</filename> file.</para>

      <section xml:id="config-array">
        <title>The $config array</title>

        <para>You may have observed that FOF’s MVC classes can be passed an
        optional array parameter <varname>$config</varname>. This is a hash
        array with configuration options. It is being passed from the
        Dispatcher to the Controller and from there to the Model, View and
        Table classes. Essentially, this is your view (MVC triad)
        configuration. Setting its options allows you to modify FOF’s internal
        workings without writing code.</para>

        <para>The various possible settings are explained in The configuration
        settings section below.</para>
      </section>

      <section xml:id="fofxml-file">
        <title>The fof.xml file</title>

        <para>The <varname>$config</varname> array is a great idea but has a
        major drawback: you have to create one or several .php files with
        specialized classes to use it. Remember the FOF promise about not
        having to write code unless absolutely necessary? Yep, this doesn’t
        stick very well with that promise. So the <filename>fof.xml</filename>
        file was born in FOF 2.1.</para>

        <para>The <filename>fof.xml</filename> file is a simple XML file
        placed inside your component's back-end directory, e.g.
        <filename>administrator/com_example/fof.xml</filename>. It contains
        configuration overrides for the front-end, back-end and CLI parts of
        your FOF component.</para>

        <bridgehead>A sample fof.xml file</bridgehead>

        <programlisting language="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;fof&gt;
    &lt;!-- Common settings --&gt;
    &lt;common&gt;
        &lt;!-- Table options common to all tables --&gt;
        &lt;table name="*"&gt;
            &lt;field name="locked_by"&gt;checked_out&lt;/field&gt;
            &lt;field name="locked_on"&gt;checked_out_time&lt;/field&gt;
            &lt;relation type="children" name="items" /&gt;
            &lt;relation type="multiple" name="transactions" localKey="foobar_order_id"
                      ourPivotKey="foobar_order_id" theirPivotKey="foobar_transaction_id"
                      remoteKey="foobar_transaction_id"
                      pivotTable="#__foobar_orders_transactions" default="true" /&gt;
        &lt;/table&gt;
        &lt;!-- Table options for a specific table --&gt;
        &lt;table name="item"&gt;
            &lt;field name="enabled"&gt;published&lt;/field&gt;
        &lt;/table&gt;
    &lt;/common&gt;    

    &lt;!-- Component back-end options --&gt;
    &lt;backend&gt;
        &lt;!-- Dispatcher options --&gt;
        &lt;dispatcher&gt;
            &lt;option name="default_view"&gt;items&lt;/option&gt;
        &lt;/dispatcher&gt;
    &lt;/backend&gt;

    &lt;!-- Component front-end options --&gt;
    &lt;frontend&gt;
        &lt;!-- Dispatcher options --&gt;
        &lt;dispatcher&gt;
            &lt;option name="default_view"&gt;item&lt;/option&gt;
        &lt;/dispatcher&gt;
        &lt;!-- Options common for all views --&gt;
        &lt;view name="*"&gt;
            &lt;!-- Per-task ACL settings. The star task sets the default ACL privileges for all tasks. --&gt;
            &lt;acl&gt;
                &lt;task name="*"&gt;false&lt;/task&gt;
            &lt;/acl&gt;
        &lt;/view&gt;
        &lt;view name="item"&gt;
            &lt;!-- Task mapping --&gt;
            &lt;taskmap&gt;
                &lt;task name="list"&gt;browse&lt;/task&gt;
            &lt;/taskmap&gt;
            &lt;!-- Per-task ACL settings. An empty string removes ACL checks. --&gt;
            &lt;acl&gt;
                &lt;!-- Everyone, including guests, can access dosomething --&gt;
                &lt;task name="dosomething"&gt;&lt;/task&gt;
                &lt;!-- Only people with the core.manage privilege can access the somethingelse task --&gt;
                &lt;task name="somethingelse"&gt;core.manage&lt;/task&gt;
            &lt;/acl&gt;
            &lt;!-- Configuration options for the model and view --&gt;
            &lt;config&gt;
                &lt;option name="behaviors"&gt;filter,access&lt;/option&gt;
            &lt;/config&gt;
        &lt;/view&gt;
    &lt;/frontend&gt;
&lt;/fof&gt;
</programlisting>

        <para>The <filename>fof.xml</filename> file has an
        <code>&lt;fof&gt;</code> root element. Inside it you can have zero or
        one tags called <code>&lt;frontend&gt;</code>,
        <code>&lt;backend&gt;</code> and <code>&lt;cli&gt;</code> which
        configure FOF for front-end, back-end and CLI access respectively. You
        may also have a tag named <code>&lt;common&gt;</code> which defines
        settings applicable for any mode of access. These common settings will
        be overridden by the corresponding settings defined in the
        <code>&lt;frontend&gt;</code>, <code>&lt;backend&gt;</code> and
        <code>&lt;cli&gt;</code>. Please note that the CLI is yet another
        special case: it will mix the common, back-end and CLI settings to
        derive the final configuration. In the other two cases (front- or
        back-end access) only the common and the configuration for this
        specific mode of access will be used.</para>

        <section xml:id="fofxml-dispatcher">
          <title>Dispatcher settings</title>

          <para>You can configure the way the Dispatcher works using the
          <code>&lt;dispatcher&gt;</code> tag. Inside it you can have one or
          more <code>&lt;option&gt;</code> tags. The name attribute defines
          the name of the configuration variable to set, while the tag's
          content defines the value of this configuration variable.</para>

          <para>The available variables are:</para>

          <variablelist>
            <varlistentry>
              <term>default_view</term>

              <listitem>
                <para>Defines the default view to show if none is defined in
                the input data. By default this is cpanel. In the example
                above we set it to items in the back-end and item in the
                front-end.</para>
              </listitem>
            </varlistentry>
          </variablelist>
        </section>

        <section xml:id="fofxml-table">
          <title>Table settings</title>

          <para>The table settings allow you to set up table options, in case
          you do not wish to use the default conventions of FOF. You define
          the table the options apply to using the name attribute of the view
          tag. Please note that this is the name used in the class, not in the
          database. So, if you have a database table named
          <database>#__example_items</database> and your class is named
          <classname>ExampleTableItem</classname> you must use
          <code>name="item"</code> in the <filename>fof.xml</filename>
          file.</para>

          <para>The settings of each table are isolated from the settings of
          every other table, with one notable exception: the star table, i.e.
          <code>name="*"</code>. This is a placeholder table that defines the
          default settings. These settings are applied to all tables. If you
          also have a table tag for a view, the default settings (from the
          star table) and the settings for the particular table are merged
          together. This applies to all settings described below.</para>

          <bridgehead>Field map settings</bridgehead>

          <para>The field map settings allow you to map specific magic field
          names to your table's fields, in case you do not use FOF's
          contentions. It works the same way as adding setting the
          <varname>_columnAlias</varname> array in your specialized Table
          class.</para>

          <para>The field map is enclosed inside the
          <code>&lt;table&gt;</code> tag itself. It consists of one or more
          <code>&lt;field&gt;</code> tags. The name attribute defines the name
          of the magic (FOF convention) field to map, whereas the content of
          the tag defines the name of the field in your database table.</para>

          <bridgehead>Relation settings</bridgehead>

          <note>
            <para>Available since FOF 2.2.0</para>
          </note>

          <para>The relation settings allow you to define the table relations
          used by the ORM-like feature introduced in FOF 2.2.0.</para>

          <para>One or more <code>&lt;relation&gt;</code> fields are enclosed
          inside the <code>&lt;table&gt;</code> tag itself. The attributes
          available are:</para>

          <variablelist>
            <varlistentry>
              <term>type</term>

              <listitem>
                <para>One of <option>parent</option>, <option>child</option>,
                <option>children</option>, <option>multiple</option> and
                determines the relation type</para>
              </listitem>
            </varlistentry>

            <varlistentry>
              <term>name</term>

              <listitem>
                <para>How this relation will be known to F0FTable</para>
              </listitem>
            </varlistentry>

            <varlistentry>
              <term>localKey</term>

              <listitem>
                <para>The key in our table which holds the foreign key value.
                For the <option>multiple</option> (n:n) relation this is the
                value of the ourPivotKey field in the pivotTable. For other
                relations it is the value held by the foreign table's
                remoteKey field.</para>
              </listitem>
            </varlistentry>

            <varlistentry>
              <term>remoteKey</term>

              <listitem>
                <para>The key in the foreign table which holds the foreign key
                value. For the <option>multiple</option> (n:n) relation this
                is the value of the theirPivotKey field in the pivotTable. For
                other relations it is foreign table's remoteKey field which
                must match the value of our localKey to satisfy the
                relationship.</para>
              </listitem>
            </varlistentry>

            <varlistentry>
              <term>ourPivotKey</term>

              <listitem>
                <para>Only valid for <option>multiple</option> (n:n)
                relations. The field name in the pivotTable which must have
                the same value as our localKey to satisfy the relation.</para>
              </listitem>
            </varlistentry>

            <varlistentry>
              <term>theirPivotKey</term>

              <listitem>
                <para>Only valid for <option>multiple</option> (n:n)
                relations. The field name in the pivotTable which must have
                the same value as the foreign table's remoteKey to satisfy the
                relation.</para>
              </listitem>
            </varlistentry>

            <varlistentry>
              <term>pivotTable</term>

              <listitem>
                <para>Only valid for <option>multiple</option> (n:n)
                relations. The name of the pivot (a.k.a. "glue" or "map")
                table which maps our table's records with the foreign table's
                records, e.g.
                <database>#__foobar_articles_comments</database></para>
              </listitem>
            </varlistentry>

            <varlistentry>
              <term>tableClass</term>

              <listitem>
                <para>The F0FTable class name of the foreign table, e.g.
                FoobarTableItems. This is not required if remoteKey and the
                table class follow the FOF naming conventions, i.e.
                foobar_item_id is understood to belong to #__foobar_items
                which maps to the F0FTable class FoobarTableItems. The table
                class doesn't need to exist (you don't need to specialise
                F0FTable to define a relation). If the class is not found a
                properly configured F0FTable object is created
                automatically.</para>
              </listitem>
            </varlistentry>

            <varlistentry>
              <term>default</term>

              <listitem>
                <para><option>0</option> or <option>1</option> (or yes/no, or
                true/false). If you have multiple relations of the same type
                in a table, one of them can be set up as the default. If you
                don't specify a relation name when calling a method to
                retrieve related item(s) FOF will always the default relation.
                If you set up multiple default relations of the same type only
                the LAST relation will become the default. You are advised not
                to rely on default relations and name them explicitly in your
                code to avoid "interesting" bugs when refactoring your code a
                few weeks (or, worse, months) down the line.</para>
              </listitem>
            </varlistentry>
          </variablelist>
        </section>

        <section xml:id="fofxml-view">
          <title>View settings</title>

          <para>There are several options that are applied per view. In the
          context of the <filename>fof.xml</filename> file, a “view” actually
          refers to an MVC triad, not just the View part of the triad. In so
          many words, the options affect the Controller, Model and View used
          to render this particular component view. You define the view the
          options apply to using the name attribute of the view tag.</para>

          <para>The settings of each view are isolated from the settings of
          every other view, with one notable exception: the star view, i.e.
          <code>name="*"</code>. This is a placeholder view that defines the
          default settings. These settings are applied to all views. If you
          also have a view tag for a view, the default settings (from the star
          view) and the settings for the particular view are merged together.
          This applies to all settings described below.</para>

          <bridgehead>Task map settings</bridgehead>

          <para>The task map settings allow you to map specific tasks to
          specific Controller methods. Other frameworks would call this the
          “routing” feature. It works the same way as adding running
          registerTask in your specialized Controller class.</para>

          <para>The task map is enclosed inside a single
          <code>&lt;taskmap&gt;</code> tag. You can have exactly zero or one
          <code>&lt;taskmap&gt;</code> tags inside each view tag.</para>

          <para>Inside the <code>&lt;taskmap&gt;</code> tag you can have one
          or more <code>&lt;task&gt;</code> tags. The name attribute defines
          the name of the task to map, whereas the content of the tag defines
          the controller’s method which will be called for this task.</para>

          <bridgehead>ACL settings</bridgehead>

          <para>The ACL settings can be used to override or fine-tune the
          access control for each task of the particular view. Even though FOF
          comes with default ACL mappings for its basic tasks, these are not
          always sufficient or appropriate for all situations. Normally this
          is achieved by overriding the onBefore methods in the Controller,
          e.g. <methodname>onBeforeSave</methodname> to set up the ACL checks
          for the save task. You can use the ACL mappings in the
          <filename>fof.xml</filename> instead of such checks. You can even
          use the ACL mapping in <filename>fof.xml</filename> for custom tasks
          for which no onBefore method exists.</para>

          <para>The ACL settings are enclosed inside a single
          <code>&lt;acl&gt;</code> tag. You can have exactly zero or one
          <code>&lt;acl&gt;</code> tags inside each view tag.</para>

          <para>Inside the <code>&lt;acl&gt;</code> tag you can have one or
          more <code>&lt;task&gt;</code> tags. The <code>name</code> attribute
          defines the name of the task to apply the access control, whereas
          the content of the tag defines the Joomla! ACL privilege required to
          access this task. You can use any core ACL privilege or any custom
          ACL privilege defined in your component's
          <filename>access.xml</filename> file. If you leave the content blank
          then no ACL check is performed (the task is always accessible by all
          users). If you use the special value <option>false</option> then the
          ACL privilege is always going to fail, i.e. the task will not be
          accessible by any user.</para>

          <bridgehead>Option settings</bridgehead>

          <para>The configuration options of views and models can be modified
          directly from the view definition of <filename>fof.xml</filename>.
          The configuration settings are enclosed inside a single
          <code>&lt;config&gt;</code> tag. Inside it you can have one or more
          <code>&lt;option&gt;</code> tags. Each tag is equivalent to passing
          a value in the <varname>$config</varname> array. The
          <code>name</code> attribute defines the name of the configuration
          setting you want to modify. The content of the tag is the value of
          this setting. See the Configuration settings section below for more
          information on what each setting is supposed to do.</para>
        </section>
      </section>

      <section xml:id="configuration-settings">
        <title>Configuration settings</title>

        <para>The following settings can be used either in the $config array
        passed to a Dispatcher, Controller, Model or View class or in the
        <filename>fof.xml</filename> file’s <code>&lt;option&gt;</code> tags
        inside the <code>&lt;view&gt;</code> tags.</para>

        <variablelist>
          <varlistentry>
            <term>autoRouting</term>

            <listitem>
              <para>A bit mask which defines the automatic URL routing of
              redirections.</para>

              <para>A value of 1 means that front-end redirections will be put
              through Joomla!’s <code>JRoute::_()</code>.</para>

              <para>A value of 2 means that back-end redirections will be put
              through Joomla!’s <code>JRoute::_()</code>.</para>

              <para>You can combine multiple values by adding them
              together.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>asset_key</term>

            <listitem>
              <para>The key to be used for ACL assets. This is typically in
              the form
              <replaceable>component</replaceable>.<replaceable>view</replaceable>,
              e.g. <option>com_example.item</option> This is only used for
              per-item ACL privileges. If you do not specify an asset key, the
              default
              <replaceable>component</replaceable>.<replaceable>view</replaceable>
              convention will be used instead.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>base_path</term>

            <listitem>
              <para>The base path of the component.</para>

              <itemizedlist>
                <listitem>
                  <para>In <code>$config</code>: Specify the absolute
                  path.</para>
                </listitem>

                <listitem>
                  <para>In <filename>fof.xml</filename>: Specify a path
                  relative to the site’s root.</para>
                </listitem>
              </itemizedlist>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>behaviors</term>

            <listitem>
              <para>Add model behaviours. See the F0FModel documentation for
              more information on behaviours.</para>

              <itemizedlist>
                <listitem>
                  <para>In <code>$config</code>: An array containing the names
                  of model behaviours to add</para>
                </listitem>

                <listitem>
                  <para>In <filename>fof.xml</filename>: A comma separated
                  list with the names of model behaviours to add</para>
                </listitem>
              </itemizedlist>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>cacheableTasks</term>

            <listitem>
              <para>A comma separated list of tasks which support Joomla!’s
              caching.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>cid</term>

            <listitem>
              <para>Define a comma separated list of item IDs to limit the
              view on. Normally this is empty. Only use when you want to limit
              a view to very specific items. Only valid in the
              <filename>fof.xml</filename> file.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>csrf_protection</term>

            <listitem>
              <para>Should we be doing a token check for the tasks of this
              view? The possible values are:</para>

              <itemizedlist>
                <listitem>
                  <para>0 - no token checks are performed</para>
                </listitem>

                <listitem>
                  <para>1 - token checks are always performed</para>
                </listitem>

                <listitem>
                  <para>2 - token checks are always performed in the back-end
                  and in the front-end, but only when the request format is
                  <option>html</option> (default setting)</para>
                </listitem>

                <listitem>
                  <para>3 - token checks are performer only in the
                  back-end</para>
                </listitem>
              </itemizedlist>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>default_task</term>

            <listitem>
              <para>The task to execute if none is defined. The default value
              is <methodname>display</methodname>.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>defaultPageTitle</term>

            <listitem>
              <para>Only taken into account when setFrontendPageTitle is also
              enabled. This is the translation key of the page's title which
              will be used in the front-end. You can override this behaviour
              by specialising the setPageTitle method of your
              <classname>F0FView</classname> class.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>event_after_delete</term>

            <listitem>
              <para>The content plugin event to trigger after deleting the
              data. Default:
              <methodname>onContentAfterDelete</methodname></para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>event_after_save</term>

            <listitem>
              <para>The content plugin event to trigger after saving the data.
              Default: <methodname>onContentAfterSave</methodname></para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>event_before_delete</term>

            <listitem>
              <para>The content plugin event to trigger before deleting the
              data. Default:
              <methodname>onContentBeforeDelete</methodname></para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>event_before_save</term>

            <listitem>
              <para>The content plugin event to trigger before saving the
              data. Default:
              <methodname>onContentBeforeSave</methodname></para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>event_change_state</term>

            <listitem>
              <para>The content plugin event to trigger after changing the
              published state of the data. Default:
              <methodname>onContentChangeState</methodname></para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>event_clean_cache</term>

            <listitem>
              <para>The content plugin event to trigger when cleaning cache.
              There is no default value.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>helper_path</term>

            <listitem>
              <para>The path where the View will be looking for helper
              classes. By default it's the helpers directory inside your
              component's directory.</para>

              <itemizedlist>
                <listitem>
                  <para>In <varname>$config</varname>: Specify an absolute
                  path.</para>
                </listitem>

                <listitem>
                  <para>In <filename>fof.xml</filename>: Specify a path
                  relative to the component's directory.</para>
                </listitem>
              </itemizedlist>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>id</term>

            <listitem>
              <para>Define an item ID to limit the view on. Normally this is
              empty. Only use when you want to limit a view to one single
              item. Only valid in the <filename>fof.xml</filename>
              file.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>ignore_request</term>

            <listitem>
              <para>Set to 1 to prevent the Model's
              <methodname>populateState()</methodname> method from running. By
              default the method is empty and does nothing, as the Model is
              supposed to be decoupled from the request information, having
              the Controller push state variables to it.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>layout</term>

            <listitem>
              <para>The default layout to use for this view. This is normally
              determined automatically based on the task currently being
              executed.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>model_path</term>

            <listitem>
              <para>The path where the Controller will be looking for Model
              class files. By default it's the models directory of the
              component's directory.</para>

              <itemizedlist>
                <listitem>
                  <para>In <varname>$config</varname>: Specify an absolute
                  path.</para>
                </listitem>

                <listitem>
                  <para>In <filename>fof.xml</filename>: Specify a path
                  relative to the component's directory.</para>
                </listitem>
              </itemizedlist>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>model_prefix</term>

            <listitem>
              <para>The naming prefix for the Model to be loaded by the
              Controller. The default option is
              <classname><replaceable>Componentname</replaceable>Model</classname>
              where <replaceable>Componentname</replaceable> is the name of
              the component without the <option>com_</option> prefix.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>modelName</term>

            <listitem>
              <para>The name of the Model class to load. Automatically defined
              based on the component and view names.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>searchpath</term>

            <listitem>
              <para>The path where Controller classes will be searched for. By
              default it's the <filename>controllers</filename> directory
              inside your component's directory.</para>

              <itemizedlist>
                <listitem>
                  <para>In <varname>$config</varname>: Specify the absolute
                  path.</para>
                </listitem>

                <listitem>
                  <para>In <filename>fof.xml</filename>: Specify a path
                  relative to the component's root directory.</para>
                </listitem>
              </itemizedlist>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>setFrontendPageTitle</term>

            <listitem>
              <para>When enabled, FOF will set the page title and metadata in
              the front-end. You can enable this option by setting it to
              <option>1</option>, <option>yes</option>, <option>true</option>
              or <option>on</option>. When this setting is not set, the
              default behaviour of Joomla! is to set the page title to the
              name of the currently active menu item. The default Joomla!
              behaviour ignores the <guilabel>Include Site Name in Page
              Titles</guilabel> setting in the site's Global Configuration
              (it's a Joomla! bug), but the code in FOF which runs when this
              setting is enabled does honour that Global Configuration
              setting.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>table_path</term>

            <listitem>
              <para>The path where the Model will be looking for table
              classes. By default it's the tables directory inside your
              component's directory.</para>

              <itemizedlist>
                <listitem>
                  <para>In $config: Specify an absolute path.</para>
                </listitem>

                <listitem>
                  <para>In fof.xml: Specify a path relative to the component's
                  directory.</para>
                </listitem>
              </itemizedlist>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>table</term>

            <listitem>
              <para>Set the name of the table class the Model will use. Please
              note that the the component name is added to this name
              automatically. For example, given a component
              <code>com_example</code> and a table setting of
              <option>foobar</option> the actual table class which will be
              used will be <classname>ExampleTableFoobar</classname>.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>tbl</term>

            <listitem>
              <para>The name of the database table to use in the table class
              of this view. It is in the format of
              <database>#__tablename</database>, e.g.
              <database>#__example_items</database></para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>tbl_key</term>

            <listitem>
              <para>The name of the key field of the database table to use in
              the table class of this view. It is in the format of
              component_view_id, e.g. example_item_id.</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>template_path</term>

            <listitem>
              <para>The path where the View will be looking for view template
              (.php) or form (.xml) files. By default it's the
              <filename>tmpl</filename> directory inside the current view's
              directory.</para>

              <itemizedlist>
                <listitem>
                  <para>In <varname>$config</varname>: Specify an absolute
                  path.</para>
                </listitem>

                <listitem>
                  <para>In <filename>fof.xml</filename>: Specify a path
                  relative to the component's directory.</para>
                </listitem>
              </itemizedlist>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>use_table_cache</term>

            <listitem>
              <para>By default FOF caches the names of the tables in the
              database and their field definitions in the file
              <filename><replaceable>JPATH_CACHE</replaceable>/fof/cache.php</filename>,
              where JPATH_CACHE is usually the cache directory in the front-
              or back-end of your site respectively. If you've set
              <parameter>Debug System</parameter> to <option>Yes</option> in
              your site's Global Configuration then by default the cache is
              not used.</para>

              <para>You can override this behaviour per view / for all views
              of a component using this parameter. Set to 0 to force the cache
              to never be used or set it to 1 to force the cache to always be
              used (even when your site is in debug mode).</para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>view_path</term>

            <listitem>
              <para>The path where the Controller will be looking for View
              class files. By default it's the <filename>views</filename>
              directory inside your component's directory.</para>

              <itemizedlist>
                <listitem>
                  <para>In <varname>$config</varname>: Specify an absolute
                  path.</para>
                </listitem>

                <listitem>
                  <para>In <filename>fof.xml</filename>: Specify a path
                  relative to the component's directory.</para>
                </listitem>
              </itemizedlist>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>viewName</term>

            <listitem>
              <para>The name of the View class to load. Automatically defined
              based on the component and view names.</para>
            </listitem>
          </varlistentry>
        </variablelist>
      </section>
    </section>

    <section xml:id="xml-forms">
      <title>XML Forms</title>

      <para>Traditionally, creating view templates involves a .php file where
      PHP and HTML code are intermixed to create the appropriate
      representation of the data to be served to a web browser. While this
      gives maximum flexibility to the developer it is also a drag, requiring
      you to write a lot of repetitive code.</para>

      <para>Joomla! 1.6 and later is providing a solution to this problem, at
      least for edit views: JForm. With it it's possible to create an XML file
      which defines the controls of the form and have JForm render it as
      HTML.</para>

      <para>Pros:</para>

      <itemizedlist>
        <listitem>
          <para>The view templates are easier to read</para>
        </listitem>

        <listitem>
          <para>The HTML generation is abstracted, making it easier to upgrade
          to newer versions of Joomla! using a different HTML structure</para>
        </listitem>
      </itemizedlist>

      <para>Cons:</para>

      <itemizedlist>
        <listitem>
          <para>You need to change your Controllers, Models and Views to cater
          for and display the forms</para>
        </listitem>

        <listitem>
          <para>They only apply to edit views</para>
        </listitem>
      </itemizedlist>

      <para>FOF takes this concept further with the F0FForm package. Not only
      can you create edit views, but you can also create browse (records
      listing) and read (single record display) views out of XML forms.
      Moreover, the forms are handled automatically by the FOF base MVC
      classes without requiring you to write any additional code. If you want
      you can always combine a traditional .php view template with a form file
      for maximum customisation of your view.</para>

      <section xml:id="form-types">
        <title>Form types</title>

        <section xml:id="different-form-types">
          <title>The different form types</title>

          <para>As implied above, there are three types of XML forms available
          in FOF: Browse, Read and Edit. Each one follows slightly different
          conventions and is used in different tasks of each MVC triad. In
          this section we are going to present what each of those types does
          and what is its structure.</para>

          <para>There a few things you should know before we go into more
          details.</para>

          <para>All form files are placed in your view's
          <filename>tmpl</filename> directory, e.g.
          <filename>components/com_example/views/items/tmpl</filename>.</para>

          <para>All form files' names begin with <filename>form.</filename>
          and end with <filename>.xml</filename>. This is required for Joomla!
          to distinguish them from view metadata XML files. The middle part of
          their name follows the same convention as the regular view template
          files, i.e. "default" for browse tasks, "form" for edit tasks and
          "item" for read tasks.</para>

          <para>For example, the browse form for <code>com_example</code>'s
          items view is located in
          <filename>components/com_example/views/items/tmpl/form.default.xml</filename>
          whereas the form for editing a single item is located in
          <filename>components/com_example/views/item/tmpl/form.form.xml</filename></para>
        </section>

        <section xml:id="browse-forms">
          <title>Browse forms</title>

          <para>Browse forms are used to create a records list view. They are
          typically used in the back-end to allow the user to view and
          manipulate a list of records. A typical browse form looks like
          this:</para>

          <programlisting language="xml">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;form
    lessfiles="media://com_todo/css/backend.less||media://com_todo/css/backend.css"
    type="browse"
    show_header="1"
    show_filters="1"
    show_pagination="1"
    norows_placeholder="COM_TODO_COMMON_NORECORDS"
&gt;
    &lt;headerset&gt;
        &lt;header name="ordering" type="ordering" sortable="true" tdwidth="1%" /&gt;
        &lt;header name="todo_item_id" type="rowselect" tdwidth="20" /&gt;
        &lt;header name="title" type="fieldsearchable" sortable="true"
            buttons="yes" buttonclass="btn"
        /&gt;
        &lt;header name="due" type="field" sortable="true" tdwidth="12%" /&gt;
        &lt;header name="enabled" type="published" sortable="true" tdwidth="8%" /&gt;
    &lt;/headerset&gt;

    &lt;fieldset name="items"&gt;
        &lt;field name="ordering" type="ordering" labelclass="order"/&gt;

        &lt;field name="todo_item_id" type="selectrow"/&gt;

        &lt;field name="title" type="text"
            show_link="true"
            url="index.php?option=com_todo&amp;amp;view=item&amp;amp;id=[ITEM:ID]"
            class="todoitem"
            empty_replacement="(no title)"
         /&gt;

        &lt;field name="due" type="duedate" /&gt;

        &lt;field name="enabled" type="published"/&gt;
    &lt;/fieldset&gt;
&lt;/form&gt;
</programlisting>

          <para>You MUST have exactly one <code>&lt;headerset&gt;</code> and
          one <code>&lt;fieldset&gt;</code> tag. The <code>name</code>
          attribute of the <code>&lt;fieldset&gt;</code> MUST always be
          <option>items</option>. Extra tags and/or
          <code>&lt;fieldset&gt;</code> tags with different name attributes
          (or no name attributes) will be ignored.</para>

          <section>
            <title>Form attributes</title>

            <para>The enclosing <code>&lt;form&gt;</code> tag MUST have the
            following attributes:</para>

            <variablelist>
              <varlistentry>
                <term>type</term>

                <listitem>
                  <para>It must be always set to <option>browse</option> for
                  FOF to recognise this as a Browse form</para>
                </listitem>
              </varlistentry>
            </variablelist>

            <para>The enclosing &lt;form&gt; tag MAY have one or more of the
            following attributes:</para>

            <variablelist>
              <varlistentry>
                <term>lessfiles</term>

                <listitem>
                  <para>FOF allows you to include LESS files to customise the
                  styling of your components. You can give a comma separated
                  list of LESS files' identifiers (see the "Media files
                  identifiers" section below) to be loaded by FOF. For example
                  <uri>media://com_example/less/backend.less</uri></para>

                  <para>Compiled LESS files are cached in the
                  <filename>media/lib_fof/compiled directory</filename> for
                  efficiency reasons, using a mangled filename for
                  privacy/security reasons. They are not written in your
                  site's cache or adminstrator/cache directory as these
                  directories are not supposed to be web-accessible, whereas
                  the compiled CSS files, by definition, need to be
                  web-accessible.</para>

                  <para>Since LESS files require a lot of memory and time to
                  compile you can also provide an alternative pre-compiled CSS
                  file, separated from your LESS file with two bars. For
                  example:
                  <uri>media://com_example/less/backend.less||media://com_example/css/backend.css</uri></para>
                </listitem>
              </varlistentry>

              <varlistentry>
                <term>cssfiles</term>

                <listitem>
                  <para>This works in the same manner as the lessfiles
                  directive, but you are only supposed to specify standard CSS
                  files. The CSS files are defined using identifiers, too.
                  <uri>For example:
                  media://com_example/css/backend.css</uri></para>

                  <para>Please note that media file overrides rules are in
                  effect for these CSS files.</para>
                </listitem>
              </varlistentry>

              <varlistentry>
                <term>jsfiles</term>

                <listitem>
                  <para>Works the same way as cssfiles, but it's used to load
                  Javascript files. The Javascript files are defined using
                  identifiers, too. For example:
                  <uri>media://com_example/js/backend.js</uri></para>

                  <para>Please note that media file overrides rules are in
                  effect for these Javascript files.</para>
                </listitem>
              </varlistentry>

              <varlistentry>
                <term>show_header</term>

                <listitem>
                  <para>Should we display the header section of the browse
                  form? This is the place where the field titles are
                  displayed.</para>
                </listitem>
              </varlistentry>

              <varlistentry>
                <term>show_filters</term>

                <listitem>
                  <para>Should we show the filter section of the browse form?
                  On Joomla! 2.5 this is the area below the header where the
                  user can filter the display based on his own criteria. On
                  Joomla! 3.0 and later this area is rendered in the sidebar,
                  at the left hand side of the records list.</para>
                </listitem>
              </varlistentry>

              <varlistentry>
                <term>show_pagination</term>

                <listitem>
                  <para>Should we show the pagination results? That's the
                  links to the first, second, third, …, last page and the
                  drop-down for the number of items per page. It is displayed
                  below the list of records.</para>
                </listitem>
              </varlistentry>

              <varlistentry>
                <term>norows_placeholder</term>

                <listitem>
                  <para>A translation key displayed instead of a records list
                  when the current view contains no records, e.g. the table is
                  empty or the filters limit display to zero records.</para>
                </listitem>
              </varlistentry>
            </variablelist>
          </section>
        </section>

        <section xml:id="read-forms">
          <title>Read forms</title>

          <para>While browse views display a list of records, read forms will
          display just a single record. These are nowhere near as powerful as
          hand-coded PHP-based view templates but can be used to get a quick
          single item output in a snatch when prototyping a component or when
          your data is really simple. A typical read form looks like
          this:</para>

          <programlisting language="xml">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;form
    lessfiles="media://com_todo/css/frontend.less||media://com_todo/css/frontend.css"
    type="read"
&gt;
    &lt;fieldset name="a_single_item" class="todo-item-container form-horizontal"&gt;
        &lt;field name="title" type="text"
            label=""
            class="todo-title-field"
            size="50"
         /&gt;

        &lt;field name="due" type="duedate"
            label="COM_TODO_ITEMS_FIELD_DUE"
            labelclass="todo-field"
            size="20"
            default="NOW"
         /&gt;
        &lt;field name="description" type="editor"
            label=""
        /&gt;
    &lt;/fieldset&gt;
&lt;/form&gt;
</programlisting>

          <para>You MUST have at least one <code>&lt;fieldset&gt;</code> tag.
          The name attribute of the <code>&lt;fieldset&gt;</code> is
          indifferent.</para>

          <section>
            <title>Form attributes</title>

            <para>The enclosing <code>&lt;form&gt;</code> tag MUST have the
            following attributes:</para>

            <variablelist>
              <varlistentry>
                <term>type</term>

                <listitem>
                  <para>It must be always set to <option>read</option> for FOF
                  to recognise this as a Read form</para>
                </listitem>
              </varlistentry>
            </variablelist>

            <para>The enclosing &lt;form&gt; tag MAY have one or more of the
            following attributes:</para>

            <variablelist>
              <varlistentry>
                <term>lessfiles</term>

                <listitem>
                  <para>FOF allows you to include LESS files to customise the
                  styling of your components. You can give a comma separated
                  list of LESS files' identifiers (see the "Media files
                  identifiers" section below) to be loaded by FOF. For
                  example:
                  <uri>media://com_example/less/backend.less</uri></para>

                  <para>Compiled LESS files are cached in the
                  <filename>media/lib_fof/compiled</filename> directory for
                  efficiency reasons, using a mangled filename for
                  privacy/security reasons. They are not written in your
                  site's <filename>cache</filename> or
                  <filename>adminstrator/cache</filename> directory as these
                  directories are not supposed to be web-accessible, whereas
                  the compiled CSS files, by definition, need to be
                  web-accessible.</para>

                  <para>Since LESS files require a lot of memory and time to
                  compile you can also provide an alternative pre-compiled CSS
                  file, separated from your LESS file with two bars. For
                  example:
                  <uri>media://com_example/less/backend.less||media://com_example/css/backend.css</uri></para>
                </listitem>
              </varlistentry>

              <varlistentry>
                <term>cssfiles</term>

                <listitem>
                  <para>This works in the same manner as the
                  <code>lessfiles</code> directive, but you are only supposed
                  to specify standard CSS files. The CSS files are defined
                  using identifiers, too. For example:
                  <uri>media://com_example/css/backend.css</uri></para>

                  <para>Please note that media file overrides rules are in
                  effect for these CSS files.</para>
                </listitem>
              </varlistentry>

              <varlistentry>
                <term>jsfiles</term>

                <listitem>
                  <para>Works the same way as <code>cssfiles</code>, but it's
                  used to load Javascript files. The Javascript files are
                  defined using identifiers, too. For example:
                  <uri>media://com_example/js/backend.js</uri></para>

                  <para>Please note that media file overrides rules are in
                  effect for these Javascript files.</para>
                </listitem>
              </varlistentry>
            </variablelist>
          </section>
        </section>

        <section xml:id="edit-forms">
          <title>Edit forms</title>

          <para>Edit forms are used to edit a single record. They are
          typically used in the back-end. If you want to use an Edit form in
          the front-end you will need to specialise your Toolbar class to
          render a front-end toolbar in the edit task of this specific view,
          otherwise the form will not be able to be submitted (unless you do
          other tricks, outside the scope of this developers'
          documentation).</para>

          <para>An edit form looks like this:</para>

          <programlisting language="xml">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;form
    lessfiles="media://com_todo/css/backend.less||media://com_todo/css/backend.css"
    validate="true"
&gt;
    &lt;fieldset name="basic_configuration"
        label="COM_TODO_ITEMS_GROUP_BASIC"
        description="COM_TODO_ITEMS_GROUP_BASIC_DESC"
        class="span6"
    &gt;
        &lt;field name="title" type="text"
            class="inputbox"
            label="COM_TODO_ITEMS_FIELD_TITLE"
            labelclass="todo-label todo-label-main"
            required="true"
            size="50"
         /&gt;

        &lt;field name="due" type="calendar"
            class="inputbox"
            label="COM_TODO_ITEMS_FIELD_DUE"
            labelclass="todo-label"
            required="true"
            size="20"
            default="NOW"
         /&gt;
        &lt;field name="enabled" type="list" label="JSTATUS"
            labelclass="todo-label"
            description="JFIELD_PUBLISHED_DESC" class="inputbox"
            filter="intval" size="1" default="1"
        &gt;
            &lt;option value="1"&gt;JPUBLISHED&lt;/option&gt;
            &lt;option value="0"&gt;JUNPUBLISHED&lt;/option&gt;
        &lt;/field&gt;
    &lt;/fieldset&gt;
    &lt;fieldset name="description_group"
        label="COM_TODO_ITEMS_GROUP_DESCRIPTION"
        description="COM_TODO_ITEMS_GROUP_DESCRIPTION_DESC"
        class="span6"
    &gt;
        &lt;field name="description" type="editor"
            label=""
            class="inputbox"
            required="false"
            filter="JComponentHelper::filterText" buttons="true"
        /&gt;
    &lt;/fieldset&gt;
&lt;/form&gt;
</programlisting>

          <section>
            <title>Form attributes</title>

            <para>The enclosing <code>&lt;form&gt;</code> tag MAY have one or
            more of the following attributes:</para>

            <variablelist>
              <varlistentry>
                <term>lessfiles</term>

                <listitem>
                  <para>FOF allows you to include LESS files to customise the
                  styling of your components. You can give a comma separated
                  list of LESS files' identifiers (see the "Media files
                  identifiers" section below) to be loaded by FOF. For
                  example:
                  <uri>media://com_example/less/backend.less</uri></para>

                  <para>Compiled LESS files are cached in the
                  <filename>media/lib_fof/compiled</filename> directory for
                  efficiency reasons, using a mangled filename for
                  privacy/security reasons. They are not written in your
                  site's <filename>cache</filename> or
                  <filename>adminstrator/cache</filename> directory as these
                  directories are not supposed to be web-accessible, whereas
                  the compiled CSS files, by definition, need to be
                  web-accessible.</para>

                  <para>Since LESS files require a lot of memory and time to
                  compile you can also provide an alternative pre-compiled CSS
                  file, separated from your LESS file with two bars. For
                  example:
                  <uri>media://com_example/less/backend.less||media://com_example/css/backend.css</uri></para>
                </listitem>
              </varlistentry>

              <varlistentry>
                <term>cssfiles</term>

                <listitem>
                  <para>This works in the same manner as the
                  <code>lessfiles</code> directive, but you are only supposed
                  to specify standard CSS files. The CSS files are defined
                  using identifiers, too. For example:
                  <uri>media://com_example/css/backend.css</uri></para>

                  <para>Please note that media file overrides rules are in
                  effect for these CSS files.</para>
                </listitem>
              </varlistentry>

              <varlistentry>
                <term>jsfiles</term>

                <listitem>
                  <para>Works the same way as <code>cssfiles</code>, but it's
                  used to load Javascript files. The Javascript files are
                  defined using identifiers, too. For example:
                  <uri>media://com_example/js/backend.js</uri></para>

                  <para>Please note that media file overrides rules are in
                  effect for these Javascript files.</para>
                </listitem>
              </varlistentry>

              <varlistentry>
                <term>validation</term>

                <listitem>
                  <para>Set it to <option>true</option> to have Joomla! load
                  its unobtrusive Javascript validation script. Please note
                  that FOF does perform some automatic, generic server-side
                  validation checks where possible. We strongly recommend you
                  to implement more thorough, customised validation in your
                  specialised Table class and its check() method where
                  possible, especially in front-end facing MVC triads.</para>
                </listitem>
              </varlistentry>
            </variablelist>
          </section>
        </section>

        <section xml:id="formatting-your-forms">
          <title>Formatting your forms</title>

          <para>OK, granted, the automatically rendered forms are a timesaver
          but, by default, they look terrible. This is quite expected. It's
          like comparing a rug churned out by a mechanised production line
          (the automatically rendered form) and a hand-stiched persian rug
          (the hand-coded PHP-based view template). The good news is that,
          unlike rugs, there's some room of improvement with XML forms.</para>

          <para>For starters, the <code>&lt;fieldset&gt;</code>s of Edit and
          Read forms, as well as the fields themselves, can be assigned CSS
          classes and IDs which can help you provide a custom style. Moreover,
          you can mix XML forms and PHP-based view templates to further
          customise the display of your forms.</para>

          <para>In this section we will cover both customisation methods. If
          this doesn't sound enough for your project you can always use
          hand-coded PHP-based view templates, much like how you did since
          Joomla! 1.5.0. It's up to you to decide which method is best for
          your project!</para>

          <section xml:id="format-forms-with-bs-tabs">
            <title>Using Bootstrap-powered tabs</title>

            <important>
              <para>Available since FOF 2.3.0.</para>

              <para>This feature simply emits Bootstrap 2.x compatible HTML
              markup, therefore only works with Bootstrap-powered templates.
              This means that you will need to be using Akeeba Strapper
              (Joomla! 2.5 and 3.x are supported) or Joomla! 3.x with a
              Bootstrap-powered template.</para>
            </important>

            <para>If you have a long form you may want to provide tabs to let
            the user access different sections of the form. In order to do
            that, you first have to set the <parameter>tabbed</parameter>
            attribute of your form to <option>true</option>,
            <option>yes</option>, <option>1</option> or <option>on</option>.
            For example:</para>

            <programlisting language="xml">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;form tabbed="1"&gt;
</programlisting>

            <para>Each <tag>fieldset</tag> which will be part of the tab set
            must include <option>tab-pane</option> in its
            <parameter>class</parameter> attribute. Moreover, it MUST have
            non-empty <parameter>label</parameter> and
            <parameter>name</parameter> attributes. For example:</para>

            <programlisting language="xml">&lt;fieldset name="basic_configuration"
label="COM_FOOBAR_ITEMS_GROUP_BASIC"
class="tab-pane active another-class"
&gt;</programlisting>

            <para>Please note that <emphasis>exactly one</emphasis> of your
            <tag>fieldset</tag>s must have <option>active</option> added to
            its <parameter>class</parameter> attribute. This will be the tab
            which will be open by default. If you forget to set an active tab
            the tab pane will render with no tab active by default which is
            confusing for your users!</para>
          </section>

          <section xml:id="format-forms-with-classes">
            <title>Assigning classes and IDs to &lt;fieldset&gt;s</title>

            <para>Each fieldset of a Read and Edit form can have the following
            optional attributes:</para>

            <variablelist>
              <varlistentry>
                <term>class</term>

                <listitem>
                  <para>One or more CSS classes to be applied to the generated
                  <code>&lt;div&gt;</code> element.</para>
                </listitem>
              </varlistentry>

              <varlistentry>
                <term>name</term>

                <listitem>
                  <para>The value of this attribute is applied to the id
                  attribute of the generated <code>&lt;div&gt;</code>
                  element.</para>
                </listitem>
              </varlistentry>

              <varlistentry>
                <term>label</term>

                <listitem>
                  <para>The value of this attribute is rendered as a level 3
                  heading (<code>&lt;h3&gt;</code>) element at the top of the
                  generated <code>&lt;div&gt;</code> element.</para>
                </listitem>
              </varlistentry>
            </variablelist>

            <para>If you are using Joomla! 3 (which has Bootstrap by default)
            or Joomla! 2.5 together with the optional Akeeba Strapper package
            (which back ports Bootstrap to Joomla! 2.5) you can use
            Bootstrap's classes to create visually interesting interfaces. For
            example, using <code>class="span6 pull-left"</code> will create a
            half-page-wide left floating sidebar out of your field set.</para>
          </section>

          <section xml:id="format-forms-mixing-with-php">
            <title>Mixing XML forms with PHP-based view templates</title>

            <para>Inside your .php view template file you can use
            <code>$this-&gt;getRenderedForm()</code> to return the XML form
            file rendered as HTML. This allows you to customise the layout
            (e.g. adding information before/after the form) while still using
            the XML file to render the actual form.</para>

            <para>To use this approach, simply insert this code in your custom
            .php template file:</para>

            <programlisting language="php">&lt;?php
$viewTemplate = $this-&gt;getRenderedForm();
echo $viewTemplate; 
?&gt;</programlisting>
          </section>
        </section>
      </section>

      <section xml:id="header-fields-reference">
        <title>Header fields type reference</title>

        <section xml:id="how-header-fields-work">
          <title>How header fields work</title>

          <para>A header field has two distinct functions:</para>

          <itemizedlist>
            <listitem>
              <para>It is used to render headers in list views which are used
              to label the columns of the display and optionally allow you to
              sort the table by a specific field</para>
            </listitem>

            <listitem>
              <para>It is used to render filtering widgets (drop-down lists
              and search boxes). In Joomla! 2.5 you can only render filtering
              widgets <emphasis>directly below</emphasis> a header field in a
              list table and you can only have up to as many filtering widgets
              as your fields. In Joomla! 3.x and above the filtering widgets
              are rendered either <emphasis>above</emphasis> the header fields
              (search boxes) or in the left-hand column (drop-down lists). As
              in Joomla! 3.x and above the filters are detached from the
              header fields you can have as many filters as you want, even
              more than the number of fields you are displaying in the filter
              list.</para>
            </listitem>
          </itemizedlist>

          <para>A leader field can render only a header, only a filter or
          both. Most of the header field types render both. Those whose name
          starts with <literal>filter</literal> will only render a filtering
          widget, but not a header field. As a result these header fields will
          only work on Joomla! 3.x and later.</para>
        </section>

        <section xml:id="common-fields-for-all-types">
          <title>Common fields for all types</title>

          <para>For all following fields you can set the following
          attributes:</para>

          <itemizedlist>
            <listitem>
              <para><emphasis role="strong">name</emphasis> The name of the
              header field. This has to match the table field name in the
              model.</para>

              <para>If you want to create a header for a calculated field or
              for a column that doesn't correspond to a table field please use
              a name that doesn't overlap with the name of a column in the
              table. If you want to list a field many times (e.g. display a
              row selection checkbox and the record ID at the same time) you
              will have to use the same <literal>name</literal> in both
              headers, but use a different <literal>id</literal>
              attribute.</para>
            </listitem>

            <listitem>
              <para><emphasis role="strong">type</emphasis> The header type.
              See below for the available field types, as well as the options
              which can be specified in each one of them.</para>
            </listitem>

            <listitem>
              <para><emphasis role="strong">label</emphasis> The language
              string which will be used for the label of the header; this is a
              language string that will be fed to JText::_() for
              translation.</para>
            </listitem>

            <listitem>
              <para><emphasis role="strong">id</emphasis> The
              <literal>id</literal> attribute for this header. Skip it to have
              FOF create one based on the field name.</para>

              <para>If none is provided FOF will automatically create one
              using the convention component_modelname_fieldname_LABEL where
              component is the name of your component, modelname is the name
              of your model (usually equals to the view name) and fieldname is
              the name of the field. For example, for a component com_foobar,
              a view named items and a field named baz we get the language
              string COM_FOOBAR_ITEMS_BAZ_LABEL.</para>
            </listitem>

            <listitem>
              <para><emphasis role="strong">tdwidth</emphasis> The width of
              this column in the list table. You can use percentile or pixel
              units, i.e. <literal>tdwidth="10%"</literal> or
              <literal>tdwidth="120px"</literal></para>
            </listitem>

            <listitem>
              <para><emphasis role="strong">sortable</emphasis> Set to "true"
              if you want to be able to sort the table by this field.</para>
            </listitem>

            <listitem>
              <para><emphasis role="strong">filterclass</emphasis> The CSS
              class for the filtering widget</para>
            </listitem>

            <listitem>
              <para><emphasis role="strong">onchange</emphasis> The Javascript
              code to be executed when the filtering widget's value is
              modified</para>
            </listitem>
          </itemizedlist>

          <section xml:id="additional-attributes-for-search-box-filtering-widgets">
            <title>Additional attributes for search box filtering
            widgets</title>

            <para>The following attributes apply to all header fields
            rendering a search box filtering widget:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">searchfieldname</emphasis> The
                name of the field that will be searchable. If omitted it will
                be the same as the <literal>name</literal> attribute.</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">placeholder</emphasis> The
                placeholder text when the field is empty. Useful to explain
                what kind of information this search field is supposed to be
                searching in.</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">size</emphasis> The size (in
                characters) of the search box</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">maxlength</emphasis> The maximum
                length in characters which is allowed to be entered in the
                field</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">buttons</emphasis> Set to true
                (or skip) to show Go and Reset buttons next to the text field.
                Set to "false" to hide those buttons. The user can still press
                Enter to submit the form.</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">buttonclass</emphasis> The CSS
                class of the Go and Reset buttons</para>
              </listitem>
            </itemizedlist>
          </section>

          <section xml:id="additional-attributes-for-drop-down-list-filtering-widgets">
            <title>Additional attributes for drop-down list filtering
            widgets</title>

            <para>This element has <literal>&lt;option&gt;</literal>
            sub-elements defining the available options. Please consult
            Joomla!'s own <literal>list</literal> field type for more
            information.</para>

            <para>Since FOF 2.1.0 we allow you to use a programmatically
            generated data source instead of the hard-coded
            <literal>&lt;option&gt;</literal> tags. This can be used when you
            need your code to generate options based on some configuration
            data, data from the database and so on. You do that by supplying
            the name of a PHP class and a static method on that class which
            returns the data. The data must be returned in an indexed array
            where the key is the key of the drop-down list item and the value
            is the description (translation key or string). You may also use a
            simple array containing indexed arrays by using the
            <literal>source_key</literal> and <literal>source_value</literal>
            attributes.</para>

            <para>The following additional attributes apply to all header
            fields rendering a drop-down list filtering widget.</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">source_file</emphasis>
                (optional) The PHP file which provides the class and method.
                It is given in the pseudo-URL format e.g.
                <literal>admin://components/com_foobar/helpers/mydata.php</literal>
                or
                <literal>site://components/com_foobar/helpers/mydata.php</literal>
                for a file relative to the administrator or site root
                directory respectively.</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">source_class</emphasis>
                (required) The name of the PHP class to use, e.g.
                <literal>FoobarHelperMydata</literal></para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">source_method</emphasis>
                (required) The static method of the PHP class to use, e.g.
                <literal>getSomeFoobarData</literal></para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">source_format</emphasis>
                (optional) The format of the returned data of the static
                method. Set to <literal>optionsobject</literal> if the method
                returns a pre-generated options object.</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">source_key</emphasis> (optional)
                If you are using an array of indexed arrays, this is the key
                of the indexed array that contains the key of the drop-down
                option.</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">source_key</emphasis> (optional)
                If you are using an array of indexed arrays, this is the key
                of the indexed array that contains the value (description) of
                the drop-down option.</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">source_translate</emphasis>
                (optional) By default all values are being translated, i.e.
                fed through JText::_(). If you don't want that, set this
                attribute to "false".</para>
              </listitem>
            </itemizedlist>
          </section>
        </section>

        <section xml:id="field-types">
          <title>Field Types</title>

          <section xml:id="accesslevel">
            <title>accesslevel</title>

            <para>Displays a header field with a viewing access level
            drop-down filtering widget.</para>

            <para>There are no additional attributes to set.</para>
          </section>

          <section xml:id="field">
            <title>field</title>

            <para>Displays a header field, without any filtering
            widget.</para>

            <para>There are no additional attributes to set.</para>
          </section>

          <section xml:id="fielddate">
            <title>fielddate</title>

            <para>Displays a header field with a date selection search box
            filtering widget.</para>

            <para>The additional attributes you can set are:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">readonly</emphasis> Set to true
                to make the search box read only</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">disabled</emphasis> Set to true
                to disable the search box (it displays but you can't click on
                it)</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">filter</emphasis> Skip to show
                the date/time as entered. Set to SERVER_UTC to convert a date
                to UTC based on the server timezone. Set to USER_UTC to
                convert a date to UTC based on the user timezone.</para>
              </listitem>
            </itemizedlist>
          </section>

          <section xml:id="fieldsearchable">
            <title>fieldsearchable</title>

            <para>Displays a header field with a search box filtering
            widget.</para>

            <para>There are no additional attributes to set.</para>
          </section>

          <section xml:id="fieldselectable">
            <title>fieldselectable</title>

            <para>Displays a header field with a drop-down list filtering
            widget.</para>

            <para>There are no additional attributes to set.</para>
          </section>

          <section xml:id="fieldsql">
            <title>fieldsql</title>

            <para>Displays a header field with a drop-down list filtering
            widget. The source of the filter values comes from an SQL
            query.</para>

            <para>The additional attributes are:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">key_field</emphasis> the table
                field to use as key</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">value_field</emphasis> the table
                field to display as text</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">query</emphasis> the actual SQL
                query to run</para>
              </listitem>
            </itemizedlist>

            <para>We recommend avoiding this field type as the query is
            specific to a particular database server technology. Using the
            <literal>model</literal> or <literal>fieldselectable</literal>
            type with a programmatic data source is strongly
            encouraged.</para>
          </section>

          <section xml:id="filterdate">
            <title>filterdate</title>

            <para>This is the same as fielddate but no header is
            rendered. Only the filtering widget is rendered. This header field
            type only works on Joomla! 3.x and later.</para>
          </section>

          <section xml:id="filtersearchable">
            <title>filtersearchable</title>

            <para>This is the same as fieldsearchable but no header is
            rendered. Only the filtering widget is rendered. This header field
            type only works on Joomla! 3.x and later.</para>
          </section>

          <section xml:id="filterselectable">
            <title>filterselectable</title>

            <para>This is the same as fieldselectable but no header is
            rendered. Only the filtering widget is rendered. This header field
            type only works on Joomla! 3.x and later.</para>
          </section>

          <section xml:id="filtersql">
            <title>filtersql</title>

            <para>This is the same as fieldsql but no header is rendered. Only
            the filtering widget is rendered. This header field type only
            works on Joomla! 3.x and later.</para>

            <para>The same warning applies to using this field type.</para>
          </section>

          <section xml:id="language">
            <title>language</title>

            <para>Displays a header field with a drop-down list containing the
            languages installed on your site.</para>

            <para>The additional attributes are:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">client</emphasis> If set to
                "site" displays a list of installed front-end languages. If
                set to "administrator" displays a list of installed back-end
                languages. Default: site.</para>
              </listitem>
            </itemizedlist>
          </section>

          <section xml:id="model">
            <title>model</title>

            <para>Similar to the fieldselectable header, but gets the options
            from a F0FModel descendant.</para>

            <para>You can set the following attributes on top of those of the
            'fieldselectable' field type's:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">model</emphasis> The name of the
                model to use, e.g. FoobarModelItems</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">key_field</emphasis> The name of
                the field in the model's results which is used as the key
                value of the drop-down</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">value_field</emphasis> The name
                of the field in the model's results which is used as the label
                of the drop-down</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">translate</emphasis> Should the
                value field's value be passed through JText::_() before being
                displayed?</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">apply_access</emphasis> Should
                we respect the view access level, if an access field is
                present in the model</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">none</emphasis> The placeholder
                to be shown if the value is not found in the data returned by
                the model. This placeholder goes through JText, so you can use
                a language string if you like.</para>
              </listitem>
            </itemizedlist>

            <para>In order to filter the model you can specify
            <literal>&lt;state&gt;</literal> sub-elements in the
            format:</para>

            <programlisting language="xml">&lt;state key="state_key"&gt;value&lt;/state&gt;
</programlisting>

            <para>Where state_key is the key of a state variable and value is
            its value. For instance, you could have something like:</para>

            <programlisting language="xml">&lt;state key="foobar_category_id"&gt;123&lt;/state&gt;
</programlisting>
          </section>

          <section xml:id="ordering">
            <title>ordering</title>

            <para>Displays a header field which allows reordering of your
            data.</para>

            <para>On Joomla! 2.5 it displays the name of the field followed by
            a disk icon which saves the ordering.</para>

            <para>On Joomla! 3.x and later it displays an "up and down
            triangle" icon. When clicked the AJAX-powered reordering handles
            in the list view become enabled.</para>

            <para>There are no additional attributes.</para>
          </section>

          <section xml:id="published">
            <title>published</title>

            <para>Displays a header field and a drop-down filtering field for
            Published / Unpublished and related publishing options.</para>

            <para>The additional attributes are:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">show_published</emphasis> Should
                we show the Published status in the filter? Default:
                true</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">show_unpublished</emphasis>
                Should we show the Unpublished status in the filter? Default:
                true</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">show_archived</emphasis> Should
                we show the Archived status in the filter? Default:
                false</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">show_trash</emphasis> Should we
                show the Trashed status in the filter? Default: false</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">show_all</emphasis> Should we
                show the All status in the filter? Default: false. You
                actually don't need this as no selection results in all
                records, irrespective of their publish state, to be
                displayed.</para>
              </listitem>
            </itemizedlist>
          </section>

          <section xml:id="rowselect">
            <title>rowselect</title>

            <para>Displays a checkbox which, when clicked, automatically
            selects all the row selection checkboxes in the list.</para>

            <para>There are no additional attributes.</para>
          </section>
        </section>
      </section>

      <section xml:id="form-fields-reference">
        <title>Form fields type reference</title>

        <section xml:id="form-common-fields-for-all-types">
          <title>Common fields for all types</title>

          <para>For all following fields you can set the following
          attributes:</para>

          <itemizedlist>
            <listitem>
              <para><emphasis role="strong">name</emphasis> The name of the
              field. This has to match the table field name in the
              model.</para>

              <para>If you want to create a header for a calculated field or
              for a column that doesn't correspond to a table field please use
              a name that doesn't overlap with the name of a column in the
              table. If you want to list a field many times (e.g. display a
              row selection checkbox and the record ID at the same time) you
              will have to use the same <literal>name</literal> in both
              fields, but use a different <literal>id</literal>
              attribute.</para>
            </listitem>

            <listitem>
              <para><emphasis role="strong">type</emphasis> The field type.
              See below for the available field types, as well as the options
              which can be specified in each one of them.</para>
            </listitem>

            <listitem>
              <para><emphasis role="strong">label</emphasis> The language
              string which will be used for the label of the field; this is a
              language string that will be fed to JText::_() for translation.
              If you leave it empty FOF will automatically generate a language
              string using the convention
              <code><replaceable>COMPONENTNAME</replaceable>_<replaceable>VIEWNAME</replaceable>_<replaceable>FIELDNAME</replaceable>_LABEL</code>.</para>
            </listitem>

            <listitem>
              <para><emphasis role="strong">id</emphasis> The
              <literal>id</literal> attribute for this field. Skip it to have
              FOF create one based on the field name.</para>

              <para>If none is provided FOF will automatically create one
              using the convention component_modelname_fieldname_LABEL where
              component is the name of your component, modelname is the name
              of your model (usually equals to the view name) and fieldname is
              the name of the field. For example, for a component com_foobar,
              a view named items and a field named baz we get the language
              string COM_FOOBAR_ITEMS_BAZ_LABEL.</para>
            </listitem>

            <listitem>
              <para><emphasis role="strong">emptylabel</emphasis> Set this to
              1 if you intend to have a field without a label. In this case
              you must NOT define the <code>label</code> attribute.</para>
            </listitem>

            <listitem>
              <para><emphasis role="strong">description</emphasis> The
              language string which will be used for the label of the field;
              this is a language string that will be fed to JText::_() for
              translation.</para>
            </listitem>

            <listitem>
              <para><emphasis role="strong">tooltip</emphasis> The language
              string which will be used for the tooltip of the field; this is
              a language string that will be fed to JText::_() for
              translation.</para>
            </listitem>

            <listitem>
              <para><emphasis role="strong">required</emphasis> Set it to 1,
              yes or true to make this a required field. If you use the form
              validation then the form cannot be submitted unless this value
              is filled in.</para>
            </listitem>
          </itemizedlist>

          <blockquote>
            <important>
              <para>The automatic label and description only apply if you are
              using Akeeba Strapper or if you are using Joomla! 3.0 and later.
              If you are using FOF on plain old Joomla! 2.5 you must provide
              the <literal>label</literal> and <literal>description</literal>
              attributes manually.</para>
            </important>
          </blockquote>
        </section>

        <section xml:id="form-field-types">
          <title>Field types</title>

          <section xml:id="form-accesslevel">
            <title>accesslevel</title>

            <para>This will display a select list with existing Joomla! Access
            Levels.</para>

            <para>You can set the following attributes:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">class</emphasis> CSS class
                (default '')</para>
              </listitem>
            </itemizedlist>
          </section>

          <section xml:id="button">
            <title>button</title>

            <para>This will display an input button.</para>

            <para>You can set the following attributes:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">class</emphasis> CSS class
                (default '')</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">icon</emphasis> Bootstrap icon
                to add to the button (default '')</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">onclick</emphasis> "onclick"
                attribute to add to the button (default '')</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">url</emphasis> URL template
                for each element (use [ITEM:ID] as a placeholder for the item
                id) (default '')</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">htmlelement</emphasis> The
                HTML used tag, allowed: button, a (default 'button')</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">text</emphasis> Button text
                value; this is a language string that will be fed to
                JText::_() for translation</para>
              </listitem>
            </itemizedlist>
          </section>

          <section xml:id="cachehandler">
            <title>cachehandler</title>

            <para>This will display a select list with available Joomla! cache
            handlers</para>

            <para>You can set the following attributes:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">class</emphasis> CSS class
                (default '')</para>
              </listitem>
            </itemizedlist>
          </section>

          <section xml:id="calendar">
            <title>calendar</title>

            <para>This will display a calendar/date field.</para>

            <para>You can set the following attributes:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">class</emphasis> CSS class
                (default '')</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">format</emphasis> (defaults
                '%Y-%m-%d')</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">filter</emphasis> can be one the
                following:</para>

                <itemizedlist>
                  <listitem>
                    <para>SERVER_UTC convert a date to UTC based on the server
                    timezone</para>
                  </listitem>

                  <listitem>
                    <para>USER_UTC convert a date to UTC based on the user
                    timezone</para>
                  </listitem>
                </itemizedlist>
              </listitem>
            </itemizedlist>
          </section>

          <section xml:id="captcha">
            <title>captcha</title>

            <para>This will display a captcha input.</para>

            <para>You can set the following attributes:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">plugin</emphasis> The name of
                the CAPTCHA plugin to use. Leave empty to use whatever is the
                default on in the Global Configuration of the Joomla!
                site</para>
              </listitem>
            </itemizedlist>
          </section>

          <section xml:id="checkbox">
            <title>checkbox</title>

            <para>This will display a single checkbox input.</para>

            <para>You can set the following attributes:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">class</emphasis> CSS class
                (default '')</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">value</emphasis> the input
                value</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">checked</emphasis> the default
                status for input</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">disabled</emphasis> Is this a
                disabled form element?</para>
              </listitem>
            </itemizedlist>
          </section>

          <section xml:id="components">
            <title>components</title>

            <para>This will display a select with a list of installed Joomla!
            components</para>

            <para>You can set the following attributes:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">class</emphasis> CSS class
                (default '')</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">client_ids</emphasis> comma
                separated list of applicable client ids (note: 0 = admin, 1 =
                site)</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">readonly</emphasis> is this a
                read only field?</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">disabled</emphasis> Is this a
                disabled form element?</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">multiple</emphasis> Should we
                allow multiple selections?</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">onchange</emphasis> onchange
                JavaScript event</para>
              </listitem>
            </itemizedlist>
          </section>

          <section xml:id="editor">
            <title>editor</title>

            <para>This will display a WYSIWYG edit area field for content
            creation and formatted HTML display.</para>

            <para>You can set the following attributes:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">class</emphasis> CSS class
                (default '')</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">rows</emphasis> How many rows
                the generated <literal>&lt;textarea&gt;</literal> will have,
                typically used when Javascript is disabled on the
                browser</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">cols</emphasis> How many columns
                the generated <literal>&lt;textarea&gt;</literal> will have,
                typically used when Javascript is disabled on the
                browser</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">height</emphasis> The height of
                the editor (default: 250)</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">width</emphasis> The width of
                the editor (default: 100%)</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">asset_field</emphasis> The name
                of the asset_id field in the form (default: asset_id)</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">created_by_field</emphasis> The
                name of the created_by field in the form</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">asset_id</emphasis> The Joomla!
                asset ID for this record. Leave empty to let FOF use the value
                of the asset field defined by asset_field.</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">buttons</emphasis> Which buttons
                should we show (rendered by editor-xtd plugins)? Use 0, false
                or no to show now buttons, otherwise provide a comma separated
                list of button plugin names</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">hide</emphasis> Which buttons
                should we hide? Similar to above.</para>
              </listitem>
            </itemizedlist>
          </section>

          <section xml:id="email">
            <title>email</title>

            <para>This will display a text input which expects a valid e-mail
            address.</para>

            <para>You can set the following attributes:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">class</emphasis> CSS class
                (default '')</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">show_link</emphasis> if true put
                a mailto: link around the address (default false)</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">size</emphasis> Size of the text
                input in characters</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">maxlength</emphasis> Maximum
                length of the input in characters</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">readonly</emphasis> Is this a
                read only field?</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">disabled</emphasis> Is this a
                disabled form element?</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">onchange</emphasis> onchange
                Javascript event</para>
              </listitem>
            </itemizedlist>
          </section>

          <section xml:id="groupedbutton">
            <title>groupedbutton</title>

            <para>This will display a group of button.</para>

            <para>You can set the following attributes:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">class</emphasis> CSS class
                (default '')</para>
              </listitem>
            </itemizedlist>

            <para>This element supports sub-elements organised in
            <literal>&lt;button&gt;</literal> tags. For more information
            please consult the <literal>button</literal> element.</para>
          </section>

          <section xml:id="groupedlist">
            <title>groupedlist</title>

            <para>This will display a grouped drop down list.</para>

            <para>You can set the following attributes:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">class</emphasis> CSS class
                (default '')</para>
              </listitem>
            </itemizedlist>

            <para>This element supports sub-elements organised in
            <literal>&lt;group&gt;</literal> and
            <literal>&lt;option&gt;</literal> tags. For more information
            please consult the documentation of Joomla!'s
            JFormFieldGroupedList element.</para>
          </section>

          <section xml:id="hidden">
            <title>hidden</title>

            <para>This will display a hidden input.</para>

            <para>You can set the common attributes. Moreover, to make sure
            this field is rendered properly, you MUST define the attribute
            <code>emptylabel="1"</code> and NOT assign a label attribute at
            all.</para>
          </section>

          <section xml:id="image">
            <title>image</title>

            <para>This is an alias for the "media" field type (see
            below).</para>
          </section>

          <section xml:id="imagelist">
            <title>imagelist</title>

            <para>This will display a media selection field showing images
            from a specified folder.</para>

            <para>You can set the following attributes:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">class</emphasis> CSS
                class</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">directory</emphasis> folder to
                search the images in</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">style</emphasis> inline
                style</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">width</emphasis> HTML width
                attribute</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">height</emphasis> HTML height
                attribute</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">align</emphasis> HTML align
                attribute</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">rel</emphasis> HTML rel
                attribute</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">title</emphasis> image
                title</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">filter</emphasis> The filtering
                string for filenames to show. Default:
                <literal>\.png$|\.gif$|\.jpg$|\.bmp$|\.ico$|\.jpeg$|\.psd$|\.eps$</literal></para>
              </listitem>
            </itemizedlist>
          </section>

          <section xml:id="integer">
            <title>integer</title>

            <para>This will display a text input which expects a valid integer
            value.</para>

            <para>You can set the following attributes:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">class</emphasis> CSS class
                (default '')</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">first</emphasis> Starting
                number</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">last</emphasis> Last number to
                show</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">step</emphasis> Step for
                increasing the numbers</para>
              </listitem>
            </itemizedlist>

            <para>For example, when using first=10, last=20 and step=2 you get
            a list of 10, 12, 14, 16, 18, 20.</para>
          </section>

          <section xml:id="form-language">
            <title>language</title>

            <para>This will display a select input of all available Joomla!
            languages</para>

            <para>You can set the following attributes:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">class</emphasis> CSS class
                (default '')</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">client</emphasis> Can take the
                values of 'site' or 'administrator' to show the available
                languages for the front- and back-end respectively.</para>
              </listitem>
            </itemizedlist>
          </section>

          <section xml:id="list">
            <title>list</title>

            <para>This will display a select input of generic options.</para>

            <para><emphasis role="strong">IMPORTANT</emphasis> The following
            attributes apply to all field types that present a drop-down list;
            they all descend from this field type.</para>

            <para>You can set the following attributes:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">class</emphasis> CSS class
                (default '')</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">readonly</emphasis> Is this a
                read-only field?</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">disabled</emphasis> Is this a
                disabled form element?</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">multiple</emphasis> Should we
                allow multiple selections?</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">onchange</emphasis> The onChange
                Javascript event</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">url</emphasis> URL template for
                each element (use [ITEM:ID] as a placeholder for the item
                id)</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">show_link</emphasis> if true,
                adds a link around each item based on the "url" attribute
                (default false)</para>
              </listitem>
            </itemizedlist>

            <para>This element has <literal>&lt;option&gt;</literal>
            sub-elements defining the available options. Please consult
            Joomla!'s own element of the same type for more
            information.</para>

            <para>Since FOF 2.1.0 we allow you to use a programmatically
            generated data source instead of the hard-coded
            <literal>&lt;option&gt;</literal> tags. This can be used when you
            need your code to generate options based on some configuration
            data, data from the database and so on. You do that by supplying
            the name of a PHP class and a static method on that class which
            returns the data. The data must be returned in an indexed array
            where the key is the key of the drop-down list item and the value
            is the description (translation key or string). You may also use a
            simple array containing indexed arrays by using the
            <literal>source_key</literal> and <literal>source_value</literal>
            attributes.</para>

            <para>The relevant attributes are:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">source_file</emphasis>
                (optional) The PHP file which provides the class and method.
                It is given in the pseudo-URL format e.g.
                <literal>admin://components/com_foobar/helpers/mydata.php</literal>
                or
                <literal>site://components/com_foobar/helpers/mydata.php</literal>
                for a file relative to the administrator or site root
                directory respectively.</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">source_class</emphasis>
                (required) The name of the PHP class to use, e.g.
                <literal>FoobarHelperMydata</literal></para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">source_method</emphasis>
                (required) The static method of the PHP class to use, e.g.
                <literal>getSomeFoobarData</literal></para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">source_format</emphasis>
                (optional) The format of the returned data of the static
                method. Set to <literal>optionsobject</literal> if the method
                returns a pre-generated options object.</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">source_key</emphasis> (optional)
                If you are using an array of indexed arrays, this is the key
                of the indexed array that contains the key of the drop-down
                option.</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">source_translate</emphasis>
                (optional) By default all values are being translated, i.e.
                fed through JText::_(). If you don't want that, set this
                attribute to "false".</para>
              </listitem>
            </itemizedlist>
          </section>

          <section xml:id="media">
            <title>media</title>

            <para>This will display a media selection field.</para>

            <para>You can set the following attributes:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">class</emphasis> CSS
                class</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">style</emphasis> inline
                style</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">width</emphasis> HTML width
                attribute</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">height</emphasis> HTML height
                attribute</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">align</emphasis> HTML align
                attribute</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">rel</emphasis> HTML rel
                attribute</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">title</emphasis> image
                title</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">asset_field</emphasis> The name
                of the asset_id field in the form (default: asset_id)</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">created_by_field</emphasis> The
                name of the created_by field in the form</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">asset_id</emphasis> The Joomla!
                asset ID for this record. Leave empty to let FOF use the value
                of the asset field defined by asset_field.</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">link</emphasis> The link to a
                media management component to use. Skip this to use Joomla!'s
                own com_media (strongly recommended!)</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">size</emphasis> Field size in
                characters</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">onchange</emphasis> The onChange
                Javascript event</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">preview</emphasis> Should we
                show a preview of the selected media file?</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">preview_width</emphasis> Maximum
                width of preview in pixels</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">preview_height</emphasis>
                Maximum height of preview in pixels</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">directory</emphasis> Directory
                to scan for images relative to site's root. Skip to use the
                site's images directory.</para>
              </listitem>
            </itemizedlist>
          </section>

          <section xml:id="form-model">
            <title>model</title>

            <para>Similar to the list field, but gets the options from a
            F0FModel descendant.</para>

            <para>You can set the following attributes on top of those of the
            'list' field type's:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">model</emphasis> The name of the
                model to use, e.g. FoobarModelItems</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">key_field</emphasis> The name of
                the field in the model's results which is used as the key
                value of the drop-down</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">value_field</emphasis> The name
                of the field in the model's results which is used as the label
                of the drop-down</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">translate</emphasis> Should the
                value field's value be passed through JText::_() before being
                displayed?</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">apply_access</emphasis> Should
                we respect the view access level, if an access field is
                present in the model</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">none</emphasis> The placeholder
                to be shown if the value is not found in the data returned by
                the model. This placeholder goes through JText, so you can use
                a language string if you like.</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">format</emphasis> See the text
                field type</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">show_link</emphasis> See the
                text field type</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">url</emphasis> See the text
                field type</para>
              </listitem>
            </itemizedlist>

            <para>In order to filter the model you can specify
            <literal>&lt;state&gt;</literal> sub-elements in the
            format:</para>

            <programlisting language="xml">&lt;state key="state_key"&gt;value&lt;/state&gt;
</programlisting>

            <para>Where state_key is the key of a state variable and value is
            its value. For instance, you could have something like:</para>

            <programlisting language="xml">&lt;state key="foobar_category_id"&gt;123&lt;/state&gt;
</programlisting>
          </section>

          <section xml:id="form-ordering">
            <title>ordering</title>

            <para>This will display an ordering field for your list, both in
            traditional Joomla! method and with a new ajax drag'n'drop method.
            We recommend placing this field first on your form, to respect
            Joomla! 3.0 and later's JUI (Joomla! User Interface)
            guidelines.</para>

            <para>You can set the following attributes:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">class</emphasis> CSS
                class</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">readonly</emphasis> Is this a
                read-only field?</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">disabled</emphasis> Is this a
                disabled form element?</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">onchange</emphasis> The onChange
                Javascript event</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">ordertitle</emphasis> The field name
                used to display the options title (if not set it will use the magic
                <literal>title</literal> field)</para>
              </listitem>
            </itemizedlist>
          </section>

          <section xml:id="password">
            <title>password</title>

            <para>This will display a password input field.</para>

            <para>You can set the following attributes:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">class</emphasis> CSS
                class</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">size</emphasis> Size of the
                field in characters</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">maxlength</emphasis> Maximum
                length of the input in characters</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">autocomplete</emphasis> Should
                we allow browser autocomplete of the password field?</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">readonly</emphasis> Is this a
                read only field?</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">disabled</emphasis> Is this a
                disabled form element?</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">strengthmeter</emphasis> Should
                we show a password strength meter?</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">threshold</emphasis> What is the
                minimum password strength we are supposed to accept in order
                to validate the field (default: 66)?</para>
              </listitem>
            </itemizedlist>
          </section>

          <section xml:id="plugins">
            <title>plugins</title>

            <para>This will display a select input with a list of all
            installed Joomla! package.</para>

            <para>You can set the following attributes:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">class</emphasis> CSS
                class</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">folder</emphasis> The plugin
                type to load, e.g. "system", "content" and so on.</para>
              </listitem>
            </itemizedlist>

            <para>The list field type's attributes apply as well.</para>
          </section>

          <section xml:id="form-published">
            <title>published</title>

            <para>This will display a status toggle input field (each time you
            click on it it changes the status).</para>

            <para>You can set the following attributes:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">show_published</emphasis> if
                true, the "published" status will be included in the toggle
                cycle (default true)</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">show_unpublished</emphasis> if
                true, the "unpublished" status will be included in the toggle
                cycle (default true)</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">show_archived</emphasis> if
                true, the "archived" status will be included in the toggle
                cycle (default false)</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">show_trash</emphasis> if true,
                the "trash" status will be included in the toggle cycle
                (default false)</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">show_all</emphasis> if true, all
                the available status will be included in the toggle cycle
                (default false)</para>
              </listitem>
            </itemizedlist>

            <para>The list field type's attributes apply as well.</para>
          </section>

          <section xml:id="radio">
            <title>radio</title>

            <para>This will display a radio selection input.</para>

            <para>You can set the following attributes:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">class</emphasis> CSS
                class</para>
              </listitem>
            </itemizedlist>
          </section>

          <section xml:id="rules">
            <title>rules</title>

            <para>Displays the ACL privileges setup user interface.</para>

            <para>Please consult the documentation of JFormFieldRules for more
            information.</para>
          </section>

          <section xml:id="selectrow">
            <title>selectrow</title>

            <para>Displays a checkbox to select the entire row for toolbar
            button operations such as edit, delete, copy etc.</para>
          </section>

          <section xml:id="sessionhandler">
            <title>sessionhandler</title>

            <para>This will display a Joomla! session handler selection
            input.</para>

            <para>You can set the following attributes:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">class</emphasis> CSS
                class</para>
              </listitem>
            </itemizedlist>

            <para>Please refer to Joomla!'s JFormFieldSessionHandler for more
            information.</para>
          </section>

          <section xml:id="spacer">
            <title>spacer</title>

            <para>This will display a spacer (static element) between form
            elements.</para>

            <para>You can set no attributes.</para>
          </section>

          <section xml:id="sql">
            <title>sql</title>

            <para>This will display a select input based on a custom SQL
            query</para>

            <para>You can set the following attributes:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">class</emphasis> CSS
                class</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">key_field</emphasis> the table
                field to use as key</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">value_field</emphasis> the table
                field to display as text</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">query</emphasis> the actual SQL
                query to run</para>
              </listitem>
            </itemizedlist>

            <para>We recommend avoiding this field type as the query is
            specific to a particular database server technology. Using the
            <literal>model</literal> or <literal>list</literal> type with a
            programmatic data source is strongly encouraged.</para>
          </section>

          <section xml:id="tel">
            <title>tel</title>

            <para>This will display a text input which expects a valid
            telephone value.</para>

            <para>You can set the following attributes:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">class</emphasis> CSS class
                (default '')</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">show_link</emphasis> if true, a
                "tel:" link will be appended around the field value (default
                false)</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">empty_replacement</emphasis> a
                string to show in place of the field when it's empty</para>
              </listitem>
            </itemizedlist>

            <para>The text field type's attributes apply as well.</para>
          </section>

          <section xml:id="text">
            <title>text</title>

            <para>This will display a single line text input.</para>

            <para>You can set the following attributes:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">class</emphasis> CSS class
                (default '')</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">url</emphasis> URL template for
                each element (use [ITEM:ID] as a placeholder for the item id).
                This goes through the field tag replacement (see below)</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">show_link</emphasis> if true, a
                "tel:" link will be appended around the field value (default
                false)</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">empty_replacement</emphasis> a
                string to show in place of the field when it's empty</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">size</emphasis> The size of the
                input in characters</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">maxlength</emphasis> The maximum
                acceptable input length in characters</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">readonly</emphasis> Is this a
                read-only field?</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">disabled</emphasis> Is this a
                disabled form field element?</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">format_string</emphasis> A
                string or translation key used to format the text data before
                it is displayed. Uses the format() PHP function's
                syntax.</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">format_if_not_empty</emphasis>
                Should we apply the format string even when the field is
                empty? Default: true</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">parse_value</emphasis> If set to
                true, the value of the field will go through the field tag
                replacement (see below) Default: false</para>
              </listitem>
            </itemizedlist>

            <section xml:id="field-tag-replacement-for-text-fields">
              <title>Field tag replacement for text fields</title>

              <para>You can reference values from other fields inside your
              text. You can do that using the square bracket tag syntax, i.e.
              <literal>[ITEM:fieldname]</literal> is replaced with the value
              of the field <literal>fieldname</literal>. The tag must open
              with a square bracket, followed by the uppercase word ITEM,
              followed by a colon, the field name and closing with a square
              bracket. You must not use spaces in the tag.</para>

              <para>FOF also recognises the special tag
              <literal>[ITEM:ID]</literal>, replacing it with the value of the
              key field of the table.</para>
            </section>
          </section>

          <section xml:id="textarea">
            <title>textarea</title>

            <para>This will display a textarea input.</para>

            <para>You can set the following attributes:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">class</emphasis> CSS class
                (default '')</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">disabled</emphasis> Is this
                disabled form element?</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">cols</emphasis> Number of
                columns</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">rows</emphasis> Number of
                rows</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">onchange</emphasis> The onChange
                Javascript event</para>
              </listitem>
            </itemizedlist>
          </section>

          <section xml:id="title">
            <title>title</title>

            <para>This is like a text field. On list views it will display a
            second line containing secondary information, e.g. the alias
            (slug) of the record.</para>

            <para>The following attributes are used on top of the text field's
            attributes:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">slug_field</emphasis> The name
                of the field containing the slug or other secondary
                information to display. Default: slug</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">slug_format</emphasis> The
                format string (string or translation key) for the secondary
                information line. Default: (%s)</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">slug_class</emphasis> The CSS
                class of the secondary information line. Default: small</para>
              </listitem>
            </itemizedlist>
          </section>

          <section xml:id="timezone">
            <title>timezone</title>

            <para>This will display a select list with all available
            timezones.</para>

            <para>You can set the following attributes:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">class</emphasis> CSS class
                (default '')</para>
              </listitem>
            </itemizedlist>
          </section>

          <section xml:id="url">
            <title>url</title>

            <para>This will display a text input which expects a valid
            URL.</para>

            <para>You can set the following attributes:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">class</emphasis> CSS class
                (default '')</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">show_link</emphasis> if true, an
                &lt;a&gt; link will be added around the field value (default
                false)</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">empty_replacement</emphasis> a
                string to show in place of the field when it's empty</para>
              </listitem>
            </itemizedlist>

            <para>The text field type's attributes apply as well.</para>
          </section>

          <section xml:id="user">
            <title>user</title>

            <para>This will display a select list with all available Joomla!
            users.</para>

            <para>You can set the following attributes:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="strong">class</emphasis> CSS class
                (default '')</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">show_username</emphasis> if
                true, show the username (default true)</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">show_email</emphasis> if true,
                show the username (default true)</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">show_name</emphasis> if true,
                show the full name (default true)</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">show_id</emphasis> if true, show
                the id (default true)</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">show_link</emphasis> if true,
                add a link around the field value (default false)</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">show_avatar</emphasis> if true,
                show the avatar (user picture). Default false.</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">avatar_size</emphasis> size of
                the image in the avatar (avatars are square, so this is both
                the width and height of the avatar)</para>
              </listitem>

              <listitem>
                <para><emphasis role="strong">avatar_method</emphasis> if set
                to "plugin" use FOF plugins, else fall back to a Gravatar
                based on the user's email address</para>
              </listitem>
            </itemizedlist>
          </section>
        </section>
      </section>
    </section>
  </chapter>

  <chapter xml:id="tips-and-tricks">
    <title>Tips and tricks</title>

    <para>There are some features in FOF that allow to perform neat time
    saving tips. As these topics are not exactly library reference we've put
    them in this chapter. Consider it a grab-bag of FOF tricks!</para>

    <para>You can view all tips and tricks on-line at
    https://github.com/akeeba/fof/wiki/Tips%20and%20Tricks</para>

    <section xml:id="multicolumn-slug">
      <title>Creating a slug from multiple columns</title>

      <para>Sometimes, you want to be combine multiple columns from a table to
      create the default 'slug' for the records. A typical example is a table
      recording 'people', where you want the slug to be firstname-lastname. to
      achieve this, simply override the table class for your table, with the
      following method:</para>

      <programlisting language="php">public function check()
{
    $slug           = $this-&gt;getColumnAlias('slug');
    $this-&gt;setColumnAlias('title', 'lastname'); // this is needed to trigger the unicity check
    if (!$this-&gt;$slug)
    {
        $this-&gt;$slug = !$this-&gt;firstname ? $this-&gt;lastname : $this-&gt;firstname .' '. $this-&gt;lastname;
        $this-&gt;$slug = F0FStringUtils::toSlug($this-&gt;$slug);
    }
    return parent::check();
}
</programlisting>
    </section>

    <section xml:id="one-to-many-record-delete">
      <title>One to many database table relationship deletion</title>

      <para>Q: How to delete all rows in a child table when the parent table's
      record is deleted in FoF? A: Some code in the model file.</para>

      <programlisting language="sql">CREATE TABLE IF NOT EXISTS `#__foobar_items` (
  `foobar_item_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,*
  `title` varchar(255) NOT NULL,
  `description` mediumtext,
  PRIMARY KEY (`foobar_item_id`)
) ENGINE = INNODB DEFAULT CHARSET=utf8;

CREATE TABLE IF NOT EXISTS `#__foobar_childs` (
  `foobar_child_id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `foobar_item_id` bigint(20) unsigned NOT NULL,*
  `description` mediumtext,
  PRIMARY KEY (`foobar_child_id`)
) ENGINE = INNODB DEFAULT CHARSET=utf8;</programlisting>

      <para>You could assume that the way to do delete child records when a
      parent record is deleted is to use MySQL's "ON DELETE CASCADE". Wrong!
      You could try using a MySQL trigger to effect the cascade deletion.
      Wrong (let alone most hosts won't allow you to create a trigger)!</para>

      <para>Assuming your deletion occurs in the front-end, you'll create a
      new site/components/com_foobar/models/items.php:</para>

      <programlisting language="php">defined('_JEXEC') or die();
class FoobarModelItems extends F0FModel
{
    /***
    Delete all related records in the child table "#__foobar_childs" when the parent table's record is deleted
    ***/

    protected function onBeforeDelete($id, $table){
        $result = parent::onBeforeDelete($id, $table);
        if($result) {
            $table-&gt;load($id);
            $childids = F0FModel::getTmpInstance('childs','FoobarModel')-&gt;limit(0)-&gt;limitstart(0)-&gt;getItemList();
            if(!empty($childids)){
                foreach($childids as $childid){
                    F0FModel::getTmpInstance('childs','FoobarModel')-&gt;setId($childid-&gt;foobar_child_id)-&gt;delete();
                }
            }
        }
    return $result;
    }
}</programlisting>

      <para>It's easier than you may have thought.</para>

      <para>If you have a one-to-one relationship, then you'll have:</para>

      <programlisting language="php">class FoobarModelItems extends F0FModel
{
    /***
    Delete all related records in the child table "#__foobar_childs"
    when the parent table's record is deleted
    ***/

    protected function onBeforeDelete($id, $table){
        $result = parent::onBeforeDelete($id, $table);
        if($result) {
            $table-&gt;load($id);
            F0FModel::getTmpInstance('childs','FoobarModel')-&gt;setId($table-&gt;load($id))-&gt;delete();
        }
    return $result;
    }
}</programlisting>
    </section>

    <section xml:id="creating-bare-views">
      <title>Creating a bare view (a view without a database table)</title>

      <para>By default every view needs a corresponding database table. What
      to do when you have a view with no table associated because it is not a
      list or edit form?</para>

      <bridgehead>Setup the controller</bridgehead>

      <para>In the controller we force the edit task by adding the following
      code:</para>

      <programlisting language="php">public function execute($task) {
    parent::execute('edit');
}</programlisting>

      <bridgehead>Setup the model</bridgehead>

      <para>In the model we need to add 2 overrides.</para>

      <para>Override the constructor</para>

      <programlisting language="php">public function __construct($config = array()) {
    // This is a dirty trick to avoid getting warning PHP messages by the
    // JDatabase layer
    $config['table'] = 'shops';
    parent::__construct($config);
}</programlisting>

      <para>First we override the constructor because we need to specify a
      table, this to make sure the system can read some table but no data will
      be taken from the table.</para>

      <para>Override the getItem() method</para>

      <programlisting language="php">public function getItem($id = null) {
    return null;
}</programlisting>

      <para>We need to override the getItem() method because we are not
      actually getting any data. By returning a null value, the system is
      happy because a value is returned.</para>

      <bridgehead>Setup the view</bridgehead>

      <para>In the view you can do what you like by using the onAdd() method
      override.</para>
    </section>

    <section xml:id="transparent_authentication">
      <title>Transparent authentication</title>

      <para>Transparent authentication allows FOF to authenticate a user using
      Basic Authentication or URL parameters. This allows you to create web
      services or directly access pages which require a logged in users
      without using Joomla! session cookies.</para>

      <para>The authentication credentials can be provided via two methods:
      Basic Authentication or a URL parameter. The authentication credentials
      can either be a username and password pair transmitted in plaintext (not
      recommended unless you are forcibly using HTTPS with a commercially
      signed SSL certificate) or encrypted. The encrypted information uses
      Time-Based One Time Passwords (TOTP) to allow you to communicate the
      credentials securely, without the burden of public key cryptography,
      while at the same time maintaining an intrinsically very narrrow window
      of opportunity. Furthermore, since the effective encryption key is
      modified every few seconds it makes an attack against it slightly harder
      than using regular symmetric AES-128 cryptography.</para>

      <para>Transparent authentication is enabled by default, but doesn’t use
      TOTP.</para>

      <bridgehead>Setting it up</bridgehead>

      <para>Setting up transparent authentication requires you to modify your
      component’s Dispatcher class, namely its __construct(), to change the
      values of some protected fields.</para>

      <para>The available fields are:</para>

      <variablelist>
        <varlistentry>
          <term>$fofAuthtimeStep</term>

          <listitem>
            <para>The time step, in seconds, for the time based one time
            passwords (TOTP) used for encryption. The default value is 6
            seconds. The window of opportunity for an attacker is 2x-3x as
            much, i.e. 12-18 seconds using the default value. This is
            adequately high to be practical and too low to allow a realistic
            attack by a hacker. WARNING! If you change this option you have to
            notify the consumers of the service to make the same change,
            otherwise your TOTPs will be vastly different and communication
            will fail.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>$fofAuthKey</term>

          <listitem>
            <para>The Base32 encoded key for TOTP. Please note that this is
            Base32, not Base64. Only required if you’re going to use
            encryption.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>$fofAuthFormats</term>

          <listitem>
            <para>Which result formats should be handled by the transparent
            authentication. This is an array, by default array('json', 'csv',
            'xml', 'raw'). We recommend only using non-HTML formats in
            here.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>$fofAuthLogoutOnReturn</term>

          <listitem>
            <para>By default it’s true and it means that once the component
            finishes executing, FOF will log out the user it authenticated
            using transparent authentication. This is a precaution against
            someone intercepting and abusing the session cookie Joomla! will
            be sending back to the client, as well as preventing the sessions
            table from filling up.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>$fofAuthAuthMethods</term>

          <listitem>
            <para>An array of supported authentication methods. Only use the
            ones that make sense for your application. Avoid using the
            *_Plaintext ones, please. The possible values in the array
            are:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis role="bold">HTTPBasicAuth_TOTP</emphasis> HTTP
                Basic Authentication using encrypted information protected
                with a TOTP (the username must be "fofauth")</para>
              </listitem>

              <listitem>
                <para><emphasis role="bold">QueryString_TOTP</emphasis>
                Encrypted information protected with a TOTP passed in the
                _fofauthentication query string parameter</para>
              </listitem>

              <listitem>
                <para><emphasis role="bold">HTTPBasicAuth_Plaintext</emphasis>
                HTTP Basic Authentication using a username and password pair
                in plain text</para>
              </listitem>

              <listitem>
                <para><emphasis role="bold">QueryString_Plaintext</emphasis>
                Plaintext, JSON-encoded username and password pair passed in
                the _fofauthentication query string parameter</para>
              </listitem>
            </itemizedlist>

            <para>When you are using the QueryString_TOTP method you can pass
            your authentication information as GET or POST variable called
            _fofauthentication with the value being the URL encoded cryptogram
            of the authentication credentials (see further down).</para>
          </listitem>
        </varlistentry>
      </variablelist>

      <bridgehead>How to get a TOTP key</bridgehead>

      <para>Any Base32 string can be used as a TOTP key as long as it expands
      to exactly 10 characters. If you don’t feel like guessing, you can
      simply do:</para>

      <programlisting language="php">$totp = new F0FEncryptTotp();
$secret = $totp-&gt;generateSecret();</programlisting>

      <para>You have to share this secret key with all clients wishing to
      connect to your component via a secure channel. This secret key musy
      also be set in the fofAuthKey variable.</para>

      <bridgehead>How to construct and supply an authentication
      set</bridgehead>

      <para>The authentication set is a representation of the username and
      password of the user you want FOF to log in using transparent
      authentication. Its format depends on the authentication method.</para>

      <para>Before going into much detail, we should consider an FOF
      authentication key to be a JSON-encoded object containing the keys
      username and password. E.g.:</para>

      <programlisting language="json">{ “username”: “sample_user”, “password”: “$3Cr3+” }
</programlisting>

      <para>This is used with all but one authentication methods. Encryption
      of the FOF authentication key, used with all *_TOTP methods, is
      discussed further down this document.</para>

      <para>If you are using HTTPBasicAuth_Plaintext method, you have to
      supply your username and password using HTTP Basic Authentication. The
      username is the username of the user you want to log in and the password
      is the password of the user you want to log in. This is the easiest and
      most insecure authentication method.</para>

      <para>If you are using the HTTPBasicAuth_TOTP method, you have to supply
      a username of fofauth (including the leading underscore) and as the
      password enter the encrypted FOF authentication key.</para>

      <para>If you are using the QueryString_Plaintext method you have to
      supply a GET or POST query parameter with a name of _fofauthentication
      (including the leading underscore). Its value must be the URL encoded
      FOF authentication key.</para>

      <para>If you are using the QueryString_TOTP method you have to supply a
      GET or POST query parameter with a name of _fofauthentication (including
      the leading underscore). Its value must be the URL encoded FOF
      authentication key.</para>

      <bridgehead>Encrypting the FOF authentication key</bridgehead>

      <para>Assuming you are doing this from a FOF-powered component, you can
      do something like this:</para>

      <programlisting language="php">$timeStep = 6; // Change this if you have a different value in your Dispatcher
$authKey = json_encode(array(
  'username' =&gt; $username,
  'password' =&gt; $password
));
$totp = new F0FEncryptTotp($timeStep);
$otp = $totp-&gt;getCode($secretKey);
$cryptoKey = hash('sha256', $this-&gt;_fofAuth_Key.$otp);
$aes = new F0FEncryptAes($cryptoKey);
$encryptedAuthKey = $aes-&gt;encryptString($authKey);
</programlisting>

      <para>If you can get your hands on a TOTP and AES-256 implementation for
      your favourite programming language you can use talk to FOF-powered
      components through transparent authentication. Tip: TOTP libraries are
      usually labelled as being Google Authenticator libraries. Google
      Authenticator simply uses TOTP with a temp step of 30 seconds. Most such
      libraries are able to change the time step, thus possible to use with
      FOF. In fact, that's how FOF's TOTP library was derived.</para>
    </section>

    <section xml:id="creating-a-cpanel-view">
      <title>Creating a cpanel (control panel) view</title>

      <para>If you want to create an Administrator CPanel view in your
      component as the Default view follow the following steps:</para>

      <para>Create a controller at
      &lt;administrator&gt;/controllers/cpanel.php</para>

      <programlisting language="php">class COMPONENT_NAMEControllerCpanel extends F0FController

{
	public function execute($task)
	{
		parent::execute('browse');
	}
}
</programlisting>

      <para>Create a view at
      &lt;administrator&gt;/views/cpanel/tmpl/default.php. If you use Akeeba
      Strapper you can easily create icons:</para>

      <programlisting language="php">&lt;?php
// Protect from unauthorized access
defined('_JEXEC') or die;

JHtml::_('behavior.framework');
JHtml::_('behavior.modal');

$option = 'com_COMPONENT_NAME';
?&gt;

&lt;div id="cpanel" class="span12"&gt;
	&lt;div class="icon"&gt;
		&lt;a href="index.php?option=&lt;?php echo $option ?&gt;&amp;view=THE_VIEW"&gt;
			&lt;img
				src="&lt;?php echo rtrim(JURI::base(), '/'); ?&gt;/../media/com_COMPONENT_NAME/assets/images/icon_1_48.png"
				border="0" alt="&lt;?php echo JText::_('COM_COMPONENT_NAME_CPANEL_ICON_1_ALT') ?&gt;"/&gt;
				&lt;span&gt;
					&lt;?php echo JText::_('COM_COMPONENT_NAME_CPANEL_ICON_1') ?&gt;&lt;br/&gt;
				&lt;/span&gt;
		&lt;/a&gt;
	&lt;/div&gt;
	[...]
&lt;/div&gt;
</programlisting>

      <para>Customize the Cpanel toolbar creating a
      &lt;administrator&gt;/toolbar.php file with:</para>

      <programlisting language="php">class COMPONENT_NAMEToolbar extends F0FToobar
{
	/**
	 * Prepares the toolbar for Cpanel view
	 *
	 * @return void
	 */
	public function onCpanelsBrowse()
	{
		// Set the toolbar title
		JToolBarHelper::title(JText::_('COM_COMPONENT_NAME_CPANEL_TITLE_DASHBOARD'), 'COMPONENT_NAME');

		// Add Components options (see config.xml)
		JToolBarHelper::preferences('com_COMPONENT_NAME');
	}
}</programlisting>
    </section>

    <section xml:id="automatic-field-validation">
      <title>Automatic field validation</title>

      <para>You can perform automatic table checks based on database schema.
      Let's say you have a table like this:</para>

      <programlisting language="sql">CREATE TABLE IF NOT EXISTS `#__foobar_bars` (
  `foobar_bar_id` int(11) NOT NULL AUTO_INCREMENT,
  `required_field` varchar(50) NOT NULL,
  `optional_field` varchar(50) DEFAULT NULL,
  PRIMARY KEY (`foobar_bar_id`)
);
</programlisting>

      <para>As you can see, the optional_field is nullable, while the required
      one is not. To activate this feature, set the _autoChecks flag to true
      in your table constructor:</para>

      <programlisting language="php">class FoobarTableBar extends F0FTable
{
    function __construct($table, $key, $db)
    {
        parent::__construct($table, $key, $db);

        $this-&gt;_autoChecks = true;
    }
}
</programlisting>

      <para>In this way, when you're going to save your table, FOF will check
      every field; if it's not-nullable and it's empty, the check fails and an
      error message is enqueued. FOF will create a token string that will be
      parsed by JText, following this convention:
      COM_&lt;TABLENAME&gt;_ERR_&lt;FIELDNAME&gt;</para>

      <para>If you use the previous table, you'll have something like
      this:</para>

      <para>COM_FOOBAR_BAR_ERR_REQUIRED_FIELD</para>

      <para>If you want to skip any field from these automatic checks, simply
      use this syntax in your table constructor:</para>

      <programlisting language="php">$this-&gt;setSkipChecks(array('my_field_1', 'my_field_2'));
</programlisting>
    </section>

    <section xml:id="ordering-submenu-items-no-code">
      <title>Ordering submenu items without writing any code</title>

      <para>In the backend of your component, FoF creates automatically a
      submenu with links to all your views.</para>

      <para>Normally they are sorted alphabetically, but you can add ordering
      information by placing a metadata.xml file in each view folder. E.g.
      /components/com_todo/views/item/metadata.xml</para>

      <para>The xml should be like the following:</para>

      <programlisting language="xml">&lt;metadata&gt;
     &lt;foflib&gt;
        &lt;ordering&gt;123&lt;/ordering&gt;
     &lt;/foflib&gt;
  &lt;/metadata&gt;</programlisting>
    </section>
  </chapter>

  <appendix xml:id="appendix-definitions">
    <title>Definitions</title>

    <section xml:id="media-file-identifiers">
      <title>Media file identifiers</title>

      <para>FOF expects you to give an abstracted path to your media (CSS,
      Javascript, image, …) files, also called an "identifier". It allows it
      to perform media file overrides very easily, in a fashion similar to how
      Joomla! performs template overrides for view files. This section will
      help you understand how they are used and how media file overrides
      work.</para>

      <para>Media file identifiers are in the form:</para>

      <programlisting>area://path</programlisting>

      <para>Where the <literal>area</literal> can be one of:</para>

      <para><emphasis role="strong">media</emphasis> : The file is searched
      inside your site's <literal>media</literal> directory. FOF will also try
      to locate it in the media overrides directory of your site, e.g.
      <literal>templates/your_template/media</literal> where your_template is
      the name of the currently active template on your site.</para>

      <para>In this case the <literal>path</literal> is the rest of the path
      relative to the media or media override directory. The first part of
      your path SHOULD be your extension's name, e.g. com_example.</para>

      <para>Example: <literal>media://com_example/css/style.css</literal> will
      look for the file
      <literal>templates/your_template/media/com_example/css/style.css</literal>
      or, if it doesn't exist,
      <literal>media/com_example/css/style.css</literal></para>

      <para><emphasis role="strong">admin</emphasis> : The file is searched
      for in the administration section of your extension. The first part of
      the path MUST be your extension's name. The file is first searched for
      in your template override directory.</para>

      <para>Example: <literal>admin://com_example/assets/style.css</literal>
      will look for the file
      <literal>administrator/templates/your_template/com_example/assets/style.css</literal>
      or, if it doesn't exist,
      <literal>administrator/components/com_example/assets/style.css</literal></para>

      <para><emphasis role="strong">site</emphasis> : The file is searched for
      in the front-end section of your extension. The first part of the path
      MUST be your extension's name. The file is first searched for in your
      template override directory.</para>

      <para>Example: <literal>site://com_example/assets/style.css</literal>
      will look for the file
      <literal>templates/your_template/com_example/assets/style.css</literal>
      or, if it doesn't exist,
      <literal>components/com_example/assets/style.css</literal></para>

      <important>
        <para>FOF cannot know what is the other side's template. Let's put it
        simply. If you are in the front-end, your template is called
        "foobar123" and you use the identifier
        <literal>admin://com_example/assets/style.css</literal>, FOF will look
        for the template override in
        <literal>administrator/templates/foobar123/com_example/assets/style.css</literal>.
        Of course this is incorrect, but there is no viable way to know what
        the back-end template in use is from the site's front-end and vice
        versa. As a result, we strongly recommend only using
        <literal>media://</literal> identifiers for media files.</para>

        <para>On top of that there is a security aspect as well. The front-end
        of your component should never try to load media files from the
        back-end of the component. Many web masters choose to conceal the fact
        that they are using Joomla! by means of password protection or
        redirection of the <literal>administrator</literal> directory.</para>
      </important>
    </section>
  </appendix>
</book>
